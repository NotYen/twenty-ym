# ä¿®å¾©æ¸¬è©¦æŒ‡å—

## âœ… ä¿®å¾©å·²å®Œæˆ

**ä¿®æ”¹æ–‡ä»¶**: `packages/twenty-front/src/modules/users/hooks/useLoadCurrentUser.ts`

**ä¿®æ”¹å…§å®¹**:
1. âœ… æ–°å¢ import: `isCurrentUserLoadedState`
2. âœ… æ–°å¢ setter: `setIsCurrentUserLoaded`
3. âœ… åœ¨ `loadCurrentUser` å‡½æ•¸çµå°¾æ·»åŠ : `setIsCurrentUserLoaded(true)`
4. âœ… å°‡ `setIsCurrentUserLoaded` æ·»åŠ åˆ°ä¾è³´é™£åˆ—

**ä¿®æ”¹çµ±è¨ˆ**:
- æ–°å¢è¡Œæ•¸: 4 è¡Œ
- ä¿®æ”¹æ–‡ä»¶: 1 å€‹
- ç„¡ Linter éŒ¯èª¤

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1: ä¸»è¦å•é¡Œ - ç™»å…¥å¾Œé®ç½©

**æ­¥é©Ÿ**:
1. æ¸…é™¤ç€è¦½å™¨ cookies å’Œ localStorage
2. è¨ªå•: `http://apple.118.168.188.27.nip.io:8866/`
3. è¼¸å…¥å¸³è™Ÿå¯†ç¢¼: `tim@apple.dev` / å¯†ç¢¼
4. é»æ“Šç™»å…¥

**é æœŸçµæœ**:
- âœ… ç™»å…¥æˆåŠŸå¾Œï¼ŒURL æœƒå¾ `/verify` è‡ªå‹•è·³è½‰åˆ°é¦–é  (ä¾‹å¦‚ `/objects/companies`)
- âœ… é®ç½©æ¶ˆå¤±
- âœ… å¯ä»¥æ­£å¸¸æ“ä½œç³»çµ±

**å¦‚æœå¤±æ•—**:
- åœç•™åœ¨ `/verify` è·¯å¾‘ â†’ èªªæ˜å°èˆªé‚è¼¯ä»æœ‰å•é¡Œ
- çœ‹åˆ°é®ç½© â†’ ç¢ºèªæ˜¯å¦åœ¨ `/verify` è·¯å¾‘

---

### æ¸¬è©¦ 2: æª¢æŸ¥ç€è¦½å™¨ Console (é€²éš)

**åœ¨ç™»å…¥éç¨‹ä¸­ï¼Œæ‰“é–‹ç€è¦½å™¨ Console (F12)**:

**åŸ·è¡Œä»¥ä¸‹å‘½ä»¤æª¢æŸ¥ Recoil State**:

```javascript
// 1. æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
console.log('Token Pair:', 
  JSON.parse(localStorage.getItem('tokenPair') || 'null')
);

// 2. æª¢æŸ¥ç•¶å‰è·¯å¾‘
console.log('Current Path:', window.location.pathname);

// 3. å¦‚æœæœ‰ Recoil DevToolsï¼Œæª¢æŸ¥ state
// (éœ€è¦å…ˆå®‰è£ Recoil DevTools ç€è¦½å™¨æ“´å±•)
```

**é æœŸ Console è¼¸å‡º**:
- `Token Pair`: æ‡‰è©²åŒ…å« `accessOrWorkspaceAgnosticToken` å’Œ `refreshToken`
- `Current Path`: ç™»å…¥å¾Œæ‡‰è©²æ˜¯ `/objects/companies` æˆ–é¡ä¼¼è·¯å¾‘ï¼Œ**ä¸æ˜¯** `/verify`

---

### æ¸¬è©¦ 3: æª¢æŸ¥ Network è«‹æ±‚

**åœ¨ Chrome DevTools â†’ Network æ¨™ç±¤**:

**è§€å¯Ÿä»¥ä¸‹è«‹æ±‚**:
1. `getAuthTokensFromLoginToken` - æ‡‰è©²è¿”å› 200
2. `getCurrentUser` - æ‡‰è©²è¿”å› 200ï¼ŒåŒ…å«ç”¨æˆ¶æ•¸æ“š
3. `getCoreViews` - æ‡‰è©²è¿”å› 200
4. `refreshObjectMetadataItems` - æ‡‰è©²è¿”å› 200

**å¦‚æœçœ‹åˆ°éŒ¯èª¤**:
- 401/403 â†’ èªè­‰å•é¡Œ
- 500 â†’ å¾Œç«¯éŒ¯èª¤
- Network Error â†’ é€£æ¥å•é¡Œ

---

### æ¸¬è©¦ 4: åˆ·æ–°é é¢ (å·²ç™»å…¥ç‹€æ…‹)

**æ­¥é©Ÿ**:
1. ç™»å…¥æˆåŠŸå¾Œ
2. æŒ‰ F5 åˆ·æ–°é é¢

**é æœŸçµæœ**:
- âœ… é é¢æ­£å¸¸è¼‰å…¥
- âœ… ä¸æœƒè·³è½‰åˆ°ç™»å…¥é 
- âœ… ç”¨æˆ¶æ•¸æ“šæ­£ç¢ºé¡¯ç¤º

---

### æ¸¬è©¦ 5: ç™»å‡ºå†ç™»å…¥

**æ­¥é©Ÿ**:
1. é»æ“Šå³ä¸Šè§’é ­åƒ â†’ ç™»å‡º
2. å†æ¬¡ç™»å…¥

**é æœŸçµæœ**:
- âœ… ç™»å‡ºæˆåŠŸï¼Œè·³è½‰åˆ°ç™»å…¥é 
- âœ… ç™»å…¥æˆåŠŸï¼Œæ­£å¸¸é€²å…¥ç³»çµ±

---

## ğŸ› å•é¡Œæ’æŸ¥

### å•é¡Œ 1: ä»ç„¶çœ‹åˆ°é®ç½©

**å¯èƒ½åŸå› **:
1. ç€è¦½å™¨å¿«å–æœªæ¸…é™¤
2. åœç•™åœ¨ `/verify` è·¯å¾‘

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# 1. æ¸…é™¤ç€è¦½å™¨å¿«å–
# Chrome: Ctrl+Shift+Delete â†’ æ¸…é™¤æ‰€æœ‰æ•¸æ“š

# 2. é‡å•Ÿæœå‹™
cd /Users/ym/twenty-ym
bash twenty-config.sh restart
```

### å•é¡Œ 2: å‰ç«¯ç„¡æ³•è¨ªå•

**æª¢æŸ¥æœå‹™ç‹€æ…‹**:
```bash
# æª¢æŸ¥ç«¯å£
lsof -ti:8866,8867

# æŸ¥çœ‹æ—¥èªŒ
tail -f /Users/ym/twenty-ym/twenty.log
```

### å•é¡Œ 3: ç™»å…¥å¾Œ 401 éŒ¯èª¤

**å¯èƒ½åŸå› **:
- Token é©—è­‰å¤±æ•—
- å¾Œç«¯èªè­‰é…ç½®å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥å¾Œç«¯æ—¥èªŒ
tail -f /Users/ym/twenty-ym/twenty.log | grep -i error

# é‡ç½® Redis å¿«å–
redis-cli FLUSHALL
```

---

## ğŸ“Š é©—è­‰ä¿®å¾©æˆåŠŸçš„æ¨™èªŒ

### âœ… æˆåŠŸæ¨™èªŒ

1. **ç™»å…¥æµç¨‹é †æš¢**
   - è¼¸å…¥å¸³å¯† â†’ çŸ­æš«åœç•™ `/verify` â†’ è‡ªå‹•è·³è½‰é¦–é 
   - å…¨ç¨‹ç„¡é®ç½©é˜»æ“‹

2. **Console ç„¡éŒ¯èª¤**
   - ç„¡ GraphQL éŒ¯èª¤
   - ç„¡ React éŒ¯èª¤
   - ç„¡ Network éŒ¯èª¤

3. **State æ­£ç¢ºè¨­ç½®**
   - `isCurrentUserLoaded` ç‚º true
   - `currentUser` åŒ…å«å®Œæ•´æ•¸æ“š
   - `currentWorkspace` åŒ…å« workspace æ•¸æ“š

### âŒ å¤±æ•—æ¨™èªŒ

1. **åœç•™åœ¨ `/verify`**
   - èªªæ˜å°èˆªé‚è¼¯æœªè§¸ç™¼
   - éœ€è¦é€²ä¸€æ­¥èª¿æŸ¥

2. **é®ç½©ä»ç„¶å­˜åœ¨**
   - ç¢ºèªç•¶å‰è·¯å¾‘
   - æª¢æŸ¥ `useShowAuthModal` è¿”å›å€¼

3. **Console æœ‰éŒ¯èª¤**
   - æŸ¥çœ‹å…·é«”éŒ¯èª¤ä¿¡æ¯
   - å¯èƒ½éœ€è¦é¡å¤–ä¿®å¾©

---

## ğŸ”„ å¦‚æœä¿®å¾©å¤±æ•—

### å›æ»¾æ­¥é©Ÿ

```bash
cd /Users/ym/twenty-ym

# 1. æŸ¥çœ‹ä¿®æ”¹
git diff packages/twenty-front/src/modules/users/hooks/useLoadCurrentUser.ts

# 2. å›æ»¾ä¿®æ”¹
git checkout packages/twenty-front/src/modules/users/hooks/useLoadCurrentUser.ts

# 3. é‡å•Ÿæœå‹™
bash twenty-config.sh restart
```

### æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœé€™å€‹ä¿®å¾©ä¸èµ·ä½œç”¨ï¼Œæˆ‘å€‘å¯ä»¥å˜—è©¦ï¼š

**æ–¹æ¡ˆ A**: åœ¨ `useVerifyLogin` ä¸­æ·»åŠ å°èˆª
**æ–¹æ¡ˆ B**: ä¿®æ”¹ `UserAndViewsProviderEffect` çš„ `shouldSkip` é‚è¼¯
**æ–¹æ¡ˆ C**: åœ¨ `PageChangeEffect` ä¸­æ·»åŠ é¡å¤–çš„å°èˆªæ¢ä»¶

---

## ğŸ“ æ¸¬è©¦å ±å‘Šæ¨¡æ¿

è«‹å®Œæˆä»¥ä¸‹æ¸¬è©¦ä¸¦è¨˜éŒ„çµæœï¼š

```
ã€æ¸¬è©¦ 1: ç™»å…¥æµç¨‹ã€‘
- æ¸¬è©¦æ™‚é–“: __________
- çµæœ: â¬œ æˆåŠŸ / â¬œ å¤±æ•—
- ç¾è±¡: __________

ã€æ¸¬è©¦ 2: Console æª¢æŸ¥ã€‘
- Token Pair: â¬œ æ­£å¸¸ / â¬œ ç•°å¸¸
- Current Path: __________
- éŒ¯èª¤ä¿¡æ¯: __________

ã€æ¸¬è©¦ 3: Network è«‹æ±‚ã€‘
- getAuthTokensFromLoginToken: â¬œ 200 / â¬œ éŒ¯èª¤
- getCurrentUser: â¬œ 200 / â¬œ éŒ¯èª¤
- å…¶ä»–å•é¡Œ: __________

ã€æ¸¬è©¦ 4: åˆ·æ–°é é¢ã€‘
- çµæœ: â¬œ æ­£å¸¸ / â¬œ ç•°å¸¸
- ç¾è±¡: __________

ã€æ¸¬è©¦ 5: ç™»å‡ºå†ç™»å…¥ã€‘
- çµæœ: â¬œ æ­£å¸¸ / â¬œ ç•°å¸¸
- ç¾è±¡: __________

ã€ç¸½é«”è©•åƒ¹ã€‘
- ä¿®å¾©æ˜¯å¦æˆåŠŸ: â¬œ æ˜¯ / â¬œ å¦
- é¡å¤–ç™¼ç¾: __________
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

**å¦‚æœæ¸¬è©¦æˆåŠŸ**:
1. âœ… å•é¡Œè§£æ±ºï¼
2. å¯ä»¥è€ƒæ…®æäº¤ PR åˆ° Twenty å®˜æ–¹å€‰åº«
3. è¨˜éŒ„é€™æ¬¡ä¿®å¾©ç¶“é©—

**å¦‚æœæ¸¬è©¦å¤±æ•—**:
1. æ”¶é›†è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯
2. æˆªåœ–æˆ–éŒ„è£½å•é¡Œç¾è±¡
3. æˆ‘å€‘ä¸€èµ·åˆ†æä¸¦å˜—è©¦æ›¿ä»£æ–¹æ¡ˆ

---

**æ¸¬è©¦æ„‰å¿«ï¼å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ã€‚** ğŸš€

