# Twenty CRM - å®Œæ•´æ¸¬è©¦èˆ‡éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬ï¼š** 2024-12-11
**é©ç”¨å¹³å°ï¼š** Windows / Mac / Linux

---

## ğŸ“‹ ç›®éŒ„

- [å‰ç½®æº–å‚™](#å‰ç½®æº–å‚™)
- [æ¨¡å¼ä¸€ï¼šDocker å®Œæ•´éƒ¨ç½²æ¨¡å¼](#æ¨¡å¼ä¸€docker-å®Œæ•´éƒ¨ç½²æ¨¡å¼)
- [æ¨¡å¼äºŒï¼šæœ¬åœ°é–‹ç™¼æ¨¡å¼](#æ¨¡å¼äºŒæœ¬åœ°é–‹ç™¼æ¨¡å¼)
- [æ¨¡å¼åˆ‡æ›](#æ¨¡å¼åˆ‡æ›)
- [ç–‘é›£æ’è§£](#ç–‘é›£æ’è§£)
- [ç’°å¢ƒè®Šæ•¸åƒè€ƒ](#ç’°å¢ƒè®Šæ•¸åƒè€ƒ)
- [LINE æ•´åˆé…ç½®](#line-æ•´åˆé…ç½®)

---

## å‰ç½®æº–å‚™

### 1. ç³»çµ±éœ€æ±‚

#### ç¡¬é«”éœ€æ±‚
- **RAM**: æœ€ä½ 8GBï¼Œå»ºè­° 16GB
- **ç£ç¢Ÿç©ºé–“**: è‡³å°‘ 10GB å¯ç”¨ç©ºé–“
- **CPU**: å»ºè­° 4æ ¸å¿ƒä»¥ä¸Š

#### è»Ÿé«”éœ€æ±‚
- **Docker Desktop**: æœ€æ–°ç‰ˆæœ¬
  - Windows: éœ€å•Ÿç”¨ WSL2
  - Mac: Docker Desktop for Mac
  - Linux: Docker Engine + Docker Compose
- **Node.js**: v24.x (å»ºè­°ä½¿ç”¨ nvm ç®¡ç†ç‰ˆæœ¬)
- **Yarn**: v4.x (Corepack)
- **Git**: æœ€æ–°ç‰ˆæœ¬

### 2. Docker Desktop é…ç½®

#### Windows / Mac
1. æ‰“é–‹ Docker Desktop
2. é€²å…¥ **Settings** â†’ **Resources**
3. èª¿æ•´é…ç½®ï¼š
   - **Memory**: 8GBï¼ˆæœ€ä½ï¼‰/ 12GBï¼ˆå»ºè­°ï¼‰
   - **CPUs**: 4æ ¸å¿ƒï¼ˆå»ºè­°ï¼‰
   - **Swap**: 2GB
   - **Disk image size**: 60GB

#### Linux
```bash
# ç¢ºèª Docker å’Œ Docker Compose å·²å®‰è£
docker --version
docker compose version

# ç¢ºèª Docker daemon é‹è¡Œä¸­
sudo systemctl status docker
```

### 3. å°ˆæ¡ˆæº–å‚™

```bash
# 1. å…‹éš†å°ˆæ¡ˆï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰
git clone <repository-url> twenty-ym
cd twenty-ym

# 2. æª¢æŸ¥ç•¶å‰åˆ†æ”¯
git branch

# 3. ç¢ºèªå°ˆæ¡ˆçµæ§‹
# æ‡‰åŒ…å«ä»¥ä¸‹é—œéµç›®éŒ„å’Œæª”æ¡ˆï¼š
# â”œâ”€â”€ deployment/
# â”‚   â””â”€â”€ docker-compose.local-test.yml
# â”œâ”€â”€ packages/
# â”‚   â”œâ”€â”€ twenty-docker/twenty/Dockerfile
# â”‚   â”œâ”€â”€ twenty-server/
# â”‚   â”‚   â”œâ”€â”€ .env.local
# â”‚   â”‚   â””â”€â”€ package.json
# â”‚   â””â”€â”€ twenty-front/
# â”‚       â”œâ”€â”€ .env.local
# â”‚       â””â”€â”€ package.json
# â”œâ”€â”€ package.json
# â””â”€â”€ yarn.lock
```

---

## æ¨¡å¼ä¸€ï¼šDocker å®Œæ•´éƒ¨ç½²æ¨¡å¼

### ğŸ“Œ é©ç”¨å ´æ™¯
- âœ… æ¸¬è©¦å®Œæ•´çš„ Docker éƒ¨ç½²
- âœ… æ¨¡æ“¬ç”Ÿç”¢ç’°å¢ƒ
- âœ… æ¸¬è©¦ Docker æ˜ åƒæ§‹å»º
- âœ… éƒ¨ç½²å‰çš„æœ€çµ‚é©—è­‰
- âŒ ä¸é©åˆæ—¥å¸¸é–‹ç™¼ï¼ˆå•Ÿå‹•æ…¢ã€ç„¡ Hot Reloadï¼‰

### ğŸ”§ æ‰€éœ€æª”æ¡ˆèˆ‡è¨­å®š

#### 1. æ ¸å¿ƒæª”æ¡ˆæ¸…å–®

| æª”æ¡ˆè·¯å¾‘ | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|---------|------|---------|
| `packages/twenty-docker/twenty/Dockerfile` | Docker æ˜ åƒæ§‹å»ºå®šç¾© | âœ… å¿…éœ€ |
| `deployment/docker-compose.local-test.yml` | Docker Compose é…ç½® | âœ… å¿…éœ€ |
| `packages/twenty-docker/twenty/entrypoint.sh` | å®¹å™¨å•Ÿå‹•è…³æœ¬ | âœ… å¿…éœ€ |
| `.dockerignore` | Docker æ§‹å»ºæ’é™¤æª”æ¡ˆ | å»ºè­° |

#### 2. Dockerfile é—œéµé…ç½®

**ä½ç½®ï¼š** `packages/twenty-docker/twenty/Dockerfile`

**æ§‹å»ºéšæ®µèªªæ˜ï¼š**

```dockerfile
# éšæ®µ 1: å®‰è£ä¾è³´ (common-deps)
FROM node:24-alpine AS common-deps
# - è¤‡è£½ package.json å’Œ yarn.lock
# - åŸ·è¡Œ yarn install
# - æ¸…ç†å¿«å–

# éšæ®µ 2: æ§‹å»ºå¾Œç«¯ (twenty-server-build)
FROM common-deps AS twenty-server-build
# - è¤‡è£½å¾Œç«¯æºç¢¼
# - åŸ·è¡Œ npx nx run twenty-server:build
# - åƒ…ä¿ç•™ç”Ÿç”¢ä¾è³´

# éšæ®µ 3: æ§‹å»ºå‰ç«¯ (twenty-front-build)
FROM common-deps AS twenty-front-build
# - è¤‡è£½å‰ç«¯æºç¢¼
# - åŸ·è¡Œ npx nx build twenty-front
# - ç”Ÿæˆéœæ…‹æª”æ¡ˆåˆ° build/

# éšæ®µ 4: æœ€çµ‚æ˜ åƒ (twenty)
FROM node:24-alpine AS twenty
# - è¤‡è£½å¾Œç«¯æ§‹å»ºçµæœ
# - è¤‡è£½å‰ç«¯éœæ…‹æª”æ¡ˆåˆ° dist/front/
# - è¨­å®š entrypoint å’Œ cmd
```

**é‡è¦åƒæ•¸ï¼š**

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ |
|------|------|--------|
| `REACT_APP_SERVER_BASE_URL` | å‰ç«¯ API åŸºç¤ URL | æ§‹å»ºæ™‚å‚³å…¥ |
| `APP_VERSION` | æ‡‰ç”¨ç‰ˆæœ¬è™Ÿ | æ§‹å»ºæ™‚å‚³å…¥ |
| ä½¿ç”¨è€… | å®¹å™¨åŸ·è¡Œä½¿ç”¨è€… | uid 1000ï¼ˆé rootï¼‰ |

#### 3. Docker Compose é…ç½®è©³è§£

**ä½ç½®ï¼š** `deployment/docker-compose.local-test.yml`

##### æœå‹™ä¸€ï¼šdb-test (PostgreSQL)

```yaml
db-test:
  image: postgres:16
  container_name: twenty-db-test
  restart: unless-stopped
  environment:
    POSTGRES_DB: default              # è³‡æ–™åº«åç¨±
    POSTGRES_USER: postgres           # ä½¿ç”¨è€…åç¨±
    POSTGRES_PASSWORD: test_password_local  # å¯†ç¢¼
  volumes:
    - ./local-test/data/postgres:/var/lib/postgresql/data
  ports:
    - "127.0.0.1:15432:5432"         # å°å¤–ç«¯å£ 15432
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U postgres -d default"]
    interval: 10s
    timeout: 5s
    retries: 5
  networks:
    - twenty-test-network
```

**é—œéµé…ç½®èªªæ˜ï¼š**
- **ç«¯å£æ˜ å°„**ï¼š`15432:5432` - é¿å…èˆ‡æœ¬æ©Ÿ PostgreSQL è¡çª
- **è³‡æ–™æŒä¹…åŒ–**ï¼š`./local-test/data/postgres` - è³‡æ–™å„²å­˜åœ¨æœ¬åœ°
- **å¥åº·æª¢æŸ¥**ï¼šç¢ºä¿è³‡æ–™åº«å®Œå…¨å•Ÿå‹•å¾Œæ‰å•Ÿå‹•ä¾è³´æœå‹™

##### æœå‹™äºŒï¼šredis-test (Redis)

```yaml
redis-test:
  image: redis:7-alpine
  container_name: twenty-redis-test
  restart: unless-stopped
  command: ["redis-server", "--maxmemory-policy", "noeviction"]
  volumes:
    - ./local-test/data/redis:/data
  ports:
    - "127.0.0.1:16379:6379"         # å°å¤–ç«¯å£ 16379
  healthcheck:
    test: ["CMD", "redis-cli", "ping"]
    interval: 10s
    timeout: 5s
    retries: 5
  networks:
    - twenty-test-network
```

**é—œéµé…ç½®èªªæ˜ï¼š**
- **ç«¯å£æ˜ å°„**ï¼š`16379:6379` - é¿å…èˆ‡æœ¬æ©Ÿ Redis è¡çª
- **è¨˜æ†¶é«”ç­–ç•¥**ï¼š`noeviction` - è¨˜æ†¶é«”æ»¿æ™‚ä¸é©…é€è³‡æ–™
- **è³‡æ–™æŒä¹…åŒ–**ï¼š`./local-test/data/redis` - è³‡æ–™å„²å­˜åœ¨æœ¬åœ°

##### æœå‹™ä¸‰ï¼šserver-test (Twenty Server + Front)

```yaml
server-test:
  image: twenty-zh-tw:latest         # ä½¿ç”¨æœ¬åœ°æ§‹å»ºçš„æ˜ åƒ
  pull_policy: never                  # ä¸å¾é ç«¯æ‹‰å–
  container_name: twenty-server-test
  restart: unless-stopped
  depends_on:
    db-test:
      condition: service_healthy
    redis-test:
      condition: service_healthy
  environment:
    # ========== æ ¸å¿ƒé…ç½® ==========
    NODE_ENV: production
    NODE_PORT: 3000

    # ========== è³‡æ–™åº«é…ç½® ==========
    PG_DATABASE_URL: postgres://postgres:test_password_local@db-test:5432/default

    # ========== Redis é…ç½® ==========
    REDIS_URL: redis://redis-test:6379

    # ========== æœå‹™ URL ==========
    SERVER_URL: http://localhost:9999

    # ========== å®‰å…¨é‡‘é‘° ==========
    APP_SECRET: test_secret_key_for_local_docker_testing_only
    APP_VERSION: '0.2.1'
    LINE_CONFIG_ENCRYPTION_KEY: 4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17

    # ========== ç§Ÿæˆ¶æ¨¡å¼ ==========
    IS_MULTIWORKSPACE_ENABLED: false
    DEFAULT_SUBDOMAIN: app

    # ========== å…¶ä»–é…ç½® ==========
    IS_BILLING_ENABLED: false
    STORAGE_TYPE: local
    LOG_LEVEL: info
    SIGN_IN_PREFILLED: false

  volumes:
    - ./local-test/data/server-storage:/app/packages/twenty-server/.local-storage
  ports:
    - "9999:3000"                      # å°å¤–ç«¯å£ 9999
    - "9229:9229"                      # Debug ç«¯å£
  command: ["yarn", "start:debug"]
  healthcheck:
    test: ["CMD", "curl", "--fail", "http://localhost:3000/healthz"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 60s
  networks:
    - twenty-test-network
```

**é—œéµé…ç½®èªªæ˜ï¼š**
- **æ˜ åƒ**ï¼š`twenty-zh-tw:latest` - å¿…é ˆå…ˆæ§‹å»º
- **ç«¯å£æ˜ å°„**ï¼š`9999:3000` - ä¸»è¦æ‡‰ç”¨ç«¯å£
- **è³‡æ–™åº«é€£æ¥**ï¼šä½¿ç”¨ `db-test:5432`ï¼ˆå®¹å™¨å…§éƒ¨ç¶²è·¯ï¼‰
- **æª”æ¡ˆå„²å­˜**ï¼š`./local-test/data/server-storage` - æœ¬åœ°å„²å­˜

##### æœå‹™å››ï¼šworker-test (Background Worker)

```yaml
worker-test:
  image: twenty-zh-tw:latest
  pull_policy: never
  container_name: twenty-worker-test
  restart: unless-stopped
  command: ["yarn", "worker:prod"]
  depends_on:
    server-test:
      condition: service_healthy
  environment:
    NODE_ENV: production
    PG_DATABASE_URL: postgres://postgres:test_password_local@db-test:5432/default
    REDIS_URL: redis://redis-test:6379
    APP_SECRET: test_secret_key_for_local_docker_testing_only
    LINE_CONFIG_ENCRYPTION_KEY: 4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17
    SERVER_URL: http://localhost:9999
    DISABLE_DB_MIGRATIONS: "true"      # ç¦ç”¨è³‡æ–™åº«é·ç§»
    DISABLE_CRON_JOBS_REGISTRATION: "true"
    STORAGE_TYPE: local
    LOG_LEVEL: info
  volumes:
    - ./local-test/data/server-storage:/app/packages/twenty-server/.local-storage
  networks:
    - twenty-test-network
```

**é—œéµé…ç½®èªªæ˜ï¼š**
- **å‘½ä»¤**ï¼š`yarn worker:prod` - å•Ÿå‹•èƒŒæ™¯å·¥ä½œç¨‹åº
- **ä¾è³´**ï¼šç­‰å¾… `server-test` å¥åº·æª¢æŸ¥é€šé
- **è³‡æ–™åº«é·ç§»**ï¼šç¦ç”¨ï¼ˆç”± server-test è™•ç†ï¼‰

#### 4. ç’°å¢ƒè®Šæ•¸å®Œæ•´å°ç…§è¡¨

| è®Šæ•¸åç¨± | ç”¨é€” | Docker æ¨¡å¼å€¼ | å¿…éœ€ |
|---------|------|---------------|------|
| `NODE_ENV` | åŸ·è¡Œç’°å¢ƒ | `production` | âœ… |
| `NODE_PORT` | æœå‹™ç«¯å£ | `3000` | âœ… |
| `PG_DATABASE_URL` | è³‡æ–™åº«é€£æ¥å­—ä¸² | `postgres://postgres:test_password_local@db-test:5432/default` | âœ… |
| `REDIS_URL` | Redis é€£æ¥å­—ä¸² | `redis://redis-test:6379` | âœ… |
| `SERVER_URL` | æœå‹™å°å¤– URL | `http://localhost:9999` | âœ… |
| `APP_SECRET` | JWT ç°½åé‡‘é‘° | `test_secret_key_for_local_docker_testing_only` | âœ… |
| `APP_VERSION` | æ‡‰ç”¨ç‰ˆæœ¬ | `0.2.1` | âœ… |
| `LINE_CONFIG_ENCRYPTION_KEY` | LINE é…ç½®åŠ å¯†é‡‘é‘° | `4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17` | âœ… |
| `IS_MULTIWORKSPACE_ENABLED` | å¤šç§Ÿæˆ¶æ¨¡å¼ | `false` | âœ… |
| `DEFAULT_SUBDOMAIN` | é è¨­å­ç¶²åŸŸ | `app` | âœ… |
| `IS_BILLING_ENABLED` | è¨ˆè²»åŠŸèƒ½ | `false` | âŒ |
| `STORAGE_TYPE` | å„²å­˜é¡å‹ | `local` | âœ… |
| `LOG_LEVEL` | æ—¥èªŒç´šåˆ¥ | `info` | âŒ |
| `SIGN_IN_PREFILLED` | è‡ªå‹•å¡«å…¥ç™»å…¥ | `false` | âŒ |

### ğŸš€ å®Œæ•´éƒ¨ç½²æ­¥é©Ÿ

#### æ­¥é©Ÿ 1ï¼šæ§‹å»º Docker æ˜ åƒ

```bash
# Windows (CMD)
cd D:\project\twenty-ym

# Mac / Linux
cd /path/to/twenty-ym

# æ§‹å»ºæ˜ åƒï¼ˆå¤§ç´„ 15-20 åˆ†é˜ï¼‰
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest .

# ä½¿ç”¨ --no-cache å¼·åˆ¶é‡æ–°æ§‹å»ºï¼ˆç•¶é‡åˆ°å¿«å–å•é¡Œæ™‚ï¼‰
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest --no-cache .
```

**æ§‹å»ºéç¨‹ç›£æ§ï¼š**
```bash
# æŸ¥çœ‹æ§‹å»ºé€²åº¦
# Docker æœƒé¡¯ç¤ºæ¯å€‹éšæ®µçš„åŸ·è¡Œç‹€æ…‹

# é æœŸè¼¸å‡ºï¼š
# [1/4] FROM docker.io/library/node:24-alpine
# [2/4] RUN yarn && yarn cache clean
# [3/4] RUN npx nx run twenty-server:build
# [4/4] RUN npx nx build twenty-front
```

**é©—è­‰æ˜ åƒæ§‹å»ºæˆåŠŸï¼š**
```bash
# åˆ—å‡ºæœ¬åœ°æ˜ åƒ
docker images | grep twenty-zh-tw

# é æœŸè¼¸å‡ºï¼š
# twenty-zh-tw   latest   <image-id>   X minutes ago   XXX MB
```

#### æ­¥é©Ÿ 2ï¼šæº–å‚™è³‡æ–™ç›®éŒ„

```bash
# Windows (CMD)
cd deployment
mkdir local-test\data\postgres
mkdir local-test\data\redis
mkdir local-test\data\server-storage

# Mac / Linux
cd deployment
mkdir -p local-test/data/postgres
mkdir -p local-test/data/redis
mkdir -p local-test/data/server-storage

# è¨­å®šæ¬Šé™ï¼ˆMac / Linuxï¼‰
chmod -R 755 local-test/data/
```

#### æ­¥é©Ÿ 3ï¼šå•Ÿå‹•æœå‹™

```bash
# å¾å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œ
cd D:\project\twenty-ym  # Windows
cd /path/to/twenty-ym    # Mac/Linux

# å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆå‰å°æ¨¡å¼ï¼Œå¯æŸ¥çœ‹æ—¥èªŒï¼‰
docker compose -f deployment/docker-compose.local-test.yml up

# æˆ–ä½¿ç”¨èƒŒæ™¯æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
docker compose -f deployment/docker-compose.local-test.yml up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker compose -f deployment/docker-compose.local-test.yml ps

# é æœŸè¼¸å‡ºï¼š
# NAME                   STATUS              PORTS
# twenty-db-test         Up (healthy)        127.0.0.1:15432->5432/tcp
# twenty-redis-test      Up (healthy)        127.0.0.1:16379->6379/tcp
# twenty-server-test     Up (healthy)        0.0.0.0:9999->3000/tcp, 9229/tcp
# twenty-worker-test     Up                  -
```

#### æ­¥é©Ÿ 4ï¼šæŸ¥çœ‹æ—¥èªŒ

```bash
# æŸ¥çœ‹æ‰€æœ‰æœå‹™æ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœå‹™æ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs -f server-test
docker compose -f deployment/docker-compose.local-test.yml logs -f worker-test
docker compose -f deployment/docker-compose.local-test.yml logs -f db-test

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs --tail=100
```

**é—œéµæ—¥èªŒæª¢æŸ¥é»ï¼š**

1. **è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼š**
   ```
   twenty-db-test | PostgreSQL init process complete; ready for start up.
   ```

2. **Server å•Ÿå‹•æˆåŠŸï¼š**
   ```
   twenty-server-test | Server is running on http://localhost:3000
   twenty-server-test | GraphQL Playground: http://localhost:3000/graphql
   ```

3. **Worker å•Ÿå‹•æˆåŠŸï¼š**
   ```
   twenty-worker-test | Worker started successfully
   ```

#### æ­¥é©Ÿ 5ï¼šé©—è­‰éƒ¨ç½²

```bash
# 1. å¥åº·æª¢æŸ¥
curl http://localhost:9999/healthz

# é æœŸè¼¸å‡ºï¼š
# {"status":"ok"}

# 2. GraphQL Playgroundï¼ˆä½¿ç”¨ç€è¦½å™¨ï¼‰
# è¨ªå•ï¼šhttp://localhost:9999/graphql

# 3. å‰ç«¯æ‡‰ç”¨ï¼ˆä½¿ç”¨ç€è¦½å™¨ï¼‰
# è¨ªå•ï¼šhttp://localhost:9999
```

**é©—è­‰æª¢æŸ¥æ¸…å–®ï¼š**
- âœ… ç€è¦½å™¨èƒ½è¨ªå• `http://localhost:9999`
- âœ… çœ‹åˆ° Twenty CRM ç™»å…¥é é¢
- âœ… ä»‹é¢ç‚ºä¸­æ–‡
- âœ… å¯ä»¥ç™»å…¥ç³»çµ±
- âœ… è³‡æ–™åº«é€£æ¥æ­£å¸¸
- âœ… Redis é€£æ¥æ­£å¸¸

#### æ­¥é©Ÿ 6ï¼šåœæ­¢æœå‹™

```bash
# åœæ­¢æ‰€æœ‰æœå‹™ï¼ˆä¿ç•™è³‡æ–™ï¼‰
docker compose -f deployment/docker-compose.local-test.yml down

# åœæ­¢ä¸¦åˆªé™¤æ‰€æœ‰è³‡æ–™ï¼ˆå®Œå…¨æ¸…ç†ï¼‰
docker compose -f deployment/docker-compose.local-test.yml down -v
rm -rf deployment/local-test/data/  # Mac/Linux
rmdir /s deployment\local-test\data\  # Windows
```

### ğŸ“Š ç«¯å£ä½¿ç”¨ç¸½è¦½

| æœå‹™ | å®¹å™¨å…§éƒ¨ç«¯å£ | å°å¤–ç«¯å£ | ç”¨é€” |
|------|------------|---------|------|
| **Twenty Server** | 3000 | 9999 | ä¸»æ‡‰ç”¨ï¼ˆå‰ç«¯+å¾Œç«¯ï¼‰ |
| **PostgreSQL** | 5432 | 15432 | è³‡æ–™åº«ï¼ˆä¾›æœ¬åœ°é–‹ç™¼é€£æ¥ï¼‰ |
| **Redis** | 6379 | 16379 | å¿«å–/ä½‡åˆ—ï¼ˆä¾›æœ¬åœ°é–‹ç™¼é€£æ¥ï¼‰ |
| **Debug** | 9229 | 9229 | Node.js èª¿è©¦ç«¯å£ |
| **Worker** | - | - | ç„¡å°å¤–ç«¯å£ |

### âš ï¸ æ³¨æ„äº‹é …

1. **é¦–æ¬¡å•Ÿå‹•æ™‚é–“**ï¼š
   - è³‡æ–™åº«åˆå§‹åŒ–ï¼šç´„ 30 ç§’
   - Server å•Ÿå‹•ï¼šç´„ 1-2 åˆ†é˜
   - ç¸½å…±ç´„ 2-3 åˆ†é˜

2. **è³‡æ–™æŒä¹…åŒ–**ï¼š
   - è³‡æ–™å„²å­˜åœ¨ `deployment/local-test/data/`
   - åœæ­¢å®¹å™¨ä¸æœƒä¸Ÿå¤±è³‡æ–™
   - ä½¿ç”¨ `down -v` æ‰æœƒåˆªé™¤è³‡æ–™

3. **è¨˜æ†¶é«”ä½¿ç”¨**ï¼š
   - æ‰€æœ‰æœå‹™ç´„ä½”ç”¨ 2-4GB RAM
   - å»ºè­°è‡³å°‘ 8GB ç³»çµ±è¨˜æ†¶é«”

4. **ç£ç¢Ÿç©ºé–“**ï¼š
   - Docker æ˜ åƒï¼šç´„ 2GB
   - è³‡æ–™ç›®éŒ„ï¼šéš¨ä½¿ç”¨å¢é•·

---

## æ¨¡å¼äºŒï¼šæœ¬åœ°é–‹ç™¼æ¨¡å¼

### ğŸ“Œ é©ç”¨å ´æ™¯
- âœ… æ—¥å¸¸é–‹ç™¼å·¥ä½œ
- âœ… å¿«é€Ÿæ¸¬è©¦ç¨‹å¼ç¢¼ä¿®æ”¹
- âœ… ä½¿ç”¨ Hot Reload åŠŸèƒ½
- âœ… IDE é™¤éŒ¯æ”¯æ´
- âŒ ä¸é©åˆæ¸¬è©¦ Docker éƒ¨ç½²

### ğŸ”§ æ‰€éœ€æª”æ¡ˆèˆ‡è¨­å®š

#### 1. æ ¸å¿ƒæª”æ¡ˆæ¸…å–®

| æª”æ¡ˆè·¯å¾‘ | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|---------|------|---------|
| `packages/twenty-server/.env.local` | å¾Œç«¯ç’°å¢ƒè®Šæ•¸ | âœ… å¿…éœ€ |
| `packages/twenty-front/.env.local` | å‰ç«¯ç’°å¢ƒè®Šæ•¸ | âœ… å¿…éœ€ |
| `package.json` | å°ˆæ¡ˆè…³æœ¬å®šç¾© | âœ… å¿…éœ€ |
| `deployment/docker-compose.local-test.yml` | Docker è³‡æ–™åº«é…ç½® | âœ… å¿…éœ€ |

#### 2. å¾Œç«¯ç’°å¢ƒè®Šæ•¸é…ç½®

**ä½ç½®ï¼š** `packages/twenty-server/.env.local`

**å®Œæ•´é…ç½®ï¼š**

```bash
# ==========================================
# æœ¬åœ°é–‹ç™¼æ¨¡å¼ç’°å¢ƒè®Šæ•¸
# ==========================================
# æ­¤é…ç½®ç”¨æ–¼æœ¬åœ°é–‹ç™¼ï¼Œé€£æ¥åˆ° Docker çš„è³‡æ–™åº«å’Œ Redis
# ä¸æœƒå½±éŸ¿ Docker æ¸¬è©¦ç’°å¢ƒçš„é…ç½®
# ==========================================

# ========== åŸ·è¡Œç’°å¢ƒ ==========
NODE_ENV=development

# ========== è³‡æ–™åº«é…ç½® ==========
# é€£æ¥åˆ° Docker çš„è³‡æ–™åº«ï¼ˆç«¯å£ 15432ï¼‰
PG_DATABASE_URL=postgres://postgres:test_password_local@localhost:15432/default

# ========== Redis é…ç½® ==========
# é€£æ¥åˆ° Docker çš„ Redisï¼ˆç«¯å£ 16379ï¼‰
REDIS_URL=redis://localhost:16379

# ========== å®‰å…¨é‡‘é‘° ==========
# æ‡‰ç”¨å¯†é‘°ï¼ˆç”¨æ–¼ JWT ç°½åï¼‰
APP_SECRET=a_super_secret_random_string_for_jwt

# LINE åŠ å¯†é‡‘é‘°ï¼ˆèˆ‡ Docker ç’°å¢ƒç›¸åŒï¼Œç¢ºä¿è³‡æ–™å¯äº’é€šï¼‰
LINE_CONFIG_ENCRYPTION_KEY=dc48fd05bd947bb5d296dd8ed88b200a73bab4e00e59ffe2d5e81b55bdc12c24

# ========== æœå‹™ URL ==========
# å‰ç«¯ URLï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
FRONTEND_URL=http://localhost:3001

# ä¼ºæœå™¨ URL
SERVER_URL=http://localhost:3000

# ========== é–‹ç™¼ä¾¿åˆ©è¨­å®š ==========
# è‡ªå‹•å¡«å……ç™»å…¥è³‡è¨Šï¼ˆé–‹ç™¼ç”¨ï¼‰
SIGN_IN_PREFILLED=true

# ========== ç§Ÿæˆ¶æ¨¡å¼ ==========
IS_MULTIWORKSPACE_ENABLED=false
DEFAULT_SUBDOMAIN=app

# ========== å…¶ä»–é…ç½® ==========
IS_BILLING_ENABLED=false
STORAGE_TYPE=local
LOG_LEVEL=debug
```

**é—œéµé…ç½®èªªæ˜ï¼š**

| è®Šæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| `NODE_ENV` | `development` | é–‹ç™¼ç’°å¢ƒï¼Œå•Ÿç”¨è©³ç´°éŒ¯èª¤è¨Šæ¯ |
| `PG_DATABASE_URL` | `postgres://postgres:test_password_local@localhost:15432/default` | é€£æ¥åˆ° Docker è³‡æ–™åº«çš„ 15432 ç«¯å£ |
| `REDIS_URL` | `redis://localhost:16379` | é€£æ¥åˆ° Docker Redis çš„ 16379 ç«¯å£ |
| `FRONTEND_URL` | `http://localhost:3001` | å‰ç«¯é–‹ç™¼ä¼ºæœå™¨åœ°å€ |
| `SERVER_URL` | `http://localhost:3000` | å¾Œç«¯ API åœ°å€ |
| `SIGN_IN_PREFILLED` | `true` | è‡ªå‹•å¡«å…¥æ¸¬è©¦å¸³è™Ÿå¯†ç¢¼ |
| `LOG_LEVEL` | `debug` | è©³ç´°æ—¥èªŒè¼¸å‡ºï¼Œä¾¿æ–¼é™¤éŒ¯ |

#### 3. å‰ç«¯ç’°å¢ƒè®Šæ•¸é…ç½®

**ä½ç½®ï¼š** `packages/twenty-front/.env.local`

**å®Œæ•´é…ç½®ï¼š**

```bash
# ==========================================
# å‰ç«¯æœ¬åœ°é–‹ç™¼æ¨¡å¼ç’°å¢ƒè®Šæ•¸
# ==========================================
# æ­¤é…ç½®ç”¨æ–¼æœ¬åœ°é–‹ç™¼æ¨¡å¼
# ä¸æœƒå½±éŸ¿ Docker æ¸¬è©¦ç’°å¢ƒçš„é…ç½®
# ==========================================

# ========== å¾Œç«¯ API é…ç½® ==========
# å¾Œç«¯ API URLï¼ˆé€£æ¥åˆ°æœ¬åœ°é–‹ç™¼çš„å¾Œç«¯ï¼‰
VITE_SERVER_BASE_URL=http://localhost:3000

# ========== å‰ç«¯ç«¯å£ ==========
# å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ç«¯å£
PORT=3001
```

**é—œéµé…ç½®èªªæ˜ï¼š**

| è®Šæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| `VITE_SERVER_BASE_URL` | `http://localhost:3000` | å‰ç«¯å‘¼å«å¾Œç«¯ API çš„åŸºç¤ URL |
| `PORT` | `3001` | å‰ç«¯ Vite é–‹ç™¼ä¼ºæœå™¨ç«¯å£ |

#### 4. package.json è…³æœ¬å®šç¾©

**ä½ç½®ï¼š** `package.json`

**dev:local è…³æœ¬ï¼š**

```json
{
  "scripts": {
    "dev:local": "npx cross-env NODE_OPTIONS=\"--max-old-space-size=4096\" concurrently --kill-others \"npx nx start twenty-server\" \"npx nx start twenty-front\" \"npx wait-on tcp:3000 && npx nx worker twenty-server\"",
    "dev:local:server": "npx cross-env NODE_OPTIONS=\"--max-old-space-size=4096\" npx nx start twenty-server",
    "dev:local:front": "npx cross-env NODE_OPTIONS=\"--max-old-space-size=4096\" npx nx start twenty-front",
    "dev:local:worker": "npx wait-on tcp:3000 && npx cross-env NODE_OPTIONS=\"--max-old-space-size=4096\" npx nx worker twenty-server"
  }
}
```

**è…³æœ¬èªªæ˜ï¼š**

| è…³æœ¬ | åŠŸèƒ½ | èªªæ˜ |
|------|------|------|
| `dev:local` | å®Œæ•´å•Ÿå‹• | åŒæ™‚å•Ÿå‹•å¾Œç«¯ã€å‰ç«¯ã€Worker |
| `dev:local:server` | åƒ…å¾Œç«¯ | åƒ…å•Ÿå‹•å¾Œç«¯ API ä¼ºæœå™¨ |
| `dev:local:front` | åƒ…å‰ç«¯ | åƒ…å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ |
| `dev:local:worker` | åƒ… Worker | åƒ…å•Ÿå‹•èƒŒæ™¯å·¥ä½œç¨‹åº |

**æŠ€è¡“ç´°ç¯€ï¼š**
- `cross-env`ï¼šè·¨å¹³å°ç’°å¢ƒè®Šæ•¸è¨­å®š
- `NODE_OPTIONS="--max-old-space-size=4096"`ï¼šè¨­å®š Node.js æœ€å¤§è¨˜æ†¶é«”ç‚º 4GB
- `concurrently --kill-others`ï¼šä¸¦è¡ŒåŸ·è¡Œå¤šå€‹å‘½ä»¤ï¼Œä¸€å€‹å¤±æ•—å‰‡å…¨éƒ¨åœæ­¢
- `wait-on tcp:3000`ï¼šç­‰å¾…å¾Œç«¯å•Ÿå‹•å¾Œå†å•Ÿå‹• Worker

### ğŸš€ å®Œæ•´éƒ¨ç½²æ­¥é©Ÿ

#### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• Docker è³‡æ–™åº«å’Œ Redis

```bash
# Windows (CMD)
cd D:\project\twenty-ym

# Mac / Linux
cd /path/to/twenty-ym

# åƒ…å•Ÿå‹•è³‡æ–™åº«å’Œ Redisï¼ˆèƒŒæ™¯æ¨¡å¼ï¼‰
docker compose -f deployment/docker-compose.local-test.yml up -d db-test redis-test

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker compose -f deployment/docker-compose.local-test.yml ps

# é æœŸè¼¸å‡ºï¼š
# NAME                   STATUS              PORTS
# twenty-db-test         Up (healthy)        127.0.0.1:15432->5432/tcp
# twenty-redis-test      Up (healthy)        127.0.0.1:16379->6379/tcp
```

**é©—è­‰è³‡æ–™åº«å’Œ Redisï¼š**

```bash
# Windows
netstat -ano | findstr :15432
netstat -ano | findstr :16379

# Mac / Linux
lsof -i :15432
lsof -i :16379

# æˆ–ä½¿ç”¨ Docker å‘½ä»¤
docker logs twenty-db-test --tail 20
docker logs twenty-redis-test --tail 20
```

#### æ­¥é©Ÿ 2ï¼šåœæ­¢ Docker ä¸­çš„ Server å’Œ Workerï¼ˆé¿å…ç«¯å£è¡çªï¼‰

```bash
# å¦‚æœä¹‹å‰å•Ÿå‹•éå®Œæ•´çš„ Docker ç’°å¢ƒï¼Œéœ€è¦åœæ­¢ server å’Œ worker
docker compose -f deployment/docker-compose.local-test.yml stop server-test worker-test

# ç¢ºèªå·²åœæ­¢
docker compose -f deployment/docker-compose.local-test.yml ps

# é æœŸè¼¸å‡ºï¼ˆserver-test å’Œ worker-test æ‡‰ç‚º Exited æˆ–ä¸é¡¯ç¤ºï¼‰ï¼š
# NAME                   STATUS              PORTS
# twenty-db-test         Up (healthy)        127.0.0.1:15432->5432/tcp
# twenty-redis-test      Up (healthy)        127.0.0.1:16379->6379/tcp
```

#### æ­¥é©Ÿ 3ï¼šå®‰è£ä¾è³´ï¼ˆé¦–æ¬¡åŸ·è¡Œæˆ– package.json è®Šæ›´å¾Œï¼‰

```bash
# ç¢ºèªåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„
cd D:\project\twenty-ym  # Windows
cd /path/to/twenty-ym    # Mac/Linux

# å®‰è£ä¾è³´ï¼ˆç´„ 5-10 åˆ†é˜ï¼‰
yarn install

# æ¸…ç†å¿«å–ï¼ˆå¯é¸ï¼Œé‡åˆ°å•é¡Œæ™‚åŸ·è¡Œï¼‰
yarn cache clean
npx nx reset
```

**é©—è­‰ä¾è³´å®‰è£ï¼š**
```bash
# æª¢æŸ¥ node_modules æ˜¯å¦å­˜åœ¨
ls node_modules  # Mac/Linux
dir node_modules  # Windows

# æª¢æŸ¥é—œéµå¥—ä»¶
yarn list --pattern "@nestjs/core"
yarn list --pattern "react"
```

#### æ­¥é©Ÿ 4ï¼šå•Ÿå‹•æœ¬åœ°é–‹ç™¼ä¼ºæœå™¨

```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨ yarn è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
yarn dev:local

# æ–¹å¼ 2ï¼šåˆ†åˆ¥å•Ÿå‹•å„æœå‹™ï¼ˆç”¨æ–¼é™¤éŒ¯ï¼‰
# çµ‚ç«¯ 1ï¼šå•Ÿå‹•å¾Œç«¯
yarn dev:local:server

# çµ‚ç«¯ 2ï¼šå•Ÿå‹•å‰ç«¯
yarn dev:local:front

# çµ‚ç«¯ 3ï¼šå•Ÿå‹• Worker
yarn dev:local:worker
```

**å•Ÿå‹•éç¨‹ç›£æ§ï¼š**

1. **å¾Œç«¯å•Ÿå‹•ï¼ˆç´„ 30-60 ç§’ï¼‰ï¼š**
   ```
   [twenty-server] NestJS application successfully started
   [twenty-server] Server is running on http://localhost:3000
   [twenty-server] GraphQL Playground: http://localhost:3000/graphql
   ```

2. **å‰ç«¯å•Ÿå‹•ï¼ˆç´„ 10-20 ç§’ï¼‰ï¼š**
   ```
   [twenty-front] VITE v5.x.x ready in XXX ms
   [twenty-front] âœ  Local:   http://localhost:3001/
   [twenty-front] âœ  Network: use --host to expose
   ```

3. **Worker å•Ÿå‹•ï¼ˆç´„ 10 ç§’ï¼‰ï¼š**
   ```
   [twenty-worker] Worker started successfully
   [twenty-worker] Listening for jobs...
   ```

#### æ­¥é©Ÿ 5ï¼šé©—è­‰é–‹ç™¼ç’°å¢ƒ

```bash
# 1. å¾Œç«¯å¥åº·æª¢æŸ¥
curl http://localhost:3000/healthz

# é æœŸè¼¸å‡ºï¼š
# {"status":"ok"}

# 2. GraphQL Playgroundï¼ˆä½¿ç”¨ç€è¦½å™¨ï¼‰
# è¨ªå•ï¼šhttp://localhost:3000/graphql

# 3. å‰ç«¯æ‡‰ç”¨ï¼ˆä½¿ç”¨ç€è¦½å™¨ï¼‰
# è¨ªå•ï¼šhttp://localhost:3001
```

**é©—è­‰æª¢æŸ¥æ¸…å–®ï¼š**
- âœ… å¾Œç«¯ï¼š`http://localhost:3000` å›æ‡‰æ­£å¸¸
- âœ… å‰ç«¯ï¼š`http://localhost:3001` é¡¯ç¤ºç™»å…¥é é¢
- âœ… è³‡æ–™åº«é€£æ¥æ­£å¸¸ï¼ˆç„¡é€£æ¥éŒ¯èª¤æ—¥èªŒï¼‰
- âœ… Redis é€£æ¥æ­£å¸¸ï¼ˆç„¡é€£æ¥éŒ¯èª¤æ—¥èªŒï¼‰
- âœ… Hot Reload åŠŸèƒ½é‹ä½œï¼ˆä¿®æ”¹ç¨‹å¼ç¢¼å¾Œè‡ªå‹•é‡æ–°è¼‰å…¥ï¼‰

#### æ­¥é©Ÿ 6ï¼šæ¸¬è©¦ Hot Reload

```bash
# 1. ä¿®æ”¹å‰ç«¯æª”æ¡ˆï¼ˆä¾‹å¦‚ä¿®æ”¹æ¨™é¡Œï¼‰
# ç·¨è¼¯ï¼špackages/twenty-front/src/pages/auth/SignInUp.tsx
# ä¿®æ”¹ä»»æ„æ–‡å­—

# 2. è§€å¯Ÿç€è¦½å™¨è‡ªå‹•é‡æ–°è¼‰å…¥

# 3. ä¿®æ”¹å¾Œç«¯æª”æ¡ˆï¼ˆä¾‹å¦‚ä¿®æ”¹ API å›æ‡‰ï¼‰
# ç·¨è¼¯ï¼špackages/twenty-server/src/engine/core-modules/health/health.controller.ts
# ä¿®æ”¹å›æ‡‰å…§å®¹

# 4. è§€å¯Ÿå¾Œç«¯è‡ªå‹•é‡æ–°ç·¨è­¯å’Œé‡å•Ÿ
# çµ‚ç«¯æœƒé¡¯ç¤ºï¼š
# [twenty-server] File change detected. Starting incremental compilation...
# [twenty-server] Successfully compiled
```

#### æ­¥é©Ÿ 7ï¼šåœæ­¢é–‹ç™¼ä¼ºæœå™¨

```bash
# åœ¨åŸ·è¡Œ yarn dev:local çš„çµ‚ç«¯æŒ‰ Ctrl+C

# æˆ–ä½¿ç”¨ Windows å·¥ä½œç®¡ç†å“¡ / Mac Activity Monitor çµæŸ Node.js ç¨‹åº

# åœæ­¢ Docker è³‡æ–™åº«ï¼ˆå¯é¸ï¼‰
docker compose -f deployment/docker-compose.local-test.yml stop db-test redis-test
```

### ğŸ“Š ç«¯å£ä½¿ç”¨ç¸½è¦½

| æœå‹™ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| **å‰ç«¯** | 3001 | Vite é–‹ç™¼ä¼ºæœå™¨ |
| **å¾Œç«¯** | 3000 | NestJS API ä¼ºæœå™¨ |
| **PostgreSQL** | 15432 | Docker è³‡æ–™åº« |
| **Redis** | 16379 | Docker Redis |

### âš ï¸ æ³¨æ„äº‹é …

1. **è³‡æ–™å…±ç”¨**ï¼š
   - æœ¬åœ°é–‹ç™¼æ¨¡å¼ä½¿ç”¨ Docker çš„è³‡æ–™åº«
   - è³‡æ–™èˆ‡ Docker å®Œæ•´éƒ¨ç½²æ¨¡å¼å…±ç”¨
   - ä¿®æ”¹è³‡æ–™åœ¨å…©ç¨®æ¨¡å¼é–“å¯è¦‹

2. **ç’°å¢ƒè®Šæ•¸å„ªå…ˆç´š**ï¼š
   - `.env.local` > `.env.development` > `.env`
   - ç¢ºä¿ `.env.local` å­˜åœ¨ä¸”é…ç½®æ­£ç¢º

3. **è¨˜æ†¶é«”ä½¿ç”¨**ï¼š
   - Node.js è¨­å®šç‚ºæœ€å¤§ 4GB
   - å‰å¾Œç«¯ç´„ä½”ç”¨ 1-2GB RAM
   - å»ºè­°è‡³å°‘ 8GB ç³»çµ±è¨˜æ†¶é«”

4. **ç«¯å£è¡çª**ï¼š
   - ä¸èƒ½åŒæ™‚åŸ·è¡Œ Docker å®Œæ•´æ¨¡å¼å’Œæœ¬åœ°é–‹ç™¼æ¨¡å¼
   - å¿…é ˆå…ˆåœæ­¢ Docker çš„ server-test å’Œ worker-test

5. **é¦–æ¬¡å•Ÿå‹•æ™‚é–“**ï¼š
   - å¾Œç«¯ç·¨è­¯ï¼šç´„ 30-60 ç§’
   - å‰ç«¯ç·¨è­¯ï¼šç´„ 10-20 ç§’
   - ç¸½å…±ç´„ 1-2 åˆ†é˜

6. **Hot Reload é™åˆ¶**ï¼š
   - åƒ…é™ç¨‹å¼ç¢¼ä¿®æ”¹
   - ç’°å¢ƒè®Šæ•¸ä¿®æ”¹éœ€é‡æ–°å•Ÿå‹•
   - package.json ä¿®æ”¹éœ€é‡æ–°åŸ·è¡Œ `yarn install`

---

## æ¨¡å¼åˆ‡æ›

### å¾ Docker æ¨¡å¼åˆ‡æ›åˆ°æœ¬åœ°é–‹ç™¼æ¨¡å¼

```bash
# 1. åœæ­¢ Docker çš„ server å’Œ workerï¼ˆä¿ç•™è³‡æ–™åº«ï¼‰
docker compose -f deployment/docker-compose.local-test.yml stop server-test worker-test

# 2. ç¢ºèªè³‡æ–™åº«å’Œ Redis ä»åœ¨åŸ·è¡Œ
docker compose -f deployment/docker-compose.local-test.yml ps

# 3. å•Ÿå‹•æœ¬åœ°é–‹ç™¼ä¼ºæœå™¨
yarn dev:local

# 4. é©—è­‰
# - å‰ç«¯ï¼šhttp://localhost:3001
# - å¾Œç«¯ï¼šhttp://localhost:3000
```

### å¾æœ¬åœ°é–‹ç™¼æ¨¡å¼åˆ‡æ›åˆ° Docker æ¨¡å¼

```bash
# 1. åœæ­¢æœ¬åœ°é–‹ç™¼ä¼ºæœå™¨
# åœ¨åŸ·è¡Œ yarn dev:local çš„çµ‚ç«¯æŒ‰ Ctrl+C

# 2. å•Ÿå‹• Docker å®Œæ•´ç’°å¢ƒ
docker compose -f deployment/docker-compose.local-test.yml up -d

# 3. é©—è­‰
# - æ‡‰ç”¨ï¼šhttp://localhost:9999
docker compose -f deployment/docker-compose.local-test.yml ps
```

### å®Œå…¨ç¨ç«‹é‹è¡Œï¼ˆä¸å…±ç”¨è³‡æ–™ï¼‰

å¦‚æœéœ€è¦å…©ç¨®æ¨¡å¼ä½¿ç”¨å®Œå…¨ç¨ç«‹çš„è³‡æ–™ï¼š

#### æ–¹å¼ 1ï¼šä½¿ç”¨ä¸åŒçš„è³‡æ–™ç›®éŒ„

```bash
# ä¿®æ”¹ docker-compose.local-test.yml
# å°‡è³‡æ–™ç›®éŒ„æ”¹ç‚ºï¼š
# - ./local-test/data-docker/postgres:/var/lib/postgresql/data
# - ./local-test/data-docker/redis:/data

# æœ¬åœ°é–‹ç™¼æ¨¡å¼é€£æ¥åˆ°ç¨ç«‹çš„è³‡æ–™åº«
# ä¿®æ”¹ packages/twenty-server/.env.local
# PG_DATABASE_URL=postgres://postgres:password@localhost:5432/twenty_dev
```

#### æ–¹å¼ 2ï¼šä½¿ç”¨ä¸åŒçš„ç«¯å£

```bash
# Docker ä½¿ç”¨ 15432ã€16379
# æœ¬åœ°é–‹ç™¼ä½¿ç”¨æœ¬æ©Ÿå®‰è£çš„ PostgreSQLï¼ˆ5432ï¼‰å’Œ Redisï¼ˆ6379ï¼‰
```

---

## ç–‘é›£æ’è§£

### å•é¡Œ 1ï¼šç«¯å£å·²è¢«ä½”ç”¨

#### éŒ¯èª¤è¨Šæ¯
```
Error: listen EADDRINUSE: address already in use :::3000
Port 9999 is already in use
```

#### è§£æ±ºæ–¹æ³•

**Windows:**
```cmd
# æŸ¥çœ‹ä½”ç”¨ 3000 ç«¯å£çš„ç¨‹åº
netstat -ano | findstr :3000

# çµæŸç¨‹åºï¼ˆæ›¿æ› <PID> ç‚ºå¯¦éš›çš„ç¨‹åº IDï¼‰
taskkill /PID <PID> /F

# æˆ–åœæ­¢ Docker çš„ server
docker compose -f deployment/docker-compose.local-test.yml stop server-test
```

**Mac / Linux:**
```bash
# æŸ¥çœ‹ä½”ç”¨ 3000 ç«¯å£çš„ç¨‹åº
lsof -i :3000

# çµæŸç¨‹åºï¼ˆæ›¿æ› <PID> ç‚ºå¯¦éš›çš„ç¨‹åº IDï¼‰
kill -9 <PID>

# æˆ–åœæ­¢ Docker çš„ server
docker compose -f deployment/docker-compose.local-test.yml stop server-test
```

### å•é¡Œ 2ï¼šç„¡æ³•é€£æ¥è³‡æ–™åº«

#### éŒ¯èª¤è¨Šæ¯
```
Error: connect ECONNREFUSED 127.0.0.1:15432
FATAL: password authentication failed for user "postgres"
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. ç¢ºèª Docker è³‡æ–™åº«æ­£åœ¨é‹è¡Œ
docker compose -f deployment/docker-compose.local-test.yml ps

# 2. å¦‚æœè³‡æ–™åº«æœªé‹è¡Œï¼Œå•Ÿå‹•å®ƒ
docker compose -f deployment/docker-compose.local-test.yml up -d db-test

# 3. æª¢æŸ¥è³‡æ–™åº«æ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs db-test

# 4. é©—è­‰é€£æ¥
# Windows
telnet localhost 15432

# Mac / Linux
nc -zv localhost 15432

# 5. ä½¿ç”¨ psql æ¸¬è©¦é€£æ¥
docker exec -it twenty-db-test psql -U postgres -d default

# 6. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢º
# packages/twenty-server/.env.local
# PG_DATABASE_URL=postgres://postgres:test_password_local@localhost:15432/default
```

### å•é¡Œ 3ï¼šDocker æ˜ åƒæ§‹å»ºå¤±æ•—

#### éŒ¯èª¤è¨Šæ¯
```
ERROR [stage-x] RUN npx nx build twenty-front
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. æ¸…ç† Docker å¿«å–
docker builder prune -a

# 2. æ¸…ç†å°ˆæ¡ˆå¿«å–
yarn cache clean
npx nx reset
rm -rf node_modules
yarn install

# 3. ä½¿ç”¨ --no-cache é‡æ–°æ§‹å»º
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest --no-cache .

# 4. æª¢æŸ¥ Docker Desktop è¨˜æ†¶é«”è¨­å®š
# Docker Desktop â†’ Settings â†’ Resources â†’ Memory: è‡³å°‘ 8GB

# 5. å¢åŠ  Node.js è¨˜æ†¶é«”ï¼ˆåœ¨ Dockerfile ä¸­ï¼‰
# ENV NODE_OPTIONS="--max-old-space-size=8192"
```

### å•é¡Œ 4ï¼šç¨‹å¼ç¢¼ä¿®æ”¹æ²’æœ‰ç”Ÿæ•ˆ

#### Docker æ¨¡å¼

```bash
# å¿…é ˆé‡æ–°æ§‹å»ºæ˜ åƒ
docker compose -f deployment/docker-compose.local-test.yml down
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest --no-cache .
docker compose -f deployment/docker-compose.local-test.yml up -d
```

#### æœ¬åœ°é–‹ç™¼æ¨¡å¼

```bash
# 1. æª¢æŸ¥çµ‚ç«¯æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯
# æŸ¥çœ‹ yarn dev:local çš„è¼¸å‡º

# 2. é‡æ–°å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
# Ctrl+C åœæ­¢
yarn dev:local

# 3. æ¸…ç†å¿«å–å¾Œé‡å•Ÿ
yarn cache clean
npx nx reset
yarn dev:local

# 4. æª¢æŸ¥æª”æ¡ˆæ˜¯å¦ä¿å­˜
# ç¢ºèªä¿®æ”¹çš„æª”æ¡ˆå·²ä¿å­˜

# 5. æª¢æŸ¥ç€è¦½å™¨å¿«å–
# Ctrl+Shift+R å¼·åˆ¶é‡æ–°è¼‰å…¥
```

### å•é¡Œ 5ï¼šWorker ç„¡æ³•å•Ÿå‹•

#### éŒ¯èª¤è¨Šæ¯
```
Worker failed to start
Error: Cannot connect to Redis
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. ç¢ºèª Redis æ­£åœ¨é‹è¡Œ
docker compose -f deployment/docker-compose.local-test.yml ps redis-test

# 2. æª¢æŸ¥ Redis é€£æ¥
redis-cli -h localhost -p 16379 ping

# æˆ–ä½¿ç”¨ Docker
docker exec -it twenty-redis-test redis-cli ping

# 3. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
# packages/twenty-server/.env.local
# REDIS_URL=redis://localhost:16379

# 4. é‡æ–°å•Ÿå‹• Redis
docker compose -f deployment/docker-compose.local-test.yml restart redis-test

# 5. æª¢æŸ¥ Worker æ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs worker-test
```

### å•é¡Œ 6ï¼šGraphQL Playground ç„¡æ³•è¨ªå•

#### éŒ¯èª¤è¨Šæ¯
```
Cannot GET /graphql
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. ç¢ºèªå¾Œç«¯å·²å•Ÿå‹•
curl http://localhost:3000/healthz  # æœ¬åœ°é–‹ç™¼æ¨¡å¼
curl http://localhost:9999/healthz  # Docker æ¨¡å¼

# 2. æª¢æŸ¥ NODE_ENV è¨­å®š
# GraphQL Playground åƒ…åœ¨é–‹ç™¼æ¨¡å¼å¯ç”¨
# packages/twenty-server/.env.local
# NODE_ENV=development

# 3. æª¢æŸ¥ GraphQL æ¨¡çµ„æ˜¯å¦æ­£ç¢ºè¼‰å…¥
# æŸ¥çœ‹å¾Œç«¯æ—¥èªŒï¼Œæœå°‹ "GraphQL"

# 4. æ¸…ç†å¿«å–å¾Œé‡å•Ÿ
yarn cache clean
npx nx reset
yarn dev:local
```

### å•é¡Œ 7ï¼šè¨˜æ†¶é«”ä¸è¶³

#### éŒ¯èª¤è¨Šæ¯
```
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. å¢åŠ  Node.js è¨˜æ†¶é«”é™åˆ¶
# ä¿®æ”¹ package.json çš„ dev:local è…³æœ¬
# NODE_OPTIONS="--max-old-space-size=8192"

# 2. èª¿æ•´ Docker Desktop è¨˜æ†¶é«”
# Docker Desktop â†’ Settings â†’ Resources â†’ Memory: 12GB

# 3. é—œé–‰ä¸å¿…è¦çš„æ‡‰ç”¨ç¨‹å¼
# é‡‹æ”¾ç³»çµ±è¨˜æ†¶é«”

# 4. åˆ†åˆ¥å•Ÿå‹•æœå‹™ï¼ˆæ¸›å°‘è¨˜æ†¶é«”å³°å€¼ï¼‰
yarn dev:local:server
# ç­‰å¾…å¾Œç«¯å•Ÿå‹•å®Œæˆ
yarn dev:local:front
# ç­‰å¾…å‰ç«¯å•Ÿå‹•å®Œæˆ
yarn dev:local:worker
```

### å•é¡Œ 8ï¼šLINE åŠŸèƒ½ç„¡æ³•ä½¿ç”¨

#### éŒ¯èª¤è¨Šæ¯
```
Error: LINE_CONFIG_ENCRYPTION_KEY is not set
Failed to decrypt LINE config
```

#### è§£æ±ºæ–¹æ³•

```bash
# 1. ç¢ºèªåŠ å¯†é‡‘é‘°å·²è¨­å®š
# Docker æ¨¡å¼ï¼šdeployment/docker-compose.local-test.yml
# LINE_CONFIG_ENCRYPTION_KEY: 4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17

# æœ¬åœ°é–‹ç™¼æ¨¡å¼ï¼špackages/twenty-server/.env.local
# LINE_CONFIG_ENCRYPTION_KEY=dc48fd05bd947bb5d296dd8ed88b200a73bab4e00e59ffe2d5e81b55bdc12c24

# 2. ç”Ÿæˆæ–°çš„åŠ å¯†é‡‘é‘°ï¼ˆå¦‚æœéœ€è¦ï¼‰
# Mac / Linux
openssl rand -hex 32

# Windows
# ä½¿ç”¨ç·šä¸Šå·¥å…·æˆ– Git Bash

# 3. é‡æ–°å•Ÿå‹•æœå‹™
docker compose -f deployment/docker-compose.local-test.yml restart server-test
# æˆ–
yarn dev:local
```

---

## ç’°å¢ƒè®Šæ•¸åƒè€ƒ

### å®Œæ•´ç’°å¢ƒè®Šæ•¸å°ç…§è¡¨

| è®Šæ•¸åç¨± | Docker æ¨¡å¼ | æœ¬åœ°é–‹ç™¼æ¨¡å¼ | èªªæ˜ | å¿…éœ€ |
|---------|------------|-------------|------|------|
| `NODE_ENV` | `production` | `development` | åŸ·è¡Œç’°å¢ƒ | âœ… |
| `NODE_PORT` | `3000` | `3000` | å¾Œç«¯ç«¯å£ï¼ˆå®¹å™¨å…§éƒ¨ï¼‰ | âœ… |
| `PG_DATABASE_URL` | `postgres://postgres:test_password_local@db-test:5432/default` | `postgres://postgres:test_password_local@localhost:15432/default` | è³‡æ–™åº«é€£æ¥ | âœ… |
| `REDIS_URL` | `redis://redis-test:6379` | `redis://localhost:16379` | Redis é€£æ¥ | âœ… |
| `SERVER_URL` | `http://localhost:9999` | `http://localhost:3000` | æœå‹™å°å¤– URL | âœ… |
| `FRONTEND_URL` | - | `http://localhost:3001` | å‰ç«¯ URL | âœ… |
| `APP_SECRET` | `test_secret_key_for_local_docker_testing_only` | `a_super_secret_random_string_for_jwt` | JWT ç°½åé‡‘é‘° | âœ… |
| `APP_VERSION` | `0.2.1` | - | æ‡‰ç”¨ç‰ˆæœ¬ | âŒ |
| `LINE_CONFIG_ENCRYPTION_KEY` | `4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17` | `dc48fd05bd947bb5d296dd8ed88b200a73bab4e00e59ffe2d5e81b55bdc12c24` | LINE é…ç½®åŠ å¯†é‡‘é‘° | âœ… |
| `IS_MULTIWORKSPACE_ENABLED` | `false` | `false` | å¤šç§Ÿæˆ¶æ¨¡å¼ | âœ… |
| `DEFAULT_SUBDOMAIN` | `app` | `app` | é è¨­å­ç¶²åŸŸ | âœ… |
| `IS_BILLING_ENABLED` | `false` | `false` | è¨ˆè²»åŠŸèƒ½ | âŒ |
| `STORAGE_TYPE` | `local` | `local` | å„²å­˜é¡å‹ | âœ… |
| `LOG_LEVEL` | `info` | `debug` | æ—¥èªŒç´šåˆ¥ | âŒ |
| `SIGN_IN_PREFILLED` | `false` | `true` | è‡ªå‹•å¡«å…¥ç™»å…¥ | âŒ |
| `DISABLE_DB_MIGRATIONS` | `true`ï¼ˆåƒ… Workerï¼‰ | - | ç¦ç”¨è³‡æ–™åº«é·ç§» | âŒ |
| `DISABLE_CRON_JOBS_REGISTRATION` | `true`ï¼ˆåƒ… Workerï¼‰ | - | ç¦ç”¨ Cron ä½œæ¥­ | âŒ |

### å‰ç«¯ç’°å¢ƒè®Šæ•¸ï¼ˆåƒ…æœ¬åœ°é–‹ç™¼æ¨¡å¼ï¼‰

| è®Šæ•¸åç¨± | å€¼ | èªªæ˜ |
|---------|---|------|
| `VITE_SERVER_BASE_URL` | `http://localhost:3000` | å¾Œç«¯ API åŸºç¤ URL |
| `PORT` | `3001` | å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ç«¯å£ |

---

## LINE æ•´åˆé…ç½®

### LINE åŠ å¯†é‡‘é‘°è¨­å®š

#### ç‚ºä»€éº¼éœ€è¦åŠ å¯†é‡‘é‘°ï¼Ÿ

LINE Channel Secret å’Œ Access Token æ˜¯æ•æ„Ÿè³‡è¨Šï¼Œå¿…é ˆåŠ å¯†å¾Œå„²å­˜åœ¨è³‡æ–™åº«ä¸­ã€‚åŠ å¯†é‡‘é‘°ç”¨æ–¼åŠ å¯†å’Œè§£å¯†é€™äº›æ•æ„Ÿè³‡æ–™ã€‚

#### å¦‚ä½•ç”ŸæˆåŠ å¯†é‡‘é‘°ï¼Ÿ

```bash
# Mac / Linux
openssl rand -hex 32

# è¼¸å‡ºç¯„ä¾‹ï¼š
# 4530a7c0773e9db17f5b428f58290328e4dc0e8b9fb0239ccf8a6d02035dfa17

# Windowsï¼ˆä½¿ç”¨ Git Bashï¼‰
openssl rand -hex 32

# æˆ–ä½¿ç”¨ç·šä¸Šå·¥å…·ï¼š
# https://generate-random.org/encryption-key-generator
# é¸æ“‡ 256-bit (32 bytes)
```

#### å¦‚ä½•è¨­å®šåŠ å¯†é‡‘é‘°ï¼Ÿ

**Docker æ¨¡å¼ï¼š**

ç·¨è¼¯ `deployment/docker-compose.local-test.yml`ï¼š

```yaml
server-test:
  environment:
    LINE_CONFIG_ENCRYPTION_KEY: your_generated_key_here

worker-test:
  environment:
    LINE_CONFIG_ENCRYPTION_KEY: your_generated_key_here
```

**æœ¬åœ°é–‹ç™¼æ¨¡å¼ï¼š**

ç·¨è¼¯ `packages/twenty-server/.env.local`ï¼š

```bash
LINE_CONFIG_ENCRYPTION_KEY=your_generated_key_here
```

#### âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **é‡‘é‘°é•·åº¦**ï¼šå¿…é ˆæ˜¯ 64 å€‹å­—å…ƒï¼ˆ32 bytes çš„ hex ç·¨ç¢¼ï¼‰
2. **é‡‘é‘°ä¸€è‡´æ€§**ï¼š
   - åŒä¸€ç’°å¢ƒçš„ server å’Œ worker å¿…é ˆä½¿ç”¨ç›¸åŒçš„é‡‘é‘°
   - å¦‚æœè¦åœ¨å…©ç¨®æ¨¡å¼é–“å…±ç”¨è³‡æ–™ï¼Œå¿…é ˆä½¿ç”¨ç›¸åŒçš„é‡‘é‘°
3. **é‡‘é‘°å®‰å…¨**ï¼š
   - ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ä¸åŒçš„é‡‘é‘°
   - ä¸è¦å°‡é‡‘é‘°æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
   - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–å¯†é‘°ç®¡ç†æœå‹™

### LINE Webhook è¨­å®š

#### Webhook URL

**Docker æ¨¡å¼ï¼š**
```
http://localhost:9999/api/v1/webhooks/line
```

**æœ¬åœ°é–‹ç™¼æ¨¡å¼ï¼š**
```
http://localhost:3000/api/v1/webhooks/line
```

**ä½¿ç”¨ ngrok å…¬é–‹æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰ï¼š**

```bash
# å®‰è£ ngrok
# Windows: choco install ngrok
# Mac: brew install ngrok
# Linux: å¾å®˜ç¶²ä¸‹è¼‰

# å•Ÿå‹• ngrokï¼ˆDocker æ¨¡å¼ï¼‰
ngrok http 9999

# æˆ–æœ¬åœ°é–‹ç™¼æ¨¡å¼
ngrok http 3000

# ä½¿ç”¨ ngrok æä¾›çš„ URL
# ä¾‹å¦‚ï¼šhttps://abcd1234.ngrok.io/api/v1/webhooks/line
```

#### åœ¨ LINE Developers è¨­å®š Webhook

1. ç™»å…¥ [LINE Developers Console](https://developers.line.biz/)
2. é¸æ“‡ä½ çš„ Provider å’Œ Channel
3. é€²å…¥ **Messaging API** é ç±¤
4. æ‰¾åˆ° **Webhook settings**
5. è¨­å®š **Webhook URL**ï¼š
   - æœ¬åœ°æ¸¬è©¦ï¼š`https://your-ngrok-url.ngrok.io/api/v1/webhooks/line`
   - ç”Ÿç”¢ç’°å¢ƒï¼š`https://yourdomain.com/api/v1/webhooks/line`
6. å•Ÿç”¨ **Use webhook**
7. é»æ“Š **Verify** æ¸¬è©¦é€£æ¥

### LINE åŠŸèƒ½æ¸¬è©¦æª¢æŸ¥æ¸…å–®

- âœ… LINE Channel IDã€Secretã€Access Token å·²åœ¨ CRM è¨­å®šé é¢å¡«å…¥
- âœ… åŠ å¯†é‡‘é‘°å·²æ­£ç¢ºè¨­å®š
- âœ… Webhook URL å·²åœ¨ LINE Developers Console è¨­å®š
- âœ… Webhook é©—è­‰æ¸¬è©¦é€šé
- âœ… åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿå¥½å‹ï¼ŒPerson è‡ªå‹•å»ºç«‹
- âœ… å°é–å®˜æ–¹å¸³è™Ÿï¼ŒPerson ç‹€æ…‹æ›´æ–°ç‚º blocked
- âœ… Workflow ç™¼é€ LINE è¨Šæ¯åŠŸèƒ½æ­£å¸¸

---

## å…©ç¨®æ¨¡å¼å°æ¯”

| é …ç›® | Docker å®Œæ•´éƒ¨ç½²æ¨¡å¼ | æœ¬åœ°é–‹ç™¼æ¨¡å¼ |
|------|-------------------|-------------|
| **å•Ÿå‹•æ™‚é–“** | 2-3 åˆ†é˜ï¼ˆé¦–æ¬¡æ›´ä¹…ï¼‰ | 1-2 åˆ†é˜ |
| **é‡æ–°æ§‹å»ºæ™‚é–“** | 15-20 åˆ†é˜ | ç„¡éœ€é‡æ–°æ§‹å»º |
| **Hot Reload** | âŒ ç„¡ | âœ… æœ‰ |
| **ç¨‹å¼ç¢¼ä¿®æ”¹** | éœ€é‡æ–°æ§‹å»ºæ˜ åƒ | è‡ªå‹•é‡æ–°è¼‰å…¥ |
| **é™¤éŒ¯ä¾¿åˆ©æ€§** | è¼ƒå›°é›£ï¼ˆéœ€é€£æ¥å®¹å™¨ï¼‰ | å®¹æ˜“ï¼ˆIDE ç›´æ¥é™¤éŒ¯ï¼‰ |
| **è¨˜æ†¶é«”ä½”ç”¨** | 2-4GB | 1-2GB |
| **ç£ç¢Ÿç©ºé–“** | ~2GBï¼ˆæ˜ åƒï¼‰+ è³‡æ–™ | åƒ…è³‡æ–™ |
| **å‰ç«¯ç«¯å£** | 9999 | 3001 |
| **å¾Œç«¯ç«¯å£** | 9999 | 3000 |
| **è³‡æ–™åº«é€£æ¥** | å®¹å™¨å…§éƒ¨ | localhost:15432 |
| **é©ç”¨å ´æ™¯** | éƒ¨ç½²æ¸¬è©¦ã€æœ€çµ‚é©—è­‰ | æ—¥å¸¸é–‹ç™¼ã€å¿«é€Ÿè¿­ä»£ |
| **å„ªé»** | æ¨¡æ“¬ç”Ÿç”¢ç’°å¢ƒã€éƒ¨ç½²é©—è­‰ | å¿«é€Ÿã€ä¾¿åˆ©ã€Hot Reload |
| **ç¼ºé»** | æ…¢ã€ç„¡ Hot Reload | ä¸é©åˆæ¸¬è©¦éƒ¨ç½² |

---

## æ¨è–¦å·¥ä½œæµç¨‹

### æ—¥å¸¸é–‹ç™¼å·¥ä½œæµç¨‹

```bash
# 1. æ—©ä¸Šå•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
docker compose -f deployment/docker-compose.local-test.yml up -d db-test redis-test
yarn dev:local

# 2. é–‹ç™¼å·¥ä½œ
# - ä¿®æ”¹ç¨‹å¼ç¢¼
# - è‡ªå‹•é‡æ–°è¼‰å…¥
# - æ¸¬è©¦åŠŸèƒ½

# 3. æ™šä¸ŠçµæŸå·¥ä½œ
# Ctrl+C åœæ­¢ yarn dev:local
docker compose -f deployment/docker-compose.local-test.yml stop db-test redis-test
```

### æ¸¬è©¦éƒ¨ç½²å·¥ä½œæµç¨‹

```bash
# 1. ç¢ºä¿ç¨‹å¼ç¢¼å·²æäº¤
git add .
git commit -m "..."

# 2. é‡æ–°æ§‹å»º Docker æ˜ åƒ
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest --no-cache .

# 3. å•Ÿå‹• Docker ç’°å¢ƒ
docker compose -f deployment/docker-compose.local-test.yml up -d

# 4. æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
# - è¨ªå• http://localhost:9999
# - æ¸¬è©¦é—œéµåŠŸèƒ½
# - æª¢æŸ¥æ—¥èªŒ

# 5. æ¸¬è©¦å®Œæˆå¾Œåœæ­¢
docker compose -f deployment/docker-compose.local-test.yml down
```

### LINE åŠŸèƒ½é–‹ç™¼å·¥ä½œæµç¨‹

```bash
# 1. ä½¿ç”¨æœ¬åœ°é–‹ç™¼æ¨¡å¼ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
yarn dev:local

# 2. å•Ÿå‹• ngrokï¼ˆç”¨æ–¼ LINE Webhookï¼‰
ngrok http 3000

# 3. åœ¨ LINE Developers Console è¨­å®š Webhook URL
# https://xxxx.ngrok.io/api/v1/webhooks/line

# 4. é–‹ç™¼ LINE åŠŸèƒ½
# - ä¿®æ”¹ç¨‹å¼ç¢¼
# - è‡ªå‹•é‡æ–°è¼‰å…¥
# - æ¸¬è©¦ Webhook

# 5. æœ€çµ‚é©—è­‰ï¼ˆä½¿ç”¨ Docker æ¨¡å¼ï¼‰
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest --no-cache .
docker compose -f deployment/docker-compose.local-test.yml up -d
ngrok http 9999
# é‡æ–°è¨­å®š LINE Webhook URL
# https://yyyy.ngrok.io/api/v1/webhooks/line
```

---

## é™„éŒ„

### A. å¸¸ç”¨å‘½ä»¤å¿«é€Ÿåƒè€ƒ

#### Docker æ¨¡å¼

```bash
# æ§‹å»ºæ˜ åƒ
docker build -f packages/twenty-docker/twenty/Dockerfile -t twenty-zh-tw:latest .

# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker compose -f deployment/docker-compose.local-test.yml up -d

# æŸ¥çœ‹ç‹€æ…‹
docker compose -f deployment/docker-compose.local-test.yml ps

# æŸ¥çœ‹æ—¥èªŒ
docker compose -f deployment/docker-compose.local-test.yml logs -f

# åœæ­¢æœå‹™
docker compose -f deployment/docker-compose.local-test.yml down

# å®Œå…¨æ¸…ç†
docker compose -f deployment/docker-compose.local-test.yml down -v
rm -rf deployment/local-test/data/
```

#### æœ¬åœ°é–‹ç™¼æ¨¡å¼

```bash
# å•Ÿå‹•è³‡æ–™åº«
docker compose -f deployment/docker-compose.local-test.yml up -d db-test redis-test

# åœæ­¢ Docker server
docker compose -f deployment/docker-compose.local-test.yml stop server-test worker-test

# å®‰è£ä¾è³´
yarn install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
yarn dev:local

# åœæ­¢é–‹ç™¼ä¼ºæœå™¨
Ctrl+C
```

### B. æª”æ¡ˆçµæ§‹åƒè€ƒ

```
twenty-ym/
â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ docker-compose.local-test.yml         # Docker Compose é…ç½®
â”‚   â””â”€â”€ local-test/
â”‚       â””â”€â”€ data/                              # è³‡æ–™æŒä¹…åŒ–ç›®éŒ„
â”‚           â”œâ”€â”€ postgres/                      # PostgreSQL è³‡æ–™
â”‚           â”œâ”€â”€ redis/                         # Redis è³‡æ–™
â”‚           â””â”€â”€ server-storage/                # æª”æ¡ˆå„²å­˜
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ twenty-docker/
â”‚   â”‚   â””â”€â”€ twenty/
â”‚   â”‚       â”œâ”€â”€ Dockerfile                     # Docker æ˜ åƒæ§‹å»ºæª”æ¡ˆ
â”‚   â”‚       â””â”€â”€ entrypoint.sh                  # å®¹å™¨å•Ÿå‹•è…³æœ¬
â”‚   â”œâ”€â”€ twenty-server/
â”‚   â”‚   â”œâ”€â”€ .env.local                         # å¾Œç«¯ç’°å¢ƒè®Šæ•¸ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ .env.example                       # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ twenty-front/
â”‚       â”œâ”€â”€ .env.local                         # å‰ç«¯ç’°å¢ƒè®Šæ•¸ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
â”‚       â”œâ”€â”€ .env.example                       # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ package.json                                # å°ˆæ¡ˆæ ¹ package.json
â”œâ”€â”€ yarn.lock
â””â”€â”€ æœ¬åœ°é–‹ç™¼æ¨¡å¼èªªæ˜.md                        # é–‹ç™¼æ¨¡å¼èªªæ˜æ–‡ä»¶
```

### C. æ•ˆèƒ½å„ªåŒ–å»ºè­°

1. **Docker æ§‹å»ºå„ªåŒ–**ï¼š
   - ä½¿ç”¨ `.dockerignore` æ’é™¤ä¸å¿…è¦çš„æª”æ¡ˆ
   - åˆ©ç”¨å¤šéšæ®µæ§‹å»ºæ¸›å°‘æ˜ åƒå¤§å°
   - ä½¿ç”¨å¿«å–åŠ é€Ÿæ§‹å»º

2. **æœ¬åœ°é–‹ç™¼å„ªåŒ–**ï¼š
   - å¢åŠ  Node.js è¨˜æ†¶é«”é™åˆ¶
   - ä½¿ç”¨ SSD ç¡¬ç¢Ÿæå‡ I/O æ•ˆèƒ½
   - é—œé–‰ä¸å¿…è¦çš„ç€è¦½å™¨å¤–æ›

3. **è³‡æ–™åº«å„ªåŒ–**ï¼š
   - å®šæœŸæ¸…ç†æ¸¬è©¦è³‡æ–™
   - ä½¿ç”¨ `VACUUM` å„ªåŒ– PostgreSQL
   - èª¿æ•´ PostgreSQL é…ç½®ï¼ˆshared_buffersã€work_memï¼‰

### D. å®‰å…¨æ€§æ³¨æ„äº‹é …

1. **ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²**ï¼š
   - âŒ ä¸è¦ä½¿ç”¨æ¸¬è©¦ç”¨çš„ `APP_SECRET`
   - âŒ ä¸è¦ä½¿ç”¨ç°¡å–®çš„è³‡æ–™åº«å¯†ç¢¼
   - âœ… ä½¿ç”¨å¼·å¯†ç¢¼å’Œå®‰å…¨çš„é‡‘é‘°
   - âœ… å•Ÿç”¨ HTTPS
   - âœ… ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ç®¡ç†æ•æ„Ÿè³‡è¨Š

2. **LINE æ•´åˆå®‰å…¨**ï¼š
   - âœ… ä½¿ç”¨ç¨ç«‹çš„åŠ å¯†é‡‘é‘°
   - âœ… ä¸è¦å°‡é‡‘é‘°æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - âœ… å®šæœŸæ›´æ› Access Token
   - âœ… é©—è­‰ Webhook ç°½ç« 

3. **å®¹å™¨å®‰å…¨**ï¼š
   - âœ… ä½¿ç”¨é root ä½¿ç”¨è€…åŸ·è¡Œï¼ˆuid 1000ï¼‰
   - âœ… å®šæœŸæ›´æ–°åŸºç¤æ˜ åƒ
   - âœ… æƒææ˜ åƒæ¼æ´

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** 1.0
**æœ€å¾Œæ›´æ–°ï¼š** 2024-12-11
**ç¶­è­·è€…ï¼š** Twenty CRM é–‹ç™¼åœ˜éšŠ
