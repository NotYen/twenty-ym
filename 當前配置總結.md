# Twenty CRM 當前配置總結

**更新時間**: 2025-10-15  
**配置模式**: 單租戶模式 (Single Tenant)

---

## ✅ 已完成的配置

### 1. 多租戶模式
- **狀態**: ❌ 已關閉
- **配置**: `IS_MULTIWORKSPACE_ENABLED=false`
- **說明**: 系統不再使用子域名區分不同 workspace

### 2. 網路配置
- **域名服務**: ✅ 保留 nip.io
- **外部訪問**: ⚠️ 僅支援區域網路（未設置 Port Forwarding）
- **配置**: `EXTERNAL_HOST="118.168.188.27.nip.io"`

### 3. 服務狀態
- ✅ PostgreSQL: 運行中 (端口 5432)
- ✅ Redis: 運行中 (端口 6379)
- ✅ 後端 API: 運行中 (端口 8867)
- ✅ 前端 Web: 運行中 (端口 8866)
- ✅ Worker: 運行中

---

## 🌐 訪問方式

### 本機訪問（推薦）
```
http://localhost:8866
```
**說明**: 最快速、最穩定的訪問方式

### 區域網路訪問（同一 WiFi 內）
```
http://118.168.188.27:8866
或
http://118.168.188.27.nip.io:8866
```
**說明**: 
- ✅ 同一 WiFi 內的其他設備（手機、平板、其他電腦）可以訪問
- ✅ 適合內部測試和展示

### 外部網路訪問
```
❌ 目前不支援
```
**說明**: 
- 未設置路由器 Port Forwarding
- 如需外部訪問，需要額外配置

---

## 📊 系統架構

```
單租戶模式架構:
┌─────────────────────────────────────┐
│         Twenty CRM 實例             │
│  (所有用戶共用一個 workspace)        │
├─────────────────────────────────────┤
│  前端 Web    │  http://localhost:8866   │
│  後端 API    │  http://localhost:8867   │
│  資料庫      │  PostgreSQL:5432         │
│  快取        │  Redis:6379              │
└─────────────────────────────────────┘

訪問方式:
本機         → localhost:8866
區域網路     → 118.168.188.27:8866
外部網路     → ❌ 不支援（需要額外設置）
```

---

## 💡 使用場景

### 適合的場景
✅ **企業內部使用** - 所有員工使用同一個系統  
✅ **本地開發測試** - 開發和測試新功能  
✅ **小團隊協作** - 5-50 人的團隊使用  
✅ **區域網路展示** - 內部會議或演示  

### 不適合的場景
❌ **SaaS 多租戶服務** - 需要多個獨立 workspace  
❌ **遠程外部訪問** - 需要從任何地方訪問  
❌ **多客戶隔離** - 每個客戶需要獨立實例  

---

## 🔧 常用命令

### 啟動服務
```bash
cd /Users/ym/twenty-ym
bash start_all_service_start.sh
```

### 停止服務
```bash
cd /Users/ym/twenty-ym
bash ./stop-twenty-local.sh
```

### 重啟服務
```bash
cd /Users/ym/twenty-ym
bash ./stop-twenty-local.sh
sleep 3
bash start_all_service_start.sh
```

### 查看日誌
```bash
tail -f /Users/ym/twenty-ym/twenty.log
```

### 檢查服務狀態
```bash
# 後端配置
curl -s "http://localhost:8867/client-config" | python3 -m json.tool

# 後端健康檢查
curl http://localhost:8867/healthz

# 前端狀態
curl -I http://localhost:8866
```

---

## 📁 重要文件位置

### 配置文件
- **主配置**: `/Users/ym/twenty-ym/twenty-config.sh`
- **後端環境變數**: `/Users/ym/twenty-ym/packages/twenty-server/.env`
- **前端配置**: `/Users/ym/twenty-ym/packages/twenty-front/vite.config.ts`

### 腳本文件
- **啟動腳本**: `/Users/ym/twenty-ym/start_all_service_start.sh`
- **停止腳本**: `/Users/ym/twenty-ym/stop-twenty-local.sh`

### 文檔
- **單租戶說明**: `/Users/ym/twenty-ym/單租戶模式說明.md`
- **配置總結**: `/Users/ym/twenty-ym/當前配置總結.md` (本文件)

---

## ⚠️ 注意事項

### 1. URL 訪問變化
- ✅ 使用: `http://localhost:8866`
- ✅ 使用: `http://118.168.188.27:8866`
- ❌ 不再使用: `http://apple.118.168.188.27.nip.io:8866` (子域名已停用)

### 2. 資料庫
- 資料庫中可能仍有多個 workspace
- 系統會自動選擇第一個 ACTIVE 的 workspace
- 其他 workspace 不會被使用或影響系統

### 3. 網路安全
- 目前僅區域網路可訪問，安全性較高
- 如需外部訪問，請評估安全風險
- 建議使用 HTTPS 和強密碼

---

## 🚀 未來擴展選項

如果之後需要改變配置：

### 選項 1: 啟用外部訪問
需要設置：
- 路由器 Port Forwarding (8866, 8867)
- 防火牆規則
- 可選：SSL 證書 (HTTPS)

### 選項 2: 恢復多租戶模式
修改配置：
```bash
# twenty-config.sh
export IS_MULTIWORKSPACE_ENABLED="true"

# vite.config.ts
allowedHosts: ['.nip.io', '.localhost', 'localhost']
```

### 選項 3: 使用真實域名
```bash
# twenty-config.sh
export EXTERNAL_HOST="your-domain.com"
```

---

## ✅ 系統狀態

- **多租戶模式**: ❌ 關閉
- **服務狀態**: ✅ 運行中
- **訪問方式**: ✅ 本機 + 區域網路
- **外部訪問**: ❌ 未啟用
- **nip.io**: ✅ 保留（用於區域網路訪問）

---

**配置完成，系統運行穩定！** 🎉

如有任何問題或需要調整配置，請參考：
- `/Users/ym/twenty-ym/單租戶模式說明.md`
- 或隨時尋求協助

