# 2026/01/07-08 é–‹ç™¼ç´€éŒ„èˆ‡å•é¡Œæ’è§£

## ğŸ“… æ™‚é–“ç¯„åœ
- 2026/01/07 (äºŒ)
- 2026/01/08 (ä¸‰)

---

## ğŸ¯ ä¸»è¦å®ŒæˆåŠŸèƒ½

### 1. å ±åƒ¹å–®ç´°é …å‚™è¨»åŠŸèƒ½ (2026/01/08)
**Commit:** `00463ff8a0` - feat: å ±åƒ¹å–®ç´°é …æ–°å¢å‚™è¨»åŠŸèƒ½ã€ç§»é™¤å ±åƒ¹å–® beiZhu æ¬„ä½ã€é»æ“Šå‚™è¨»æ¬„ä½æ‰“é–‹ slide panel

#### åŠŸèƒ½èªªæ˜
- âœ… åœ¨å ±åƒ¹å–®ç´°é … (SalesQuoteLineItem) æ–°å¢å‚™è¨»åŠŸèƒ½
- âœ… ç§»é™¤å ±åƒ¹å–® (SalesQuote) çš„ beiZhu æ¬„ä½ï¼ˆæ”¹ç”¨ç´°é …å‚™è¨»ï¼‰
- âœ… é»æ“Šå‚™è¨»æ¬„ä½æ™‚è‡ªå‹•æ‰“é–‹ slide panel é€²è¡Œç·¨è¼¯
- âœ… å‚™è¨»ä½¿ç”¨ Rich Text Editor æ”¯æ´æ ¼å¼åŒ–æ–‡å­—

#### æŠ€è¡“å¯¦ä½œ
1. **å¾Œç«¯ Metadata ä¿®æ”¹**
   - æ–°å¢ `noteTargets` relation åˆ° `SalesQuoteLineItem`
   - ç§»é™¤ `SalesQuote.beiZhu` æ¬„ä½
   - æ›´æ–° `note-target.workspace-entity.ts` æ”¯æ´å ±åƒ¹å–®ç´°é …

2. **å‰ç«¯ä¿®æ”¹**
   - `ActivityRichTextEditor.tsx`: æ–°å¢ `autoFocus` prop æ”¯æ´è‡ªå‹•èšç„¦
   - `RecordTableCellDisplayMode.tsx`: é»æ“Šå‚™è¨»æ¬„ä½æ™‚æ‰“é–‹ slide panel
   - `useIsRecordFieldReadOnly.ts`: å‚™è¨»æ¬„ä½è¨­ç‚ºå”¯è®€ï¼ˆåªèƒ½é€é slide panel ç·¨è¼¯ï¼‰
   - ç§»é™¤ PDF åŒ¯å‡ºä¸­çš„ beiZhu æ¬„ä½

3. **å½±éŸ¿æª”æ¡ˆ**
   ```
   packages/twenty-server/src/modules/note/standard-objects/note-target.workspace-entity.ts
   packages/twenty-server/src/modules/sales/standard-objects/sales-quote-line-item.workspace-entity.ts
   packages/twenty-server/src/modules/sales/standard-objects/sales-quote.workspace-entity.ts
   packages/twenty-front/src/modules/activities/components/ActivityRichTextEditor.tsx
   packages/twenty-front/src/modules/object-record/record-field/hooks/useIsRecordFieldReadOnly.ts
   packages/twenty-front/src/modules/object-record/record-table/record-table-cell/components/RecordTableCellDisplayMode.tsx
   ```

---

### 2. å‰ç«¯ç¿»è­¯èˆ‡é‡è¤‡åç¨±å»ºè­°å„ªåŒ– (2026/01/08)
**Commit:** `7b1304d4d4` - æ–°å¢å‰ç«¯ç¿»è­¯æ–‡æ¡ˆèˆ‡é‡è¤‡åç¨±å»ºè­°åŠŸèƒ½å„ªåŒ–

#### æ–°å¢ç¿»è­¯
- `Type anything...` â†’ `è¼¸å…¥ä»»ä½•å…§å®¹...`
- `Assign roles to specify access permissions` â†’ `æŒ‡æ´¾è§’è‰²ä»¥è¨­å®šå­˜å–æ¬Šé™`
- `Go to Dashboards` â†’ `å‰å¾€å„€è¡¨æ¿`
- `Go to Workflows` â†’ `å‰å¾€å·¥ä½œæµç¨‹`

#### åŠŸèƒ½å„ªåŒ–
- âœ… å„ªåŒ–é‡è¤‡åç¨±å»ºè­°åŠŸèƒ½çš„ UI/UX
- âœ… ä¿®å¾©å…¨åŸŸæœå°‹ CJK å­—å…ƒå•é¡Œ
- âœ… æ›´æ–°ç›¸é—œèªªæ˜æ–‡æª”

#### å½±éŸ¿æª”æ¡ˆ
```
packages/twenty-front/src/locales/zh-TW.po
packages/twenty-front/src/locales/generated/zh-TW.ts
packages/twenty-front/src/modules/object-record/record-field/meta-types/input/components/DuplicateNameSuggestionDropdown.tsx
packages/twenty-front/src/modules/object-record/record-field/meta-types/input/components/TextFieldInputWithDuplicateSuggestion.tsx
packages/twenty-front/src/modules/object-record/record-table/record-table-cell/components/RecordTitleCellTextFieldInput.tsx
```

---

### 3. å‰ç«¯è¨ˆç®—é‚è¼¯èˆ‡ UI å„ªåŒ– (2026/01/07)
**Commit:** `754aeb0f8a` - fix(å‰ç«¯): ä¿®æ­£å ±åƒ¹å–®è¨ˆç®—é‚è¼¯ã€åˆªé™¤ç¢ºèªå½ˆçª—ã€UI å„ªåŒ–

---

## ğŸ› é‡åˆ°çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: éƒ¨ç½²å¾Œç™»å…¥å¤±æ•— - noteTargets metadata å•é¡Œ

#### ç¾è±¡
- éƒ¨ç½² v1 ç‰ˆæœ¬å¾Œï¼Œç™»å…¥æ™‚å‡ºç¾éŒ¯èª¤
- éŒ¯èª¤è¨Šæ¯èˆ‡ `noteTargets` metadata ç›¸é—œ
- è³‡æ–™åº«ä¸­å­˜åœ¨**é‡è¤‡çš„ noteTarget å’Œ taskTarget** metadataï¼ˆå„æœ‰ 4 ç­†ï¼Œæ‡‰è©²åªæœ‰ 1 ç­†ï¼‰

#### æ ¹æœ¬åŸå› 
ä¿®æ”¹äº† metadataï¼ˆæ–°å¢ noteTargets relationï¼‰ä½†æ²’æœ‰åŸ·è¡Œ sync-metadata å’Œæ¸…é™¤ cache

#### å½±éŸ¿ç¯„åœ
- âœ… **AWS ç’°å¢ƒ**: å·²ä¿®æ­£
- âœ… **æœ¬åœ°ç’°å¢ƒ**: å·²ä¿®æ­£ï¼ˆæœ¬åœ° Docker æ­£åœ¨é‹è¡Œï¼Œä¹Ÿæœ‰ç›¸åŒå•é¡Œï¼‰

---

### è§£æ±ºæ–¹æ¡ˆ - AWS ç’°å¢ƒ

#### 1. åŸ·è¡Œ sync-metadata
```bash
docker compose -f docker-compose.aws.yml exec backend npx nx run twenty-server:command workspace:sync-metadata
```

#### 2. æ¸…é™¤ Redis cache
```bash
docker exec Y-CRM-redis redis-cli FLUSHALL
```

#### 3. é‡å•Ÿæœå‹™ä¸¦é‡æ–°è¨»å†Š CRON jobs
```bash
docker compose -f docker-compose.aws.yml restart backend worker
sleep 15
docker compose -f docker-compose.aws.yml exec backend yarn command:prod cron:register:all
```

#### 4. é©—è­‰ CRON jobs
```bash
docker exec Y-CRM-redis redis-cli KEYS 'bull:cron-queue:repeat:*' | wc -l
```

#### 5. é‡æ–°éƒ¨ç½²
- å»ºç«‹ v2 ç‰ˆæœ¬ image ä¸¦éƒ¨ç½²
- æ›´æ–° `docker-compose.aws.yml` ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼š
  - Backend: `ycrm/y-crm:b_20260108_v2_aws_image`
  - Worker: `ycrm/y-crm:b_20260108_v2_aws_image`
  - Frontend: `ycrm/y-crm:f_20260108_v2_aws_image`

**çµæœ**: âœ… AWS ç’°å¢ƒä¿®æ­£æˆåŠŸ

---

### è§£æ±ºæ–¹æ¡ˆ - æœ¬åœ°ç’°å¢ƒ

#### ç™¼ç¾å•é¡Œ
æª¢æŸ¥æœ¬åœ°ç’°å¢ƒæ™‚ç™¼ç¾ï¼š
- æœ¬åœ° Docker **æ­£åœ¨é‹è¡Œä¸­**
- è³‡æ–™åº«å­˜åœ¨èˆ‡ AWS ç›¸åŒçš„å•é¡Œï¼ˆnoteTarget å’Œ taskTarget å„æœ‰ 4 ç­†é‡è¤‡ï¼‰

#### åŸ·è¡Œä¿®æ­£æ­¥é©Ÿ

##### 1. Sync Metadata
```bash
docker compose -f docker/docker-compose.yml exec backend npx nx run twenty-server:command workspace:sync-metadata
```
**çµæœ**: âœ… æˆåŠŸåŒæ­¥ 4 å€‹ workspace çš„ metadata

##### 2. æ¸…é™¤ Redis Cache
```bash
docker compose -f docker/docker-compose.yml exec redis redis-cli FLUSHALL
```
**çµæœ**: âœ… æˆåŠŸæ¸…é™¤

##### 3. é‡å•Ÿæœå‹™
```bash
docker compose -f docker/docker-compose.yml restart backend worker
```
**çµæœ**: âœ… æˆåŠŸé‡å•Ÿ

##### 4. é‡æ–°è¨»å†Š CRON Jobs
```bash
docker compose -f docker/docker-compose.yml exec backend yarn command:prod cron:register:all
```
**çµæœ**: âœ… æˆåŠŸè¨»å†Š 19 å€‹ CRON jobs
- MessagingMessagesImport
- MessagingMessageListFetch
- MessagingOngoingStale
- MessagingRelaunchFailedMessageChannels
- CalendarEventListFetch
- CalendarEventsImport
- CalendarOngoingStale
- CalendarRelaunchFailedCalendarChannels
- CheckCustomDomainValidRecords
- CheckPublicDomainsValidRecords
- WorkflowCronTrigger
- WorkflowRunEnqueue
- WorkflowHandleStaledRuns
- WorkflowCleanWorkflowRuns
- CronTrigger
- CleanSuspendedWorkspaces
- CleanOnboardingWorkspaces
- TrashCleanup
- TimelineCleanup

##### 5. é©—è­‰ CRON Jobs
```bash
docker compose -f docker/docker-compose.yml exec redis redis-cli KEYS 'bull:cron-queue:repeat:*' | wc -l
```
**çµæœ**: âœ… 38 å€‹ CRON jobsï¼ˆæˆåŠŸï¼‰

**çµæœ**: âœ… æœ¬åœ°ç’°å¢ƒä¿®æ­£æˆåŠŸ

---

### å•é¡Œ 2: CRON Jobs åœ¨ FLUSHALL å¾Œæ¶ˆå¤±

#### ç¾è±¡
åŸ·è¡Œ `FLUSHALL` å¾Œï¼ŒBullMQ çš„ CRON repeatable jobs è¢«æ¸…é™¤

#### è§£æ±ºæ–¹æ¡ˆ
**å¿…é ˆåœ¨ FLUSHALL å¾Œé‡æ–°è¨»å†Š CRON jobs**

```bash
# æ¨™æº–æµç¨‹
docker exec Y-CRM-redis redis-cli FLUSHALL
docker compose restart backend worker
sleep 10
docker compose exec backend yarn command:prod cron:register:all
```

#### é é˜²æªæ–½
- éƒ¨ç½²è…³æœ¬ (`deploy-to-aws.sh`, `run-local.sh`) å·²åŒ…å«è‡ªå‹•é‡æ–°è¨»å†Šé‚è¼¯
- æ‰‹å‹•åŸ·è¡Œ FLUSHALL æ™‚å‹™å¿…è¨˜å¾—é‡æ–°è¨»å†Š

---

## ğŸ“Š æœ¬åœ° vs AWS ç’°å¢ƒå·®ç•°

| é …ç›® | AWS ç’°å¢ƒ | æœ¬åœ°ç’°å¢ƒ |
|------|---------|---------|
| Docker Image | ä½¿ç”¨é å»º image (éœ€æ‰‹å‹•æ›´æ–°ç‰ˆæœ¬è™Ÿ) | å³æ™‚ build (è‡ªå‹•ä½¿ç”¨æœ€æ–°ç¨‹å¼ç¢¼) |
| å•Ÿå‹•æ–¹å¼ | `docker-compose.aws.yml` | `docker-compose.yml` + `run-local.sh` |
| Metadata åŒæ­¥ | éœ€æ‰‹å‹•åŸ·è¡Œ | å•Ÿå‹•è…³æœ¬å·²åŒ…å«ï¼ˆä½†é‹è¡Œä¸­éœ€æ‰‹å‹•åŸ·è¡Œï¼‰ |
| Cache æ¸…é™¤ | éœ€æ‰‹å‹•åŸ·è¡Œ | å•Ÿå‹•è…³æœ¬å·²åŒ…å«ï¼ˆä½†é‹è¡Œä¸­éœ€æ‰‹å‹•åŸ·è¡Œï¼‰ |
| CRON è¨»å†Š | éœ€æ‰‹å‹•åŸ·è¡Œ | å•Ÿå‹•è…³æœ¬å·²åŒ…å«ï¼ˆä½†é‹è¡Œä¸­éœ€æ‰‹å‹•åŸ·è¡Œï¼‰ |
| éƒ¨ç½²æµç¨‹ | éœ€è¦ build â†’ push â†’ pull â†’ restart | ç›´æ¥ build â†’ restart |
| æœ¬æ¬¡å•é¡Œ | âœ… å·²ä¿®æ­£ | âœ… å·²ä¿®æ­£ |

---

## ğŸ“ é‡è¦å­¸ç¿’èˆ‡æœ€ä½³å¯¦è¸

### 1. Metadata ä¿®æ”¹å®Œæ•´æµç¨‹
ç•¶ä¿®æ”¹ metadataï¼ˆæ–°å¢æ¬„ä½ã€relationã€ä¿®æ”¹ labelï¼‰æ™‚ï¼š

```bash
# 1. sync-metadata
docker exec Y-CRM-backend npx nx run twenty-server:command workspace:sync-metadata

# 2. æ¸…é™¤ cache
docker exec Y-CRM-redis redis-cli FLUSHALL

# 3. é‡å•Ÿ + è¨»å†Š CRON
docker compose restart backend worker
sleep 10
docker compose exec backend yarn command:prod cron:register:all
```

### 2. ä»€éº¼æ™‚å€™éœ€è¦ sync-metadataï¼Ÿ

| æƒ…æ³ | éœ€è¦ sync |
|------|----------|
| æ–°å¢ Standard Object (@WorkspaceEntity) | âœ… |
| æ–°å¢æ¬„ä½ (@WorkspaceField) | âœ… |
| ä¿®æ”¹æ¬„ä½é¡å‹ (FieldMetadataType) | âœ… |
| æ–°å¢é—œè¯ (@WorkspaceRelation) | âœ… |
| ä¿®æ”¹ labelï¼ˆç¨‹å¼ç¢¼ä¸­ï¼‰ | âœ… |
| å‡ç´š Twenty ç‰ˆæœ¬ | âœ… |
| ä¿®æ”¹å‰ç«¯ UI | âŒ |
| ä¿®æ”¹ API é‚è¼¯ | âŒ |

### 3. ä»€éº¼æ™‚å€™éœ€è¦æ¸…é™¤ Redis Cacheï¼Ÿ

| æƒ…å¢ƒ | éœ€è¦æ¸…é™¤ |
|------|---------|
| ä¿®æ”¹ i18n ç¿»è­¯ï¼ˆlabelPluralã€labelSingularï¼‰ | âœ… |
| ä¿®æ”¹ object metadata çµæ§‹ | âœ… |
| ä¿®æ”¹ GraphQL schema | âœ… |
| éƒ¨ç½²å¾Œç™¼ç¾èˆŠè³‡æ–™é‚„åœ¨é¡¯ç¤º | âœ… |
| ä¸€èˆ¬ç¨‹å¼ç¢¼ä¿®æ”¹ | âŒ |
| åªä¿®æ”¹å‰ç«¯ UI | âŒ |

### 4. å‚™è¨»åŠŸèƒ½è¨­è¨ˆæ¨¡å¼
- ä½¿ç”¨ `noteTargets` relation é€£æ¥ä»»ä½•éœ€è¦å‚™è¨»çš„ entity
- å‚™è¨»æ¬„ä½åœ¨ table view è¨­ç‚ºå”¯è®€
- é»æ“Šå‚™è¨»æ¬„ä½æ™‚æ‰“é–‹ slide panel é€²è¡Œç·¨è¼¯
- ä½¿ç”¨ Rich Text Editor æä¾›æ ¼å¼åŒ–åŠŸèƒ½

---

## ğŸš€ éƒ¨ç½²è¨˜éŒ„

### 2026/01/08 éƒ¨ç½²
- **ç‰ˆæœ¬**: v2
- **Image Tags**:
  - Backend: `ycrm/y-crm:b_20260108_v2_aws_image`
  - Worker: `ycrm/y-crm:b_20260108_v2_aws_image`
  - Frontend: `ycrm/y-crm:f_20260108_v2_aws_image`
- **ç‹€æ…‹**: âœ… æˆåŠŸ
- **å‚™è¨»**: ä¿®å¾© noteTargets metadata å•é¡Œå¾Œé‡æ–°éƒ¨ç½²

---

## ğŸ“š ç›¸é—œæ–‡ä»¶æ›´æ–°
- `docker/dev-flow/docs/features/DUPLICATE_NAME_SUGGESTION.md` - é‡è¤‡åç¨±å»ºè­°åŠŸèƒ½èªªæ˜
- `docker/dev-flow/docs/features/GLOBAL_SEARCH_CJK_FIX.md` - å…¨åŸŸæœå°‹ CJK ä¿®å¾©èªªæ˜
- `docker/dev-flow/docs/troubleshooting/LINGUI_I18N_GUIDE.md` - i18n ç¿»è­¯æŒ‡å—

---

## âœ… Checklist for Next Deployment

éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®ï¼š

- [ ] æ˜¯å¦ä¿®æ”¹äº† metadataï¼Ÿâ†’ éœ€è¦ sync-metadata
- [ ] æ˜¯å¦ä¿®æ”¹äº† i18n ç¿»è­¯ï¼Ÿâ†’ éœ€è¦æ¸…é™¤ cache
- [ ] æ˜¯å¦ä¿®æ”¹äº† GraphQL schemaï¼Ÿâ†’ éœ€è¦æ¸…é™¤ cache
- [ ] éƒ¨ç½²è…³æœ¬æ˜¯å¦åŒ…å« CRON jobs é‡æ–°è¨»å†Šï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº† docker-compose.yml çš„ image ç‰ˆæœ¬ï¼Ÿ
- [ ] æ˜¯å¦æ¸¬è©¦éæœ¬åœ°ç’°å¢ƒï¼Ÿ

---

## ğŸ”— ç›¸é—œ Commits

```
40c66f0902 - chore: ç§»é™¤æœªä½¿ç”¨çš„ fix-note-targets-metadata.sh è…³æœ¬
5b4df28d4a - chore: æ›´æ–° AWS Docker image ç‰ˆæœ¬è‡³ v2 ä¸¦æ–°å¢ noteTargets metadata ä¿®å¾©è…³æœ¬
00463ff8a0 - feat: å ±åƒ¹å–®ç´°é …æ–°å¢å‚™è¨»åŠŸèƒ½ã€ç§»é™¤å ±åƒ¹å–® beiZhu æ¬„ä½ã€é»æ“Šå‚™è¨»æ¬„ä½æ‰“é–‹ slide panel
7b1304d4d4 - æ–°å¢å‰ç«¯ç¿»è­¯æ–‡æ¡ˆèˆ‡é‡è¤‡åç¨±å»ºè­°åŠŸèƒ½å„ªåŒ–
85705d3d0b - [Modify] Refactor file path and update image version.
754aeb0f8a - fix(å‰ç«¯): ä¿®æ­£å ±åƒ¹å–®è¨ˆç®—é‚è¼¯ã€åˆªé™¤ç¢ºèªå½ˆçª—ã€UI å„ªåŒ–
```
