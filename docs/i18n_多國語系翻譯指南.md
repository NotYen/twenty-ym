# Y-CRM 多國語系 (i18n) 翻譯指南

> 版本：2026-01-10
> 作者：Kiro AI

---

## 概述

Y-CRM 使用 [Lingui](https://lingui.dev/) 作為多國語系框架，支援繁體中文 (zh-TW) 及其他語言。

---

## 翻譯檔案結構

專案中有 **3 個** `zh-TW.po` 檔案，各自負責不同範圍：

| 檔案路徑 | 用途 | 範例 |
|---------|------|------|
| `packages/twenty-front/src/locales/zh-TW.po` | **前端 UI** | 按鈕、標籤、提示訊息、設定頁面文字 |
| `packages/twenty-server/src/engine/core-modules/i18n/locales/zh-TW.po` | **後端 Metadata** | Object 名稱（商機、聯絡人）、欄位標籤 |
| `packages/twenty-emails/src/locales/zh-TW.po` | **Email 模板** | 系統發送的郵件內容 |

---

## 檔案格式說明

### `.po` 檔（翻譯來源）

```po
#: src/pages/settings/workspace/SettingsWorkspaceAdvanced.tsx
msgid "LINE Integration"
msgstr "LINE 整合"
```

- **格式**：PO (Portable Object) - 標準翻譯檔案格式
- **用途**：翻譯人員編輯的檔案
- **結構**：
  - `#:` - 來源檔案位置（自動產生）
  - `msgid` - 英文原文
  - `msgstr` - 翻譯文字（需人工填入）

### `.ts` 檔（編譯後）

```typescript
// generated/zh-TW.ts
export const messages = {
  "LINE Integration": "LINE 整合",
  // ...
}
```

- **格式**：TypeScript
- **用途**：程式執行時載入的翻譯資料
- **產生方式**：`npx lingui compile` 自動產生

---

## 翻譯流程

```
┌─────────────────────────────────────────────────────────────┐
│  1. 程式碼中使用 t`English text`                              │
│     ↓                                                        │
│  2. npx lingui extract  →  提取到 zh-TW.po（msgstr 為空）     │
│     ↓                                                        │
│  3. 人工編輯 zh-TW.po  →  填入 msgstr 翻譯                    │
│     ↓                                                        │
│  4. npx lingui compile  →  產生 zh-TW.ts                     │
│     ↓                                                        │
│  5. 程式執行時載入 zh-TW.ts 顯示翻譯                          │
└─────────────────────────────────────────────────────────────┘
```

### 詳細步驟

#### 步驟 1：程式碼中標記翻譯文字

```typescript
// ✅ 正確：使用 t 函數包裹英文原文
import { t } from '@lingui/core/macro';
const label = t`Possible duplicate records`;

// ❌ 錯誤：直接寫中文（hard code）
const label = "可能重複的記錄";
```

#### 步驟 2：提取翻譯字串

```bash
# 前端翻譯
cd packages/twenty-front
npx lingui extract --clean

# 後端翻譯
cd packages/twenty-server
npx lingui extract --clean
```

執行後會更新 `.po` 檔，新字串的 `msgstr` 會是空的。

#### 步驟 3：編輯翻譯

打開對應的 `zh-TW.po` 檔，找到新增的字串，填入 `msgstr`：

```po
# 修改前
msgid "Configure LINE Official Account credentials for messaging integration."
msgstr ""

# 修改後
msgid "Configure LINE Official Account credentials for messaging integration."
msgstr "設定 LINE 官方帳號憑證以進行訊息整合。"
```

#### 步驟 4：編譯翻譯

```bash
# 前端
cd packages/twenty-front
npx lingui compile

# 後端
cd packages/twenty-server
yarn lingui compile  # 注意：後端用 yarn，不是 npx
```

#### 步驟 5：Commit 檔案

```bash
git add packages/twenty-front/src/locales/zh-TW.po
git add packages/twenty-front/src/locales/generated/zh-TW.ts
git commit -m "新增 LINE 整合設定頁面翻譯"
```

---

## 常見問題

### Q1: 畫面顯示奇怪的 hash key（如 `oEOFSa`）

**原因**：`zh-TW.po` 中該字串的 `msgstr` 是空的

**解決**：
1. 搜尋該 hash key 在 `.po` 檔中的位置
2. 填入 `msgstr` 翻譯
3. 執行 `npx lingui compile`
4. 重新 build

### Q2: 新增的翻譯沒有生效

**檢查清單**：
1. 是否執行了 `lingui extract`？
2. 是否填入了 `msgstr`？
3. 是否執行了 `lingui compile`？
4. 是否 commit 了 `.po` 和 `.ts` 檔案？
5. 是否重新 build？

### Q3: 後端 Object 名稱沒有翻譯

**原因**：後端翻譯需要清除 Redis cache

**解決**：
```bash
docker exec Y-CRM-redis redis-cli FLUSHALL
docker compose restart backend worker
```

---

## 部署注意事項

### Docker Build 自動處理

- **前端**：`yarn nx build` 會自動執行 `lingui compile`
- **後端**：Dockerfile 中已包含 `yarn lingui compile`

### 需要清除 Redis Cache 的情況

| 修改類型 | 需要清 Cache |
|---------|-------------|
| 前端 UI 翻譯 | ❌ 不需要 |
| 後端 Object/欄位 label | ✅ 需要 |

---

## 翻譯工具推薦

- **Crowdin**：線上翻譯平台，支援 `.po` 格式
- **Poedit**：桌面翻譯編輯器
- **VS Code 擴充**：`gettext` 語法高亮

---

## 相關檔案

| 類型 | 檔案路徑 |
|------|---------|
| 前端翻譯來源 | `packages/twenty-front/src/locales/zh-TW.po` |
| 前端翻譯編譯 | `packages/twenty-front/src/locales/generated/zh-TW.ts` |
| 後端翻譯來源 | `packages/twenty-server/src/engine/core-modules/i18n/locales/zh-TW.po` |
| 後端翻譯編譯 | `packages/twenty-server/src/engine/core-modules/i18n/locales/generated/zh-TW.ts` |
| Email 翻譯 | `packages/twenty-emails/src/locales/zh-TW.po` |
| Lingui 設定 | `packages/twenty-front/lingui.config.ts` |

---

## 更新紀錄

| 日期 | 說明 |
|------|------|
| 2026-01-10 | 初版建立 |
