# Frontend Components Documentation

此文件記錄前端功能對應的檔案路徑，方便開發時快速定位相關程式碼。

---

## 模組總覽 (Modules Overview)

位置：`packages/twenty-front/src/modules/`

以下是所有前端模組的用途說明：

### 核心業務模組

| 模組名稱 | 用途說明 |
|---------|---------|
| **companies** | CRM 公司/組織記錄管理 |
| **people** | CRM 聯絡人記錄管理 |
| **opportunities** | 銷售商機與銷售管道追蹤 |
| **activities** | 活動追蹤（任務、筆記、日曆事件、郵件、檔案、時間軸） |
| **attachments** | 活動與記錄的檔案附件處理 |
| **favorites** | 收藏/書籤功能，標記常用記錄和資料夾 |

### 記錄與資料管理

| 模組名稱 | 用途說明 |
|---------|---------|
| **object-metadata** | 物件 Schema Metadata 管理、欄位定義、資料模型設定 |
| **object-record** | 通用記錄顯示與管理（列表視圖、詳情視圖、記錄選擇器、內聯編輯、進階篩選） |
| **views** | 記錄視圖管理（已儲存視圖、篩選、排序、分組） |
| **dashboards** | 儀表板建立、管理與資料視覺化元件 |
| **databases** | 外部資料庫連接與整合管理 |

### 使用者介面元件

| 模組名稱 | 用途說明 |
|---------|---------|
| **ui** | 共用 UI 元件庫（拖放、回饋元件、表單欄位、輸入框、版面元件、導航元素、主題管理） |
| **navigation** | 導航元件（麵包屑、標籤頁、側邊欄導航、路由） |
| **page-layout** | 頁面版面管理（動作、上下文、Hooks、狀態） |
| **action-menu** | 記錄的上下文感知動作選單（單一/多重記錄操作、批次刪除/匯出/合併） |
| **command-menu** | 全域命令面板（Cmd+K / Ctrl+K 快速操作介面） |
| **dropdown-context-state-management** | 可重用的下拉選單狀態管理 |
| **keyboard-shortcut-menu** | 鍵盤快捷鍵註冊與顯示 |
| **information-banner** | 資訊橫幅顯示系統（通知、警告、已刪除記錄提示） |

### 編輯器與輸入

| 模組名稱 | 用途說明 |
|---------|---------|
| **advanced-text-editor** | 富文本編輯器（可調整大小圖片、斜線命令、連結編輯、氣泡選單） |
| **spreadsheet-import** | CSV/試算表匯入功能（欄位對應、欄位選擇、資料驗證） |
| **file** | 檔案上傳、下載與管理工具 |
| **geo-map** | 地理地圖元件，顯示位置相關資料 |

### 認證與授權

| 模組名稱 | 用途說明 |
|---------|---------|
| **auth** | 認證授權（登入/註冊流程、OAuth 整合、Session 管理） |
| **captcha** | CAPTCHA 驗證（Google reCAPTCHA） |
| **sign-in-background-mock** | 登入頁面背景樣式 Mock 元件 |
| **onboarding** | 使用者入門流程與初始設定精靈 |

### 工作區管理

| 模組名稱 | 用途說明 |
|---------|---------|
| **workspace** | 工作區管理、設定、Hooks、狀態與工具 |
| **workspace-member** | 工作區成員管理 |
| **workspace-invitation** | 工作區邀請管理 |
| **domain-manager** | 工作區網域管理（自訂網域、URL 路由） |

### 使用者與帳號

| 模組名稱 | 用途說明 |
|---------|---------|
| **users** | 使用者管理元件、Context、Hooks |
| **accounts** | 電子郵件與日曆帳號連接（Gmail、Microsoft、IMAP/SMTP） |

### 設定與配置

| 模組名稱 | 用途說明 |
|---------|---------|
| **settings** | 應用程式設定（帳號、管理面板、應用程式、資料模型、開發者、網域、整合、成員、角色、安全性、工作區、雙因素認證） |
| **client-config** | 客戶端設定管理、功能旗標 |
| **application-variables** | 應用程式層級變數與設定的 GraphQL 查詢 |
| **localization** | 多語言支援、翻譯狀態管理、語言選擇、國際化工具 |

### 計費與訂閱

| 模組名稱 | 用途說明 |
|---------|---------|
| **billing** | 計費、訂閱與付款功能 |
| **subscription** | 訂閱管理、方案選擇、訂閱狀態顯示 |

### AI 與自動化

| 模組名稱 | 用途說明 |
|---------|---------|
| **ai** | AI 助理介面（Agent Chat、訊息渲染、執行緒管理、CRM 記錄上下文預覽） |
| **workflow** | 工作流程自動化（工作流程設計器、執行、版本控制、流程圖視覺化） |
| **serverless-functions** | Serverless 函數管理介面（建立、部署、監控） |

### 整合與擴展

| 模組名稱 | 用途說明 |
|---------|---------|
| **applications** | 第三方應用程式整合管理 |
| **chrome-extension-sidecar** | Chrome 擴充功能整合與側邊欄元件 |

### 資料層與 API

| 模組名稱 | 用途說明 |
|---------|---------|
| **apollo** | GraphQL Apollo Client 設定、Provider、快取管理工具 |
| **prefetch** | GraphQL 查詢資料預取最佳化 |
| **context-store** | Context 管理與狀態共享工具 |

### 錯誤處理與除錯

| 模組名稱 | 用途說明 |
|---------|---------|
| **error-handler** | 全域錯誤處理、錯誤顯示元件、錯誤恢復工具 |
| **metadata-error-handler** | Metadata 相關錯誤與同步問題的專用錯誤處理 |
| **debug** | 開發除錯工具與元件 |

### 分析與支援

| 模組名稱 | 用途說明 |
|---------|---------|
| **analytics** | Firebase 分析整合與事件追蹤 |
| **support** | 應用程式內支援按鈕與下拉選單 |

### 其他

| 模組名稱 | 用途說明 |
|---------|---------|
| **app** | 主應用程式根元件、Effect 元件、應用程式初始化與生命週期管理 |
| **types** | 全域 TypeScript 型別定義與常數 |

---

## Sidebar (NavigationDrawer)

Sidebar 在此專案中稱為 **NavigationDrawer**。

### 核心組件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| MainNavigationDrawer | `src/modules/navigation/components/MainNavigationDrawer.tsx` | 主側邊欄容器 |
| MainNavigationDrawerFixedItems | `src/modules/navigation/components/MainNavigationDrawerFixedItems.tsx` | 固定項目（Search, Ask AI, Settings） |
| MainNavigationDrawerScrollableItems | `src/modules/navigation/components/MainNavigationDrawerScrollableItems.tsx` | 可捲動項目區域 |
| MainNavigationDrawerUserSection | `src/modules/navigation/components/MainNavigationDrawerUserSection.tsx` | 用戶資訊區塊 |
| SettingsNavigationDrawer | `src/modules/navigation/components/SettingsNavigationDrawer.tsx` | 設定頁側邊欄 |

### UI 基礎組件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| NavigationDrawer | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawer.tsx` | 基礎 Drawer 組件 |
| NavigationDrawerHeader | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerHeader.tsx` | 頭部（工作區名稱 + 收合按鈕） |
| NavigationDrawerItem | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerItem.tsx` | 選單項目 |
| NavigationDrawerSection | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerSection.tsx` | 區塊容器 |
| NavigationDrawerSectionTitle | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerSectionTitle.tsx` | 區塊標題 |
| NavigationDrawerSubItem | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerSubItem.tsx` | 子選單項目 |
| NavigationDrawerFixedContent | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerFixedContent.tsx` | 固定內容區塊 |
| NavigationDrawerScrollableContent | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerScrollableContent.tsx` | 可捲動內容區塊 |
| NavigationDrawerCollapseButton | `src/modules/ui/navigation/navigation-drawer/components/NavigationDrawerCollapseButton.tsx` | 收合按鈕 |

### 物件選單相關

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| NavigationDrawerOpenedSection | `src/modules/object-metadata/components/NavigationDrawerOpenedSection.tsx` | 物件類型選單區塊 |
| NavigationDrawerSectionForObjectMetadataItems | `src/modules/object-metadata/components/NavigationDrawerSectionForObjectMetadataItems.tsx` | 物件 Metadata 選單區塊 |
| NavigationDrawerItemForObjectMetadataItem | `src/modules/object-metadata/components/NavigationDrawerItemForObjectMetadataItem.tsx` | 物件 Metadata 選單項目 |
| RemoteNavigationDrawerSection | `src/modules/object-metadata/components/RemoteNavigationDrawerSection.tsx` | 遠端資料選單區塊 |

### 工作區切換

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| MultiWorkspaceDropdownButton | `src/modules/ui/navigation/navigation-drawer/components/MultiWorkspaceDropdown/MultiWorkspaceDropdownButton.tsx` | 工作區切換下拉按鈕 |

### 視覺結構

```
┌─────────────────────────────────────────────┐
│  NavigationDrawerHeader                     │  ← 工作區名稱 + 收合按鈕
├─────────────────────────────────────────────┤
│  FixedContent:                              │
│    - Search (/)                             │
│    - Ask AI (@)                             │
│    - Settings                               │
├─────────────────────────────────────────────┤
│  ScrollableContent:                         │  ← 可捲動區域
│    - NavigationDrawerOpenedSection          │  ← 物件類型選單
│    - CurrentWorkspaceMemberFavoritesFolders │
│    - WorkspaceFavorites                     │
│    - RemoteNavigationDrawerSection          │
├─────────────────────────────────────────────┤
│  FixedContent:                              │
│    - MainNavigationDrawerUserSection        │  ← 用戶資訊
├─────────────────────────────────────────────┤
│  FixedContent:                              │
│    - SupportDropdown                        │  ← 支援按鈕
└─────────────────────────────────────────────┘
```

### 相關狀態 (Recoil States)

| 狀態名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| isNavigationDrawerExpandedState | `src/modules/ui/navigation/states/isNavigationDrawerExpanded.ts` | 側邊欄展開狀態 |
| currentFavoriteFolderIdState | `src/modules/ui/navigation/navigation-drawer/states/currentFavoriteFolderIdState.ts` | 當前收藏資料夾 ID |
| navigationMemorizedUrlState | `src/modules/ui/navigation/states/navigationMemorizedUrlState.ts` | 記憶的導航 URL |

---

## Settings Navigation

設定頁面的側邊欄導航。

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| SettingsNavigationDrawer | `src/modules/navigation/components/SettingsNavigationDrawer.tsx` | 設定頁側邊欄 |
| SettingsNavigationDrawerItems | `src/modules/settings/components/SettingsNavigationDrawerItems.tsx` | 設定選單項目列表 |
| SettingsNavigationDrawerItem | `src/modules/settings/components/SettingsNavigationDrawerItem.tsx` | 設定選單單一項目 |
| useSettingsNavigationItems | `src/modules/settings/hooks/useSettingsNavigationItems.tsx` | 設定選單項目 Hook |

---

## 看板 (Kanban) 元件

位置：`src/modules/object-record/record-board/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| RecordBoard | `components/RecordBoard.tsx` | 主看板容器元件 |
| RecordBoardColumns | `components/RecordBoardColumns.tsx` | 看板列 |
| RecordBoardHeader | `components/RecordBoardHeader.tsx` | 看板頭部 |
| RecordBoardDragDropContext | `components/RecordBoardDragDropContext.tsx` | 拖放功能 |

### 子目錄

| 目錄 | 說明 |
|-----|------|
| `record-board-card/` | 看板卡片相關元件 |
| `record-board-column/` | 看板列相關元件 |

---

## 圖表 (Chart) 元件

位置：`src/modules/page-layout/widgets/graph/`

### 通用圖表元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidget | `components/GraphWidget.tsx` | 圖表主元件 |
| GraphWidgetChartContainer | `components/GraphWidgetChartContainer.tsx` | 圖表容器 |
| GraphWidgetLegend | `components/GraphWidgetLegend.tsx` | 圖表圖例 |
| GraphWidgetRenderer | `components/GraphWidgetRenderer.tsx` | 圖表渲染器 |
| GraphWidgetFloatingTooltip | `components/GraphWidgetFloatingTooltip.tsx` | 浮動提示框 |
| GraphDataLabel | `components/GraphDataLabel.tsx` | 數據標籤 |

### 圓餅圖 (Pie Chart)

位置：`graphWidgetPieChart/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidgetPieChart | `components/GraphWidgetPieChart.tsx` | 圓餅圖主元件 (使用 @nivo/pie) |
| GraphWidgetPieChartRenderer | `components/GraphWidgetPieChartRenderer.tsx` | 圓餅圖渲染器 |
| GraphPieChartTooltip | `components/GraphPieChartTooltip.tsx` | 圓餅圖提示框 |
| PieChartEndLines | `components/PieChartEndLines.tsx` | 圓餅圖末尾線條 |

**Hooks：**

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| usePieChartData | `hooks/usePieChartData.ts` | 處理圓餅圖數據 |
| usePieChartHandlers | `hooks/usePieChartHandlers.ts` | 處理滑鼠事件 |
| useGraphPieChartWidgetData | `hooks/useGraphPieChartWidgetData.ts` | 提取圖表數據 |
| usePieChartSliceRecords | `hooks/usePieChartSliceRecords.ts` | 處理圓餅切片記錄 |

### 柱狀圖 (Bar Chart)

位置：`graphWidgetBarChart/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidgetBarChart | `components/GraphWidgetBarChart.tsx` | 柱狀圖主元件 |

### 折線圖 (Line Chart)

位置：`graphWidgetLineChart/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidgetLineChart | `components/GraphWidgetLineChart.tsx` | 折線圖主元件 |

### 量表圖 (Gauge Chart)

位置：`graphWidgetGaugeChart/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidgetGaugeChart | `components/GraphWidgetGaugeChart.tsx` | 量表圖主元件 |

### 聚合圖表 (Aggregate Chart)

位置：`graphWidgetAggregateChart/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| GraphWidgetAggregateChart | `components/GraphWidgetAggregateChart.tsx` | 聚合圖表 (顯示單一值、趨勢百分比) |

---

## 圖表設定 (Chart Settings)

位置：`src/modules/command-menu/pages/page-layout/`

### 設定常數

| 檔案路徑 | 說明 |
|---------|------|
| `constants/PieChartSettings.ts` | 圓餅圖設定組 |
| `constants/LineChartSettings.ts` | 折線圖設定組 |
| `constants/settings/DateGranularitySetting.ts` | 日期粒度設定 (圓餅圖) |
| `constants/settings/DateGranularityXSetting.ts` | X軸日期粒度設定 |
| `constants/settings/DateGranularityYSetting.ts` | Y軸日期粒度設定 |

### 日期粒度 (Date Granularity)

**下拉選單元件：**

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| ChartDateGranularitySelectionDropdownContent | `components/dropdown-content/ChartDateGranularitySelectionDropdownContent.tsx` | 主下拉選單 |
| ChartDateGranularityXSelectionDropdownContent | `components/dropdown-content/ChartDateGranularityXSelectionDropdownContent.tsx` | X軸粒度選項 |
| ChartDateGranularityYSelectionDropdownContent | `components/dropdown-content/ChartDateGranularityYSelectionDropdownContent.tsx` | Y軸粒度選項 |

**工具函數：**

| 檔案路徑 | 說明 |
|---------|------|
| `utils/getDateGranularityLabel.ts` | 獲取粒度標籤 |
| `graph/utils/formatDateByGranularity.ts` | 根據粒度格式化日期 |
| `graph/constants/GraphDefaultDateGranularity.constant.ts` | 預設日期粒度 (DAY) |

**支援的粒度值 (`ObjectRecordGroupByDateGranularity`)：**

| 值 | 說明 |
|---|------|
| `DAY` | 按天 |
| `MONTH` | 按月 |
| `QUARTER` | 按季 |
| `YEAR` | 按年 |
| `DAY_OF_THE_WEEK` | 星期幾 |
| `MONTH_OF_THE_YEAR` | 月份 |
| `QUARTER_OF_THE_YEAR` | 季度 |

---

## 進階篩選 (Advanced Filter) 元件

位置：`src/modules/object-record/advanced-filter/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| AdvancedFilterAddFilterRuleSelect | `components/AdvancedFilterAddFilterRuleSelect.tsx` | 新增篩選規則選單 |
| AdvancedFilterFieldSelectMenu | `components/AdvancedFilterFieldSelectMenu.tsx` | 欄位選擇選單 |
| AdvancedFilterFieldSelectSearchInput | `components/AdvancedFilterFieldSelectSearchInput.tsx` | 欄位搜尋輸入框 |
| AdvancedFilterCommandMenuCreateRootFilterButton | `command-menu/components/AdvancedFilterCommandMenuCreateRootFilterButton.tsx` | 建立根篩選按鈕 |

---

## 視圖 (Views) 元件

位置：`src/modules/views/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| AdvancedFilterChip | `advanced-filter-chip/components/AdvancedFilterChip.tsx` | 進階篩選標籤 |
| AdvancedFilterDropdownButton | `advanced-filter-chip/components/AdvancedFilterDropdownButton.tsx` | 進階篩選下拉按鈕 |
| ViewBarFilterButton | `components/ViewBarFilterButton.tsx` | 視圖篩選按鈕 |
| ViewBarFilterDropdown | `components/ViewBarFilterDropdown.tsx` | 視圖篩選下拉選單 |
| SortOrFilterChip | `components/SortOrFilterChip.tsx` | 排序/篩選標籤 |

---

## 多語系 (i18n)

本專案使用 **Lingui** 進行多語系處理。

**翻譯檔案位置：** `src/locales/`

| 檔案 | 語言 |
|-----|------|
| `en.po` | 英文 |
| `zh-TW.po` | 繁體中文 |
| `zh-CN.po` | 簡體中文 |
| `ja-JP.po` | 日文 |
| `ko-KR.po` | 韓文 |

**使用方式：**

```tsx
import { useLingui } from '@lingui/react/macro';

const MyComponent = () => {
  const { t } = useLingui();

  return <div>{t`Add filter rule`}</div>;
};
```

**提取翻譯字串：**

```bash
npx nx run twenty-front:lingui:extract
```

---

## Activities 活動模組

位置：`src/modules/activities/`

Activities 模組是一個綜合性的活動管理系統，支援行事曆事件、電子郵件、筆記、任務、檔案附件，以及所有活動的時間軸視圖。

### 目錄結構總覽

```
activities/
├── blocks/                     # 富文本編輯器區塊
├── calendar/                   # 行事曆功能
├── components/                 # 核心活動元件
├── emails/                     # 電子郵件執行緒與訊息
├── files/                      # 檔案附件管理
├── graphql/                    # GraphQL 操作簽名
├── hooks/                      # 自訂 React Hooks
├── inline-cell/                # 內聯儲存格編輯
├── notes/                      # 筆記功能
├── states/                     # Recoil 狀態管理
├── tasks/                      # 任務管理
├── timeline-activities/        # 活動時間軸視圖
├── types/                      # TypeScript 型別定義
└── utils/                      # 工具函數
```

---

### 核心元件 (Root Components)

位置：`components/`

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| ActivityList | `components/ActivityList.tsx` | 活動列表容器 |
| ActivityRow | `components/ActivityRow.tsx` | 活動列表項目 |
| ActivityRichTextEditor | `components/ActivityRichTextEditor.tsx` | 活動富文本編輯器 |
| ActivityTargetChips | `components/ActivityTargetChips.tsx` | 活動目標標籤 Chips |
| ParticipantChip | `components/ParticipantChip.tsx` | 參與者標籤 Chip |
| SkeletonLoader | `components/SkeletonLoader.tsx` | 載入骨架效果 |
| CustomResolverFetchMoreLoader | `components/CustomResolverFetchMoreLoader.tsx` | 自訂解析器載入更多元件 |

---

### 行事曆 (Calendar)

位置：`calendar/`

#### 元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| CalendarDayCardContent | `calendar/components/CalendarDayCardContent.tsx` | 日曆日卡片內容 |
| CalendarEventRow | `calendar/components/CalendarEventRow.tsx` | 日曆事件列 |
| CalendarEventsCard | `calendar/components/CalendarEventsCard.tsx` | 日曆事件卡片容器 |
| CalendarEventDetails | `calendar/components/CalendarEventDetails.tsx` | 事件詳情 |
| CalendarEventParticipantsResponseStatusField | `calendar/components/CalendarEventParticipantsResponseStatusField.tsx` | 參與者回覆狀態 |
| CalendarMonthCard | `calendar/components/CalendarMonthCard.tsx` | 月份卡片 |
| CalendarCurrentEventCursor | `calendar/components/CalendarCurrentEventCursor.tsx` | 當前事件游標 |
| CalendarContext | `calendar/contexts/CalendarContext.ts` | 行事曆 Context |

#### Hooks

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useCalendarEvents | `calendar/hooks/useCalendarEvents.ts` | 獲取日曆事件 |

#### 型別

| 型別名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| CalendarEvent | `calendar/types/CalendarEvent.ts` | 日曆事件型別 |
| CalendarEventParticipant | `calendar/types/CalendarEventParticipant.ts` | 事件參與者型別 |
| CalendarChannelVisibility | `calendar/types/CalendarChannelVisibility.ts` | 頻道可見性型別 |

#### 工具函數

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| findUpcomingCalendarEvent | `calendar/utils/findUpcomingCalendarEvent.ts` | 尋找即將到來的事件 |
| getCalendarEventEndDate | `calendar/utils/getCalendarEventEndDate.ts` | 獲取事件結束日期 |
| getCalendarEventStartDate | `calendar/utils/getCalendarEventStartDate.ts` | 獲取事件開始日期 |
| hasCalendarEventEnded | `calendar/utils/hasCalendarEventEnded.ts` | 判斷事件是否已結束 |
| hasCalendarEventStarted | `calendar/utils/hasCalendarEventStarted.ts` | 判斷事件是否已開始 |
| sortCalendarEventsDesc | `calendar/utils/sortCalendarEventsDesc.ts` | 日曆事件降序排序 |

#### GraphQL 查詢

| 檔案路徑 | 說明 |
|---------|------|
| `calendar/graphql/queries/getTimelineCalendarEventsFromCompanyId.ts` | 從公司 ID 獲取日曆事件 |
| `calendar/graphql/queries/getTimelineCalendarEventsFromOpportunityId.ts` | 從商機 ID 獲取日曆事件 |
| `calendar/graphql/queries/getTimelineCalendarEventsFromPersonId.ts` | 從人員 ID 獲取日曆事件 |

---

### 電子郵件 (Emails)

位置：`emails/`

#### 元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EmailThreadHeader | `emails/components/EmailThreadHeader.tsx` | 郵件執行緒標頭 |
| EmailThreadMessage | `emails/components/EmailThreadMessage.tsx` | 郵件訊息 |
| EmailThreadMessageBody | `emails/components/EmailThreadMessageBody.tsx` | 郵件訊息內文 |
| EmailThreadMessageBodyPreview | `emails/components/EmailThreadMessageBodyPreview.tsx` | 郵件內文預覽 |
| EmailThreadMessageSender | `emails/components/EmailThreadMessageSender.tsx` | 郵件寄件者 |
| EmailThreadMessageReceivers | `emails/components/EmailThreadMessageReceivers.tsx` | 郵件收件者 |
| EmailThreadMembersChips | `emails/components/EmailThreadMembersChips.tsx` | 成員標籤 |
| EmailThreadNotShared | `emails/components/EmailThreadNotShared.tsx` | 未分享提示 |
| EmailThreads | `emails/components/EmailThreads.tsx` | 郵件執行緒列表 |
| EmailLoader | `emails/components/EmailLoader.tsx` | 郵件載入效果 |

#### 型別

| 型別名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EmailThread | `emails/types/EmailThread.ts` | 郵件執行緒型別 |
| EmailThreadMessage | `emails/types/EmailThreadMessage.ts` | 郵件訊息型別 |
| EmailThreadMessageParticipant | `emails/types/EmailThreadMessageParticipant.ts` | 訊息參與者型別 |
| MessageChannelMessageAssociation | `emails/types/MessageChannelMessageAssociation.ts` | 訊息頻道關聯型別 |
| MessageChannel | `emails/types/MessageChannel.ts` | 訊息頻道型別 |

#### 工具函數

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| getEmailParticipantDisplayName | `emails/utils/getEmailParticipantDisplayName.ts` | 獲取參與者顯示名稱 |

#### GraphQL 查詢

| 檔案路徑 | 說明 |
|---------|------|
| `emails/graphql/queries/getTimelineThreadsFromCompanyId.ts` | 從公司 ID 獲取郵件執行緒 |
| `emails/graphql/queries/getTimelineThreadsFromOpportunityId.ts` | 從商機 ID 獲取郵件執行緒 |
| `emails/graphql/queries/getTimelineThreadsFromPersonId.ts` | 從人員 ID 獲取郵件執行緒 |

---

### 檔案附件 (Files)

位置：`files/`

#### 元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| AttachmentDropdown | `files/components/AttachmentDropdown.tsx` | 附件下拉選單 |
| AttachmentList | `files/components/AttachmentList.tsx` | 附件列表 |
| AttachmentRow | `files/components/AttachmentRow.tsx` | 附件列表項 |
| FilesCard | `files/components/FilesCard.tsx` | 檔案卡片容器 |
| DocumentViewer | `files/components/DocumentViewer.tsx` | 文件檢視器 |
| DropZone | `files/components/DropZone.tsx` | 拖放上傳區域 |

#### Hooks

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useAttachments | `files/hooks/useAttachments.ts` | 管理附件 |
| useUploadAttachmentFile | `files/hooks/useUploadAttachmentFile.ts` | 上傳附件檔案 |

#### 型別

| 型別名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| Attachment | `files/types/Attachment.ts` | 附件型別 |
| AttachmentFileCategory | `files/types/AttachmentFileCategory.ts` | 附件檔案分類 |

#### 工具函數

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| downloadFile | `files/utils/downloadFile.ts` | 下載檔案 |
| fetchCsvPreview | `files/utils/fetchCsvPreview.ts` | 獲取 CSV 預覽 |
| getFileType | `files/utils/getFileType.ts` | 獲取檔案類型 |

---

### 筆記 (Notes)

位置：`notes/`

#### 元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| NotesCard | `notes/components/NotesCard.tsx` | 筆記卡片容器 |
| NoteList | `notes/components/NoteList.tsx` | 筆記列表 |
| NoteTile | `notes/components/NoteTile.tsx` | 筆記磚塊項目 |

#### Hooks

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useNotes | `notes/hooks/useNotes.ts` | 管理筆記 |

#### 狀態

| 狀態名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| currentNotesQueryVariablesState | `notes/states/currentNotesQueryVariablesState.ts` | 當前筆記查詢變數 |

---

### 任務 (Tasks)

位置：`tasks/`

#### 元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| TasksCard | `tasks/components/TasksCard.tsx` | 任務卡片容器 |
| TaskList | `tasks/components/TaskList.tsx` | 任務列表 |
| TaskRow | `tasks/components/TaskRow.tsx` | 任務列表項 |
| TaskGroups | `tasks/components/TaskGroups.tsx` | 任務分組 |
| AddTaskButton | `tasks/components/AddTaskButton.tsx` | 新增任務按鈕 |

#### Hooks

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useTasks | `tasks/hooks/useTasks.ts` | 管理任務 |
| useCompleteTask | `tasks/hooks/useCompleteTask.ts` | 完成任務 |

---

### 時間軸活動 (Timeline Activities)

位置：`timeline-activities/`

這是 Activities 模組中最複雜的子模組，負責顯示所有活動的時間軸視圖。

#### 主要元件

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| TimelineCard | `timeline-activities/components/TimelineCard.tsx` | 時間軸卡片容器 |
| EventList | `timeline-activities/components/EventList.tsx` | 事件列表 |
| EventRow | `timeline-activities/components/EventRow.tsx` | 事件列 |
| EventsGroup | `timeline-activities/components/EventsGroup.tsx` | 事件分組 |
| TimelineActivityContext | `timeline-activities/contexts/TimelineActivityContext.ts` | 時間軸活動 Context |

#### 事件列子元件 (Rows)

**活動事件：**

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EventRowActivity | `timeline-activities/rows/activity/components/EventRowActivity.tsx` | 活動事件列 |

**日曆事件：**

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EventCardCalendarEvent | `timeline-activities/rows/calendar/components/EventCardCalendarEvent.tsx` | 日曆事件卡片 |
| EventRowCalendarEvent | `timeline-activities/rows/calendar/components/EventRowCalendarEvent.tsx` | 日曆事件列 |

**訊息事件：**

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EventCardMessage | `timeline-activities/rows/message/components/EventCardMessage.tsx` | 訊息事件卡片 |
| EventRowMessage | `timeline-activities/rows/message/components/EventRowMessage.tsx` | 訊息事件列 |

**主物件事件：**

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| EventRowMainObject | `timeline-activities/rows/main-object/components/EventRowMainObject.tsx` | 主物件事件列 |
| EventFieldDiff | `timeline-activities/rows/main-object/components/EventFieldDiff.tsx` | 欄位差異顯示 |
| EventFieldDiffValue | `timeline-activities/rows/main-object/components/EventFieldDiffValue.tsx` | 欄位差異值 |
| EventFieldDiffContainer | `timeline-activities/rows/main-object/components/EventFieldDiffContainer.tsx` | 欄位差異容器 |

#### Hooks

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useTimelineActivities | `timeline-activities/hooks/useTimelineActivities.ts` | 獲取時間軸活動 |
| useLinkedObjectObjectMetadataItem | `timeline-activities/hooks/useLinkedObjectObjectMetadataItem.ts` | 獲取關聯物件 Metadata |
| useLinkedObjectsTitle | `timeline-activities/hooks/useLinkedObjectsTitle.ts` | 獲取關聯物件標題 |

#### 型別

| 型別名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| TimelineActivity | `timeline-activities/types/TimelineActivity.ts` | 時間軸活動型別 |
| TimelineActivityLinkedObject | `timeline-activities/types/TimelineActivityLinkedObject.ts` | 時間軸關聯物件型別 |

#### 工具函數

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| filterOutInvalidTimelineActivities | `timeline-activities/utils/filterOutInvalidTimelineActivities.ts` | 過濾無效活動 |
| groupActivitiesByMonth | `timeline-activities/utils/groupActivitiesByMonth.ts` | 按月份分組活動 |
| sortTimelineActivitiesDesc | `timeline-activities/utils/sortTimelineActivitiesDesc.ts` | 時間軸活動降序排序 |

---

### 內聯儲存格 (Inline Cell)

位置：`inline-cell/`

用於在記錄詳情頁面中直接編輯活動目標的元件。

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| ActivityTargetsInlineCell | `inline-cell/components/ActivityTargetsInlineCell.tsx` | 活動目標內聯儲存格 |

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useInlineCellEditing | `inline-cell/hooks/useInlineCellEditing.ts` | 內聯編輯 |
| useInlineCellInstance | `inline-cell/hooks/useInlineCellInstance.ts` | 內聯儲存格實例 |
| useActivityTargetInlineCellUpdate | `inline-cell/hooks/useActivityTargetInlineCellUpdate.ts` | 更新活動目標 |

---

### 富文本區塊 (Blocks)

位置：`blocks/`

用於富文本編輯器的區塊元件。

| 組件名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| FileBlock | `blocks/components/FileBlock.tsx` | 檔案區塊元件 |

| 常數/工具 | 檔案路徑 | 說明 |
|----------|---------|------|
| blockSchema | `blocks/constants/blockSchema.ts` | 區塊 Schema 定義 |
| getSlashMenu | `blocks/utils/getSlashMenu.ts` | 獲取斜線選單 |

---

### 根層級 Hooks

位置：`hooks/`

| Hook 名稱 | 檔案路徑 | 說明 |
|----------|---------|------|
| useActivities | `hooks/useActivities.ts` | 獲取活動列表 |
| useActivityTargetObjectRecords | `hooks/useActivityTargetObjectRecords.ts` | 獲取活動目標物件記錄 |
| useCreateActivityInDB | `hooks/useCreateActivityInDB.ts` | 在資料庫建立活動 |
| useOpenCreateActivityDrawer | `hooks/useOpenCreateActivityDrawer.ts` | 開啟建立活動抽屜 |
| usePrepareFindManyActivitiesQuery | `hooks/usePrepareFindManyActivitiesQuery.ts` | 準備查詢多個活動 |
| useCustomResolver | `hooks/useCustomResolver.ts` | 自訂 GraphQL 解析器 |
| useReplaceActivityBlockEditorContent | `hooks/useReplaceActivityBlockEditorContent.ts` | 替換編輯器內容 |
| useUpsertActivity | `hooks/useUpsertActivity.ts` | 建立或更新活動 |
| useRefreshShowPageFindManyActivitiesQueries | `hooks/useRefreshShowPageFindManyActivitiesQueries.ts` | 重新整理顯示頁面活動查詢 |
| useActivityTargetsForTargetableObjects | `hooks/useActivityTargetsForTargetableObjects.ts` | 獲取可目標物件的活動目標 |

---

### 根層級狀態 (States)

位置：`states/`

| 狀態名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| activityBodyFamilyState | `states/activityBodyFamilyState.ts` | 活動內文狀態 (Family State) |
| activityTargetableEntityArrayState | `states/activityTargetableEntityArrayState.ts` | 可目標實體陣列 |
| canCreateActivityState | `states/canCreateActivityState.ts` | 是否可建立活動 |
| isActivityInCreateModeState | `states/isActivityInCreateModeState.ts` | 是否在建立模式 |
| isCreatingActivityInDBState | `states/isCreatingActivityInDBState.ts` | 是否正在建立活動到資料庫 |

---

### 根層級型別 (Types)

位置：`types/`

| 型別名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| Activity | `types/Activity.ts` | 活動主型別 |
| ActivityForEditor | `types/ActivityForEditor.ts` | 編輯器用活動型別 |
| ActivityTargetObject | `types/ActivityTargetObject.ts` | 活動目標物件型別 |
| ActivityTargetableEntity | `types/ActivityTargetableEntity.ts` | 可目標實體型別 |
| Note | `types/Note.ts` | 筆記型別 |
| NoteTarget | `types/NoteTarget.ts` | 筆記目標型別 |
| Task | `types/Task.ts` | 任務型別 |
| TaskTarget | `types/TaskTarget.ts` | 任務目標型別 |

---

### 根層級工具函數 (Utils)

位置：`utils/`

**活動附件相關：**

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| getActivityAttachment | `utils/getActivityAttachment.ts` | 獲取活動附件 |
| deleteActivityAttachment | `utils/deleteActivityAttachment.ts` | 刪除活動附件 |
| restoreActivityAttachment | `utils/restoreActivityAttachment.ts` | 還原活動附件 |
| restoreActivityAttachmentPaths | `utils/restoreActivityAttachmentPaths.ts` | 還原活動附件路徑 |

**活動目標相關：**

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| filterActivityTargetsForActivityTargetableEntities | `utils/filterActivityTargetsForActivityTargetableEntities.ts` | 過濾活動目標 |
| morphToRecordId | `utils/morphToRecordId.ts` | 轉換為記錄 ID |
| targetableObjectToActivity | `utils/targetableObjectToActivity.ts` | 可目標物件轉換為活動 |

**其他：**

| 函數名稱 | 檔案路徑 | 說明 |
|---------|---------|------|
| getActivityPreview | `utils/getActivityPreview.ts` | 獲取活動預覽 |
| getActivitySummary | `utils/getActivitySummary.ts` | 獲取活動摘要 |
| areUrlsEqual | `utils/areUrlsEqual.ts` | 比較 URL 是否相等 |

---

### GraphQL 操作簽名 (Operation Signature)

位置：`graphql/operation-signatures/`

#### 什麼是 Operation Signature？

Operation Signature 是一個「**查詢規格定義**」，用來告訴系統「我要查詢什麼物件、需要哪些欄位」。它是一種抽象化的查詢定義，讓程式碼可以動態產生符合當前系統 schema 的 GraphQL 查詢。

#### 型別結構

```typescript
// 定義位置：src/modules/object-record/graphql/types/RecordGqlOperationSignature.ts
type RecordGqlOperationSignature = {
  objectNameSingular: string;                    // 要查詢的物件名稱 (如 'note', 'task')
  variables: RecordGqlOperationVariables;        // 查詢變數
  fields?: RecordGqlOperationGqlRecordFields;    // 需要回傳的欄位
};
```

#### 實際範例

以 `findActivitiesOperationSignatureFactory` 為例：

```typescript
return {
  objectNameSingular: 'note',  // 查詢 Note 物件
  variables: {},
  fields: {
    id: true,           // 需要 id 欄位
    title: true,        // 需要 title 欄位
    createdAt: true,    // 需要 createdAt 欄位
    author: {           // 需要 author 關聯物件
      id: true,
      name: true,
    },
    noteTargets: {      // 需要 noteTargets 關聯
      id: true,
      // ...
    },
  },
};
```

#### 為什麼需要 Factory（工廠函數）？

因為 Twenty 是一個**動態 schema** 的 CRM：
- 使用者可以自訂物件和欄位
- 不同物件類型（Note vs Task）有不同的關聯欄位
- Factory 可以根據 `objectMetadataItems`（系統中存在的所有物件定義）動態產生正確的查詢規格

#### 資料流程

```
Hook (如 useActivities)
    ↓
Operation Signature Factory
    ↓
產生 RecordGqlOperationSignature
    ↓
建構實際 GraphQL 查詢
    ↓
發送到後端 API
```

#### 檔案列表

| 檔案路徑 | 說明 |
|---------|------|
| `graphql/operation-signatures/factories/createOneActivityOperationSignatureFactory.ts` | 建立單一活動操作簽名工廠 |
| `graphql/operation-signatures/factories/findActivitiesOperationSignatureFactory.ts` | 查詢活動操作簽名工廠 |
| `graphql/operation-signatures/factories/findActivityTargetsOperationSignatureFactory.ts` | 查詢活動目標操作簽名工廠 |

---

### 視覺結構

```
┌─────────────────────────────────────────────────────────────────┐
│                        Record Show Page                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  TimelineCard (時間軸)                                    │   │
│  │    ├── EventsGroup (按月份分組)                           │   │
│  │    │     ├── EventRow (活動事件)                          │   │
│  │    │     ├── EventRowCalendarEvent (日曆事件)             │   │
│  │    │     ├── EventRowMessage (郵件事件)                   │   │
│  │    │     └── EventRowMainObject (物件變更事件)            │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  TasksCard (任務)                                         │   │
│  │    ├── TaskGroups                                         │   │
│  │    │     └── TaskRow (個別任務)                           │   │
│  │    └── AddTaskButton                                      │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  NotesCard (筆記)                                         │   │
│  │    └── NoteList                                           │   │
│  │          └── NoteTile (個別筆記)                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  CalendarEventsCard (日曆)                                │   │
│  │    └── CalendarDayCardContent                             │   │
│  │          └── CalendarEventRow (個別事件)                  │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  FilesCard (檔案)                                         │   │
│  │    └── AttachmentList                                     │   │
│  │          └── AttachmentRow (個別附件)                     │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  EmailThreads (電子郵件)                                  │   │
│  │    └── EmailThreadHeader                                  │   │
│  │    └── EmailThreadMessage (個別郵件)                      │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 備註

- 所有路徑相對於 `packages/twenty-front/`
- 組件使用 Emotion 進行樣式設計
- 狀態管理使用 Recoil
- 國際化使用 Lingui
