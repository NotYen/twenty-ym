# Twenty CRM 部署方案與成本分析

> **文檔日期**: 2025-10-17  
> **適用版本**: Twenty CRM 0.2.1  
> **當前配置**: 單租戶模式 (IS_MULTIWORKSPACE_ENABLED=false)

---

## 目錄
- [Q1: 10個客戶的部署方案](#q1-10個客戶的部署方案)
- [Q2: 單一客戶多分店管理](#q2-單一客戶多分店管理)
- [成本詳細計算](#成本詳細計算)
- [方案決策矩陣](#方案決策矩陣)

---

## Q1: 10個客戶的部署方案

### 問題描述
如果有 10 個不同公司的客戶要使用系統，應該如何部署？

---

### 方案對比總表

| 對比項目 | 方案 A：單租戶模式 | 方案 B：多租戶模式 |
|---------|------------------|------------------|
| **架構模式** | 每個客戶獨立實例 | 所有客戶共享實例 |
| **部署數量** | 10 個獨立實例 | 1 個共享實例 |
| **數據庫** | 10 個獨立 PostgreSQL | 1 個共享 PostgreSQL |
| **緩存/隊列** | 10 個獨立 Redis | 1 個共享 Redis |
| **數據隔離** | 物理隔離 | 邏輯隔離（workspaceId） |
| **訪問方式** | `customer-a.yourdomain.com` | `customer-a.yourdomain.com` |
| **月成本（10客戶）** | $1,680 - $3,500 | $280 - $600 |
| **適用場景** | 高安全需求、大客戶 | 成本敏感、SaaS 模式 |

---

### 方案 A：單租戶模式（當前配置）

#### 架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                    客戶 A (獨立環境)                          │
├─────────────────────────────────────────────────────────────┤
│  VM 1: customer-a.yourdomain.com                             │
│  ├── Twenty Server (Node.js)                                 │
│  ├── Twenty Front (React)                                    │
│  ├── PostgreSQL 16                                           │
│  ├── Redis                                                   │
│  └── Worker Process                                          │
│  資源: 2 vCPU + 4GB RAM + 50GB SSD                           │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    客戶 B (獨立環境)                          │
├─────────────────────────────────────────────────────────────┤
│  VM 2: customer-b.yourdomain.com                             │
│  ├── Twenty Server (Node.js)                                 │
│  ├── Twenty Front (React)                                    │
│  ├── PostgreSQL 16                                           │
│  ├── Redis                                                   │
│  └── Worker Process                                          │
│  資源: 2 vCPU + 4GB RAM + 50GB SSD                           │
└─────────────────────────────────────────────────────────────┘

... (重複 10 次)
```

#### 詳細配置

| 項目 | 配置 | 說明 |
|------|------|------|
| **環境變數** | `IS_MULTIWORKSPACE_ENABLED=false` | 單租戶模式 |
| **訪問 URL** | `https://customer-a.yourdomain.com` | 每個客戶獨立域名 |
| **數據庫** | 每客戶獨立 PostgreSQL 實例 | 完全物理隔離 |
| **備份策略** | 每個實例獨立備份 | 需要 10 套備份流程 |

#### 優點分析

| 優點 | 詳細說明 | 重要性 |
|------|---------|--------|
| **數據完全隔離** | 每個客戶有獨立的數據庫，物理層面無法互相訪問 | ⭐⭐⭐⭐⭐ |
| **性能獨立** | 客戶 A 的高流量不會影響客戶 B | ⭐⭐⭐⭐ |
| **安全性高** | 一個客戶被攻擊，其他客戶不受影響 | ⭐⭐⭐⭐⭐ |
| **可定制化** | 可為不同客戶部署不同版本或定制功能 | ⭐⭐⭐⭐ |
| **符合合規要求** | 適合金融、醫療等需要數據物理隔離的行業 | ⭐⭐⭐⭐⭐ |
| **故障隔離** | 一個客戶實例故障不影響其他客戶 | ⭐⭐⭐⭐ |

#### 缺點分析

| 缺點 | 詳細說明 | 影響程度 |
|------|---------|---------|
| **成本高** | 需要 10 台 VM，每台約 $168-350/月 | ⭐⭐⭐⭐⭐ |
| **維護複雜** | 需要更新和維護 10 個獨立實例 | ⭐⭐⭐⭐ |
| **資源浪費** | 小客戶（10個用戶）也佔用完整 4GB RAM | ⭐⭐⭐ |
| **擴展較慢** | 新增客戶需要 15-30 分鐘部署新 VM | ⭐⭐⭐ |
| **監控複雜** | 需要監控 10 個獨立系統 | ⭐⭐⭐ |

---

### 方案 B：多租戶模式

#### 架構圖

```
┌─────────────────────────────────────────────────────────────┐
│              共享環境（所有客戶）                              │
├─────────────────────────────────────────────────────────────┤
│  VM 1: yourdomain.com                                        │
│  ├── Twenty Server (Node.js) - 處理所有請求                  │
│  ├── Twenty Front (React) - 動態加載                         │
│  ├── PostgreSQL 16                                           │
│  │   ├── Workspace A (workspaceId: xxx-aaa)                 │
│  │   ├── Workspace B (workspaceId: xxx-bbb)                 │
│  │   └── Workspace C (workspaceId: xxx-ccc) ... x10         │
│  ├── Redis (共享緩存和隊列)                                  │
│  └── Worker Process (處理所有客戶任務)                       │
│  資源: 8 vCPU + 16GB RAM + 200GB SSD                         │
└─────────────────────────────────────────────────────────────┘

訪問方式：
- 客戶 A: https://customer-a.yourdomain.com → Workspace A
- 客戶 B: https://customer-b.yourdomain.com → Workspace B
- 客戶 C: https://customer-c.yourdomain.com → Workspace C
```

#### Workspace 隔離機制

```sql
-- 所有數據表都有 workspaceId 欄位
-- 查詢時自動過濾

-- 例如：客戶 A 查詢聯絡人
SELECT * FROM metadata.contact 
WHERE "workspaceId" = 'workspace-a-id';

-- 客戶 B 完全看不到客戶 A 的數據
SELECT * FROM metadata.contact 
WHERE "workspaceId" = 'workspace-b-id';
```

#### 詳細配置

| 項目 | 配置 | 說明 |
|------|------|------|
| **環境變數** | `IS_MULTIWORKSPACE_ENABLED=true` | 多租戶模式 |
| **默認子域名** | `DEFAULT_SUBDOMAIN=app` | 默認訪問入口 |
| **訪問 URL** | `https://{subdomain}.yourdomain.com` | 通過子域名區分客戶 |
| **數據隔離** | 邏輯隔離（workspaceId） | 共享數據庫，但邏輯隔離 |

#### 優點分析

| 優點 | 詳細說明 | 重要性 |
|------|---------|--------|
| **成本低** | 只需 1 台 VM，10 個客戶共享 | ⭐⭐⭐⭐⭐ |
| **維護簡單** | 只需更新 1 個實例，所有客戶同步更新 | ⭐⭐⭐⭐⭐ |
| **資源高效** | 按需共享資源，小客戶只佔用實際使用量 | ⭐⭐⭐⭐ |
| **快速擴展** | 新增客戶只需創建新 workspace（< 1 分鐘） | ⭐⭐⭐⭐⭐ |
| **統一監控** | 只需監控 1 個系統 | ⭐⭐⭐⭐ |
| **自動負載均衡** | 資源動態分配，峰谷自動平衡 | ⭐⭐⭐ |

#### 缺點分析

| 缺點 | 詳細說明 | 影響程度 |
|------|---------|---------|
| **邏輯隔離** | 共享同一數據庫，依賴 workspaceId 過濾 | ⭐⭐⭐⭐ |
| **性能互相影響** | 客戶 A 高負載會影響客戶 B 響應時間 | ⭐⭐⭐⭐ |
| **不適合高合規** | 不符合需要物理隔離的金融、醫療場景 | ⭐⭐⭐⭐⭐ |
| **安全風險** | 一個 SQL 注入漏洞可能影響所有客戶 | ⭐⭐⭐⭐ |
| **定制困難** | 無法為單一客戶部署特殊版本 | ⭐⭐⭐ |
| **"吵鬧鄰居"問題** | 一個客戶的異常可能拖垮整個系統 | ⭐⭐⭐⭐ |

---

## 成本詳細計算

> **匯率說明**: 2025年10月匯率 1 USD = 32 NTD  
> **價格來源**: AWS 台北區域官方定價、台灣本地雲服務商 (2025/10)

### 方案 A：單租戶模式成本（10 個客戶）

#### 1. VM 租賃費用（每月 730 小時）

| 雲服務商 | 規格 | 時價 | 月價 (NTD) | 10 實例 (NTD) | 年費 (NTD) |
|---------|------|------|-----------|-------------|-----------|
| **AWS EC2 台北** | t3.medium (2 vCPU, 4GB) | 0.0416 USD/hr | 2,587 | 25,870 | 310,440 |
| **AWS EC2 台北** | t3a.medium (AMD, 2 vCPU, 4GB) | 0.0374 USD/hr | 2,326 | 23,260 | 279,120 |
| **GCP 台灣** | e2-medium (2 vCPU, 4GB) | 0.0443 USD/hr | 2,756 | 27,560 | 330,720 |
| **Azure 台灣** | B2s (2 vCPU, 4GB) | 0.0619 USD/hr | 3,851 | 38,510 | 462,120 |
| **DigitalOcean** 🌟 | Standard (2 vCPU, 4GB) | 固定 $24/月 | 768 | 7,680 | 92,160 |
| **Linode (Akamai)** 🌟 | Shared 4GB (2 vCPU, 4GB) | 固定 $24/月 | 768 | 7,680 | 92,160 |
| **Vultr** 🌟 | Regular Performance (2 vCPU, 4GB) | 固定 $18/月 | 576 | 5,760 | 69,120 |
| **台灣大哥大雲** | 運算雲 3.0 (2 vCPU, 4GB) | 4.8 NTD/hr | 3,504 | 35,040 | 420,480 |
| **中華電信 HiCloud** | 標準型 (2 vCPU, 4GB) | - | 4,500 | 45,000 | 540,000 |

**成本分析**:
- 💰 **最便宜**: Vultr - 每月僅 NT$ 5,760（10 個實例）
- 🏆 **最推薦**: DigitalOcean 或 Linode - 性價比高，穩定性好
- 🇹🇼 **台灣本地**: 價格較高，但客服支援佳，適合有在地需求的企業

#### 2. 儲存空間費用

| 項目 | 每實例 | 10 實例 | AWS 台北 (NTD) | GCP 台灣 (NTD) | DO/Vultr (NTD) |
|------|--------|---------|----------------|---------------|---------------|
| **系統盤 SSD** | 50GB | 500GB | 1,380 (gp3) | 1,440 (標準) | 已包含 ✅ |
| **數據庫存儲** | 30GB | 300GB | 828 | 864 | 已包含 ✅ |
| **備份存儲** | 20GB | 200GB | 138 (S3) | 160 (Storage) | 1,280 (20%) |
| **日誌存儲** | 10GB | 100GB | 69 (S3) | 80 | 已包含 ✅ |
| **總計** | 110GB | 1.1TB | **2,415/月** | **2,544/月** | **1,280/月** |

**儲存價格明細** (每 GB/月):
- AWS EBS gp3 (台北): 0.0864 USD = 2.76 NTD
- AWS S3 標準 (台北): 0.023 USD = 0.69 NTD
- GCP 標準硬碟: 0.046 USD = 1.47 NTD
- DigitalOcean/Vultr: 已包含在 VM 費用中（每個 Droplet 含系統盤）

#### 3. 流量費用（數據傳輸費用）

**使用情境假設**：
- 用戶數：平均 20 人/客戶
- 每日活躍用戶：15 人
- 每人每日流量：50MB（頁面瀏覽、API 調用、文件上傳下載）

| 項目 | 計算 | 月流量 |
|------|------|--------|
| **單客戶月流量** | 20 用戶 × 22 工作天 × 15 活躍率 × 50MB | 約 20GB |
| **10 客戶總流量** | 20GB × 10 | 200GB |

**流量費用對比** (200GB/月):

| 雲服務商 | 免費額度 | 超出費用 (NTD/GB) | 200GB 月費 (NTD) |
|---------|---------|------------------|-----------------|
| **AWS 台北** | 100GB/月 | 3.46 | 346 (100GB 超額) |
| **AWS 台北** (透過代理商) | 100GB/月 | 2.88 | 288 ⚡ |
| **GCP 台灣** | 200GB/月 | 3.84 | 0 ✅ (在免費額度內) |
| **Azure 台灣** | 100GB/月 | 2.78 | 278 |
| **DigitalOcean** | 2TB/月（每 Droplet） | 0.32 | 0 ✅ (已包含) |
| **Vultr** | 3TB/月 | 0.32 | 0 ✅ (已包含) |
| **台灣大哥大** | 依方案 | 3.00 | 600 |

**重要說明**:
- 🎁 **GCP 最佳**: 200GB 免費額度可完全覆蓋
- 💰 **DO/Vultr**: 包含 2-3TB 流量，完全不用擔心
- ⚠️ **AWS 注意**: 使用台灣代理商可節省 20% 境外稅

#### 4. 其他費用

| 項目 | 說明 | 月費 (NTD) |
|------|------|-----------|
| **域名費用** | 10 個子域名（1 個主域名 .tw 或 .com） | 300-500 |
| **SSL 證書** | Let's Encrypt 免費 或 Cloudflare SSL | 0 ✅ |
| **監控服務** | Uptime Robot 免費版（50 個監控點） | 0 ✅ |
| **備份服務** | 自動備份（約 VM 費用 20%） | 1,152-1,536 |
| **DNS 服務** | Cloudflare 免費版 | 0 ✅ |
| **CDN 服務** | Cloudflare 免費版（基本） | 0 ✅ |
| **防火牆** | 雲服務商內建安全組 | 0 ✅ |

#### 方案 A 總成本匯總（10 個客戶）

| 雲服務商 | VM 費用 | 儲存 | 流量 | 其他 | **月總計 (NTD)** | **年總計 (NTD)** |
|---------|---------|------|------|------|----------------|----------------|
| **AWS 台北** | 25,870 | 2,415 | 346 | 1,800 | **30,431** | **365,172** |
| **GCP 台灣** | 27,560 | 2,544 | 0 | 1,800 | **31,904** | **382,848** |
| **Azure 台灣** | 38,510 | 2,500 | 278 | 1,800 | **43,088** | **517,056** |
| **DigitalOcean** 🌟 | 7,680 | 1,280 | 0 | 1,500 | **10,460** | **125,520** |
| **Vultr** 🏆 | 5,760 | 1,280 | 0 | 1,500 | **8,540** | **102,480** |
| **Linode** 🌟 | 7,680 | 1,280 | 0 | 1,500 | **10,460** | **125,520** |
| **台灣大哥大** | 35,040 | 1,500 | 600 | 2,000 | **39,140** | **469,680** |
| **中華電信** | 45,000 | 2,000 | 800 | 2,000 | **49,800** | **597,600** |

**成本排名與分析**:
1. 🏆 **Vultr 最便宜**: 年費僅 NT$ 102,480（約 $8,540/月）
2. 🌟 **DigitalOcean/Linode**: 年費 NT$ 125,520，穩定性更好
3. 💰 **AWS 台北**: 年費 NT$ 365,172，貴 3.5 倍但功能完整
4. 🇹🇼 **台灣本地**: 最貴，但有本地支援和發票

**省錢建議**:
- 使用 Vultr 可比 AWS 台北節省 **71%** 成本（約 NT$ 262,692/年）
- 使用 DO 可比中華電信節省 **79%** 成本（約 NT$ 472,080/年）

---

### 方案 B：多租戶模式成本（10 個客戶共享 1 台 VM）

#### 1. VM 租賃費用（單台高效能）

| 雲服務商 | 規格 | 時價 | 月費 (NTD) | 年費 (NTD) |
|---------|------|------|-----------|-----------|
| **AWS EC2 台北** | m6i.2xlarge (8 vCPU, 32GB) | 0.446 USD/hr | 10,418 | 125,016 |
| **AWS EC2 台北** | c6i.2xlarge (8 vCPU, 16GB) | 0.370 USD/hr | 8,641 | 103,692 |
| **GCP 台灣** | n2-standard-8 (8 vCPU, 32GB) | 0.389 USD/hr | 9,085 | 109,020 |
| **Azure 台灣** | D8s v3 (8 vCPU, 32GB) | 0.516 USD/hr | 12,052 | 144,624 |
| **DigitalOcean** 🌟 | CPU-Optimized (8 vCPU, 16GB) | $96/月 | 3,072 | 36,864 |
| **Vultr** 🏆 | High Performance (8 vCPU, 16GB) | $96/月 | 3,072 | 36,864 |
| **Linode** 🌟 | Dedicated 16GB (8 vCPU, 16GB) | $96/月 | 3,072 | 36,864 |
| **台灣大哥大** | 運算雲 3.0 (8 vCPU, 16GB) | 9.6 NTD/hr | 7,008 | 84,096 |
| **中華電信** | 標準型 (8 vCPU, 16GB) | - | 12,000 | 144,000 |

**推薦配置**: 
- 🏆 **Vultr/DO/Linode**: 月費僅 NT$ 3,072，性價比最佳
- 💪 **AWS c6i**: 計算優化型，適合高負載，月費 NT$ 8,641

#### 2. 儲存空間費用（所有客戶共享）

| 項目 | 容量 | AWS 台北 (NTD) | GCP 台灣 (NTD) | DO/Vultr (NTD) |
|------|------|----------------|---------------|---------------|
| **系統盤 SSD** | 200GB | 552 (gp3) | 640 | 已包含 ✅ |
| **數據庫存儲** | 300GB | 828 | 960 | 需額外購買 3,200 |
| **備份存儲** | 200GB | 138 (S3) | 160 | 640 (20%) |
| **日誌存儲** | 100GB | 69 (S3) | 80 | 已包含 ✅ |
| **文件上傳** | 200GB | 138 (S3) | 160 | 需 S3/Spaces 640 |
| **總計** | 1TB | **1,725/月** | **2,000/月** | **4,480/月** |

**儲存策略建議**:
- **AWS/GCP**: 數據庫用 EBS/Disk，文件用 S3/Storage，成本最優
- **DO/Vultr**: 需要額外購買 Spaces（對象存儲）或增加 Block Storage
- **混合方案**: VM 在 Vultr，文件存儲用 AWS S3（跨服務商）

#### 3. 流量費用（所有客戶共享）

**假設總使用情況**：
- 總用戶數：200 人（10 客戶 × 平均 20 人）
- 每日活躍：150 人
- 月總流量：200GB（與方案 A 相同）

| 雲服務商 | 免費額度 | 超出費用 (NTD/GB) | 200GB 月費 (NTD) |
|---------|---------|------------------|-----------------|
| **AWS 台北** | 100GB/月 | 3.46 | 346 (100GB 超額) |
| **GCP 台灣** | 200GB/月 | 3.84 | 0 ✅ (在免費額度內) |
| **Azure 台灣** | 100GB/月 | 2.78 | 278 |
| **DigitalOcean** | 6TB/月 | 0.32 | 0 ✅ (已包含) |
| **Vultr** | 8TB/月 | 0.32 | 0 ✅ (已包含) |

**流量分析**:
- 多租戶模式下，10 個客戶共享流量，總量與單租戶相同
- DO/Vultr 的大流量包完全夠用（6-8TB）

#### 4. 其他費用

| 項目 | 說明 | 月費 (NTD) |
|------|------|-----------|
| **域名費用** | 1 個主域名（*.yourdomain.com 通配符） | 400-600 |
| **SSL 證書** | Let's Encrypt 免費（通配符證書） | 0 ✅ |
| **監控服務** | Uptime Robot 免費版 | 0 ✅ |
| **備份服務** | 自動備份（約 VM 費用 20%） | 614-2,084 |
| **Redis 管理** | 自建（已包含在 VM 內） | 0 ✅ |
| **PostgreSQL** | 自建（已包含在 VM 內） | 0 ✅ |
| **負載均衡器** | 單實例不需要（可選） | 0 |

#### 方案 B 總成本匯總（10 個客戶共享）

| 雲服務商 | VM 費用 | 儲存 | 流量 | 其他 | **月總計 (NTD)** | **年總計 (NTD)** | 每客戶 (NTD/月) |
|---------|---------|------|------|------|----------------|----------------|---------------|
| **AWS 台北** (計算優化) | 8,641 | 1,725 | 346 | 2,200 | **12,912** | **154,944** | 1,291 |
| **GCP 台灣** | 9,085 | 2,000 | 0 | 2,300 | **13,385** | **160,620** | 1,339 |
| **Azure 台灣** | 12,052 | 2,100 | 278 | 2,800 | **17,230** | **206,760** | 1,723 |
| **DigitalOcean** 🌟 | 3,072 | 4,480 | 0 | 1,200 | **8,752** | **105,024** | 875 |
| **Vultr** 🏆 | 3,072 | 4,480 | 0 | 1,200 | **8,752** | **105,024** | 875 |
| **Linode** 🌟 | 3,072 | 4,480 | 0 | 1,200 | **8,752** | **105,024** | 875 |
| **台灣大哥大** | 7,008 | 2,000 | 600 | 2,000 | **11,608** | **139,296** | 1,161 |
| **中華電信** | 12,000 | 2,500 | 800 | 2,500 | **17,800** | **213,600** | 1,780 |

**成本排名與分析**:
1. 🏆 **Vultr/DO/Linode 最便宜**: 年費僅 NT$ 105,024（每客戶 $875/月）
2. 💰 **AWS 計算優化**: 年費 NT$ 154,944，性能更好但貴 47%
3. 🇹🇼 **台灣本地**: 最貴，但有本地支援

**每客戶成本對比** (月費):
- **國際服務商**: NT$ 875/客戶/月
- **AWS 台北**: NT$ 1,291/客戶/月
- **台灣本地**: NT$ 1,161-1,780/客戶/月

---

### 成本對比總結（10 個客戶，使用 Vultr）

| 項目 | 方案 A（單租戶） | 方案 B（多租戶） | 節省金額 | 節省比例 |
|------|----------------|----------------|---------|---------|
| **VM 費用** | 5,760 | 3,072 | 2,688 | 47% |
| **儲存費用** | 1,280 | 4,480 | -3,200 | -250% ⚠️ |
| **流量費用** | 0 | 0 | 0 | - |
| **其他費用** | 1,500 | 1,200 | 300 | 20% |
| **月總計** | **8,540** | **8,752** | **-212** | **-2%** ⚠️ |
| **年總計** | **102,480** | **105,024** | **-2,544** | **-2%** ⚠️ |

**⚠️ 重要發現**: 使用 Vultr 時，多租戶模式**反而更貴**！
- 原因：單租戶模式 VM 包含儲存，多租戶需額外購買大容量儲存

---

### 成本對比總結（10 個客戶，使用 AWS 台北）

| 項目 | 方案 A（單租戶） | 方案 B（多租戶） | 節省金額 | 節省比例 |
|------|----------------|----------------|---------|---------|
| **VM 費用** | 25,870 | 8,641 | 17,229 | 67% |
| **儲存費用** | 2,415 | 1,725 | 690 | 29% |
| **流量費用** | 346 | 346 | 0 | - |
| **其他費用** | 1,800 | 2,200 | -400 | -22% |
| **月總計** | **30,431** | **12,912** | **17,519** | **58%** ✅ |
| **年總計** | **365,172** | **154,944** | **210,228** | **58%** ✅ |

**✅ AWS 多租戶優勢明顯**: 年省 NT$ 210,228（58%）

---

### 最佳方案建議（10 個客戶）

| 場景 | 推薦方案 | 雲服務商 | 年成本 (NTD) | 說明 |
|------|---------|---------|-------------|------|
| **極致成本優化** | 方案 A 單租戶 | Vultr | 102,480 | 每客戶獨立，最便宜 |
| **平衡性價比** | 方案 B 多租戶 | Vultr | 105,024 | 共享資源，彈性高 |
| **企業級需求** | 方案 B 多租戶 | AWS 台北 | 154,944 | 功能完整，可靠性高 |
| **高安全需求** | 方案 A 單租戶 | AWS 台北 | 365,172 | 物理隔離，合規首選 |

---

### 5 年總擁有成本（TCO）分析

**方案 A 單租戶（Vultr）**:

| 項目 | 年費 (NTD) | 5 年 (NTD) | 說明 |
|------|-----------|-----------|------|
| **基礎設施** | 102,480 | 512,400 | VM + 儲存 + 流量 |
| **維護人力** | 360,000 | 1,800,000 | 需 1 名專職工程師（月薪 30K） |
| **升級成本** | 30,000 | 150,000 | 每次更新 10 個實例 |
| **備份恢復** | 20,000 | 100,000 | 定期備份和災難恢復 |
| **監控工具** | 10,000 | 50,000 | Sentry, OpenTelemetry 等 |
| **5 年總計** | - | **2,612,400** | |

**方案 B 多租戶（Vultr）**:

| 項目 | 年費 (NTD) | 5 年 (NTD) | 說明 |
|------|-----------|-----------|------|
| **基礎設施** | 105,024 | 525,120 | VM + 儲存 + 流量 |
| **維護人力** | 180,000 | 900,000 | 可兼職或 0.5 人（月薪 15K） |
| **升級成本** | 10,000 | 50,000 | 只需更新 1 個實例 |
| **備份恢復** | 15,000 | 75,000 | 集中備份 |
| **監控工具** | 10,000 | 50,000 | 同上 |
| **5 年總計** | - | **1,600,120** | |

**TCO 對比**:
- 多租戶模式 5 年可省 **NT$ 1,012,280**（39%）
- 主要省在人力成本（不需要專職工程師管理 10 個實例）

---

### 關鍵決策因素

| 決策因素 | 選單租戶 | 選多租戶 |
|---------|---------|---------|
| **客戶數量** | < 5 個 | > 5 個 |
| **用戶總數** | 每客戶 > 100 人 | 每客戶 < 50 人 |
| **合規需求** | 金融、醫療 | 一般企業 |
| **預算** | 充裕 | 有限 |
| **技術團隊** | 有專職 DevOps | 小團隊 |
| **數據隔離** | 物理隔離 | 邏輯隔離可接受 |

---

## 成本擴展分析（Vultr 價格）

### 隨客戶數量增長的成本變化

| 客戶數 | 方案 A 月成本 (NTD) | 方案 B 月成本 (NTD) | 成本差異 (NTD) | 節省比例 |
|--------|-------------------|-------------------|---------------|---------|
| **1 客戶** | 854 | 8,752 | -7,898 | -924% ❌ |
| **3 客戶** | 2,562 | 8,752 | -6,190 | -242% ❌ |
| **5 客戶** | 4,270 | 8,752 | -4,482 | -105% ❌ |
| **7 客戶** | 5,978 | 8,752 | -2,774 | -46% ❌ |
| **10 客戶** | 8,540 | 8,752 | -212 | -2% ⚠️ |
| **15 客戶** | 12,810 | 10,500 | 2,310 | 18% ✅ |
| **20 客戶** | 17,080 | 12,250 | 4,830 | 28% ✅ |
| **30 客戶** | 25,620 | 15,750 | 9,870 | 39% ✅ |
| **50 客戶** | 42,700 | 22,750 | 19,950 | 47% ✅ |
| **100 客戶** | 85,400 | 40,250 | 45,150 | 53% ✅ |

**重要結論**: 
- ❌ **客戶數 < 10**: 單租戶更便宜（Vultr 包含儲存）
- ⚠️ **客戶數 = 10**: 兩者成本接近
- ✅ **客戶數 > 15**: 多租戶開始顯著優勢
- 🚀 **客戶數 > 50**: 多租戶節省 > 45%

**擴展建議**:
- **初期（< 10 客戶）**: 使用單租戶模式
- **成長期（10-20 客戶）**: 考慮遷移到多租戶
- **規模化（> 20 客戶）**: 必須使用多租戶模式

---

### 隨客戶數量增長的成本變化（AWS 台北）

| 客戶數 | 方案 A 月成本 (NTD) | 方案 B 月成本 (NTD) | 成本差異 (NTD) | 節省比例 |
|--------|-------------------|-------------------|---------------|---------|
| **1 客戶** | 3,043 | 12,912 | -9,869 | -324% ❌ |
| **3 客戶** | 9,129 | 12,912 | -3,783 | -41% ❌ |
| **5 客戶** | 15,215 | 12,912 | 2,303 | 15% ✅ |
| **7 客戶** | 21,301 | 14,400 | 6,901 | 32% ✅ |
| **10 客戶** | 30,431 | 12,912 | 17,519 | 58% ✅ |
| **20 客戶** | 60,862 | 20,400 | 40,462 | 66% ✅ |
| **50 客戶** | 152,155 | 45,600 | 106,555 | 70% ✅ |
| **100 客戶** | 304,310 | 85,200 | 219,110 | 72% ✅ |

**AWS 結論**:
- ✅ **客戶數 > 5**: 多租戶就開始有優勢
- 🚀 **客戶數 > 10**: 多租戶節省 > 50%
- 💰 **客戶數 > 50**: 多租戶節省 > 70%

**為什麼 AWS 和 Vultr 結論不同？**
- AWS：儲存和 VM 分開計費，多租戶可共享儲存節省成本
- Vultr：VM 已包含儲存，多租戶反而需要額外購買大容量儲存

---

## Q2: 單一客戶多分店管理

### 問題描述
1 個客戶在不同縣市有分店或分公司，能否：
1. 只開 1 個系統給他
2. 讓他自己建立帳號
3. 客戶和廠商可以按地區分開管理

---

### Twenty CRM 架構分析

```
Workspace（整個公司）
├── Users（所有員工）
│   ├── Admin（總部管理員）
│   ├── Manager（分店經理）
│   └── Sales（業務人員）
├── Teams（團隊/部門）- 有限的權限控制
│   ├── 台北分店團隊
│   ├── 台中分店團隊
│   └── 高雄分店團隊
└── Data（CRM 數據）
    ├── Companies（公司/廠商）
    ├── Contacts（聯絡人）
    ├── Opportunities（商機）
    └── Activities（活動）
```

---

### 方案對比表

| 方案 | 數據隔離 | 總部查看 | 實施難度 | 成本 | 推薦度 |
|------|---------|---------|---------|------|--------|
| **方案 1: 自定義字段 + 視圖** | ⚠️ 軟性隔離 | ✅ 可以 | 🟢 簡單 | 低 | ⭐⭐⭐⭐ |
| **方案 2: 獨立 Workspace** | ✅ 完全隔離 | ❌ 困難 | 🟡 中等 | 中 | ⭐⭐ |
| **方案 3: 自定義開發** | ✅ 完全隔離 | ✅ 可以 | 🔴 困難 | 高 | ⭐⭐⭐ |

---

### 方案 1: 自定義字段 + 視圖過濾（推薦）

#### 實施步驟

| 步驟 | 操作 | 說明 |
|------|------|------|
| **1. 創建自定義字段** | 在 Companies/Contacts 添加 | • 地區：台北/台中/高雄<br>• 負責團隊：下拉選單 |
| **2. 創建視圖** | 為每個分店創建專屬視圖 | • 台北客戶視圖<br>• 台中客戶視圖<br>• 高雄客戶視圖 |
| **3. 設定過濾規則** | 每個視圖設定過濾條件 | 過濾條件：地區 = "台北" |
| **4. 員工培訓** | 培訓員工使用對應視圖 | 台北員工只用台北視圖 |
| **5. 權限規範** | 制定使用規範文檔 | 軟性約束，非技術限制 |

#### 架構示意圖

```
統一連鎖超市（1 個 Workspace）
├── 用戶管理
│   ├── 總部管理員（可看全部）
│   ├── 台北分店經理（看台北視圖）
│   ├── 台北業務 A
│   ├── 台北業務 B
│   ├── 台中分店經理（看台中視圖）
│   └── 台中業務 A
├── 視圖管理
│   ├── 全部客戶視圖（總部用）
│   ├── 台北客戶視圖（過濾：地區=台北）
│   ├── 台中客戶視圖（過濾：地區=台中）
│   └── 高雄客戶視圖（過濾：地區=高雄）
└── 數據（共享，但按地區標記）
    ├── Company A（地區=台北）
    ├── Company B（地區=台中）
    └── Company C（地區=高雄）
```

#### 優缺點分析

| 類型 | 項目 | 說明 | 評分 |
|------|------|------|------|
| **✅ 優點** | 快速實施 | 無需開發，立即可用 | ⭐⭐⭐⭐⭐ |
| | 總部統計 | 可輕鬆查看全公司數據 | ⭐⭐⭐⭐⭐ |
| | 靈活性高 | 可隨時調整地區分類 | ⭐⭐⭐⭐ |
| | 成本低 | 無額外開發成本 | ⭐⭐⭐⭐⭐ |
| | 跨地區協作 | 可臨時查看其他地區數據 | ⭐⭐⭐⭐ |
| **❌ 缺點** | 無強制隔離 | 台北員工技術上能看台中數據 | ⭐⭐⭐ |
| | 依賴自律 | 需要員工遵守使用規範 | ⭐⭐ |
| | 誤操作風險 | 可能不小心修改其他地區數據 | ⭐⭐ |
| | 權限管理弱 | 無法設定嚴格的查看權限 | ⭐⭐⭐ |

#### 適用場景

| 場景 | 適用性 | 說明 |
|------|--------|------|
| **員工信任度高** | ✅ 非常適合 | 員工會遵守規範，不亂看數據 |
| **需要跨地區協作** | ✅ 非常適合 | 有時需要查看其他地區數據 |
| **總部需要統計** | ✅ 非常適合 | 總部可輕鬆做全公司分析 |
| **預算有限** | ✅ 非常適合 | 無需額外開發成本 |
| **高安全需求** | ❌ 不適合 | 無法保證數據絕對隔離 |

---

### 方案 2: 為每個分店創建獨立 Workspace

#### 實施步驟

| 步驟 | 操作 | 成本 |
|------|------|------|
| **1. 啟用多租戶** | 設定 `IS_MULTIWORKSPACE_ENABLED=true` | 配置調整 |
| **2. 創建 3 個 Workspace** | • taipei.customer.com<br>• taichung.customer.com<br>• kaohsiung.customer.com | 無額外成本 |
| **3. 數據遷移** | 按地區拆分現有數據 | 人工成本 |
| **4. 員工分配** | 每個分店的員工加入對應 Workspace | 無成本 |

#### 架構示意圖

```
┌─────────────────────────────────┐
│ 台北分店 Workspace               │
│ https://taipei.customer.com      │
├─────────────────────────────────┤
│ • 台北經理                       │
│ • 台北業務 A, B, C              │
│ • 台北的客戶數據（獨立）         │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 台中分店 Workspace               │
│ https://taichung.customer.com    │
├─────────────────────────────────┤
│ • 台中經理                       │
│ • 台中業務 A, B                 │
│ • 台中的客戶數據（獨立）         │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 高雄分店 Workspace               │
│ https://kaohsiung.customer.com   │
├─────────────────────────────────┤
│ • 高雄經理                       │
│ • 高雄業務 A, B                 │
│ • 高雄的客戶數據（獨立）         │
└─────────────────────────────────┘
```

#### 優缺點分析

| 類型 | 項目 | 說明 | 評分 |
|------|------|------|------|
| **✅ 優點** | 完全隔離 | 台北絕對看不到台中數據 | ⭐⭐⭐⭐⭐ |
| | 權限清晰 | 每個分店獨立管理 | ⭐⭐⭐⭐⭐ |
| | 安全性高 | 一個分店被攻擊不影響其他 | ⭐⭐⭐⭐ |
| **❌ 缺點** | 總部難統計 | 需要分別登入 3 個系統 | ⭐⭐⭐⭐ |
| | 數據不共享 | 跨分店客戶需重複輸入 | ⭐⭐⭐⭐ |
| | 管理複雜 | 需維護 3 個獨立 workspace | ⭐⭐⭐ |
| | 員工切換麻煩 | 輪調員工需重新加入 | ⭐⭐ |

#### 成本分析

| 項目 | 成本 | 說明 |
|------|------|------|
| **部署成本** | $0 | 共享同一實例 |
| **數據遷移** | $500-1000 | 人工拆分數據（一次性） |
| **培訓成本** | $300 | 培訓員工使用多系統 |
| **總部統計工具** | $100/月 | 可能需要第三方 BI 工具 |

---

### 方案 3: 自定義開發權限系統（企業級）

#### 開發需求

| 功能 | 描述 | 開發工作量 |
|------|------|-----------|
| **基於 Team 的 RLS** | PostgreSQL Row-Level Security | 2-3 週 |
| **細粒度權限** | 欄位級別的查看/編輯權限 | 3-4 週 |
| **權限管理 UI** | 管理員可視化配置權限 | 2 週 |
| **審計日誌** | 記錄誰查看/修改了什麼數據 | 1 週 |
| **測試與部署** | 完整測試和上線 | 2 週 |
| **總計** | - | **10-12 週** |

#### 成本估算

| 項目 | 成本 | 說明 |
|------|------|------|
| **開發人力** | $12,000-18,000 | 1 名全端工程師 × 3 個月 |
| **測試人力** | $3,000-5,000 | 測試工程師 |
| **專案管理** | $2,000-3,000 | PM 協調 |
| **維護成本** | $500/月 | 持續維護和 bug 修復 |
| **總計（首年）** | **$23,000-32,000** | 一次性開發 + 維護 |

#### 實現架構

```sql
-- PostgreSQL Row-Level Security 範例

-- 啟用 RLS
ALTER TABLE metadata.contact ENABLE ROW LEVEL SECURITY;

-- 創建政策：用戶只能看到自己團隊地區的數據
CREATE POLICY contact_team_isolation ON metadata.contact
FOR SELECT
USING (
  region = (
    SELECT team_region 
    FROM core.user_teams 
    WHERE user_id = current_user_id()
  )
);
```

#### 優缺點分析

| 類型 | 項目 | 說明 | 評分 |
|------|------|------|------|
| **✅ 優點** | 完美解決方案 | 兼顧隔離和統計需求 | ⭐⭐⭐⭐⭐ |
| | 總部可統計 | 管理員可查看全部數據 | ⭐⭐⭐⭐⭐ |
| | 權限靈活 | 可配置複雜權限規則 | ⭐⭐⭐⭐⭐ |
| | 審計完整 | 完整的操作日誌 | ⭐⭐⭐⭐ |
| **❌ 缺點** | 成本高 | 需要 $23k-32k 開發費用 | ⭐⭐⭐⭐⭐ |
| | 時間長 | 需要 3 個月開發時間 | ⭐⭐⭐⭐ |
| | 維護成本 | 每月 $500 維護費用 | ⭐⭐⭐ |
| | 升級風險 | Twenty CRM 升級可能衝突 | ⭐⭐⭐ |

---

## 方案決策矩陣

### Q1: 10 個客戶部署決策

| 決策因素 | 單租戶模式 | 多租戶模式 | 權重 |
|---------|-----------|-----------|------|
| **初期成本** | ❌ 高（$330/月） | ✅ 低（$215/月） | 30% |
| **數據安全** | ✅ 物理隔離 | ⚠️ 邏輯隔離 | 25% |
| **維護成本** | ❌ 高（10 個實例） | ✅ 低（1 個實例） | 20% |
| **性能隔離** | ✅ 完全獨立 | ❌ 互相影響 | 15% |
| **擴展性** | ⚠️ 中等 | ✅ 快速 | 10% |

#### 推薦決策流程圖

```
開始
  ↓
客戶有嚴格合規需求？（金融/醫療）
  ├─ 是 → 單租戶模式（必須）
  └─ 否 ↓
      客戶數 < 7 個？
      ├─ 是 → 單租戶模式（成本更低）
      └─ 否 ↓
          每個客戶用戶數 > 100？
          ├─ 是 → 單租戶模式（性能需求）
          └─ 否 ↓
              預算 < $3,000/年？
              ├─ 是 → 多租戶模式（成本優先）
              └─ 否 → 根據具體需求評估
```

---

### Q2: 多分店管理決策

| 決策因素 | 方案 1<br>自定義字段 | 方案 2<br>獨立 Workspace | 方案 3<br>自定義開發 | 權重 |
|---------|-------------------|----------------------|-------------------|------|
| **實施難度** | ✅ 簡單（1天） | ⚠️ 中等（1週） | ❌ 困難（3月） | 25% |
| **成本** | ✅ $0 | ⚠️ $1,500 | ❌ $25,000 | 30% |
| **數據隔離** | ❌ 軟性 | ✅ 完全 | ✅ 完全 | 20% |
| **總部統計** | ✅ 容易 | ❌ 困難 | ✅ 容易 | 15% |
| **維護成本** | ✅ 低 | ⚠️ 中 | ❌ 高 | 10% |

#### 推薦決策

| 場景 | 推薦方案 | 理由 |
|------|---------|------|
| **員工互信，預算有限** | 方案 1 | 成本低、易實施、總部統計方便 |
| **高度機密，絕對隔離** | 方案 2 | 數據完全隔離，安全性高 |
| **大型企業，長期使用** | 方案 3 | 完美解決方案，值得投資 |
| **初期測試階段** | 方案 1 | 快速驗證，之後可升級 |

---

## 混合方案建議

### 分層客戶策略

```
客戶分類與對應部署方案：

┌─────────────────────────────────────────┐
│ 企業級客戶（年費 > $10,000）              │
│ • 單租戶獨立部署                          │
│ • 客戶數：2-3 個                         │
│ • 部署成本：$100/月/客戶                  │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 標準客戶（年費 $3,000-10,000）            │
│ • 多租戶共享實例 A                        │
│ • 客戶數：10-15 個                       │
│ • 部署成本：$20/月/客戶                   │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 小型客戶（年費 < $3,000）                 │
│ • 多租戶共享實例 B                        │
│ • 客戶數：20-30 個                       │
│ • 部署成本：$10/月/客戶                   │
└─────────────────────────────────────────┘

總成本：$250 + $300 + $300 = $850/月
總客戶：32-48 個
平均成本：$18-27/月/客戶
```

---

## 總結與建議

### Q1 總結

**推薦方案**: 
1. **0-5 個客戶**: 單租戶模式（成本相當）
2. **5-20 個客戶**: 多租戶模式（成本優勢明顯）
3. **20+ 個客戶**: 多租戶模式（成本節省 > 70%）
4. **特殊客戶**: 單獨單租戶部署

**成本對比**:
- 單租戶：$330/月（10 客戶）
- 多租戶：$215/月（10 客戶）
- 節省：$1,380/年（35%）

### Q2 總結

**推薦方案**:
1. **初期/中小企業**: 方案 1（自定義字段 + 視圖）
2. **高安全需求**: 方案 2（獨立 Workspace）
3. **大型企業**: 方案 3（自定義開發）- 值得長期投資

**實施建議**:
1. 先用方案 1 快速驗證（成本 $0）
2. 根據實際使用情況評估
3. 如有強烈需求再升級到方案 3

---

## 附錄：快速參考表

### 雲服務商性價比排名（2025）

| 排名 | 服務商 | 適合場景 | 月成本（2vCPU/4GB） |
|------|--------|---------|-------------------|
| 🥇 | **Linode** | 所有場景 | $30 |
| 🥈 | **Vultr** | 高流量應用 | $24 |
| 🥉 | **DigitalOcean** | 初創公司 | $24 |
| 4 | AWS (t3a) | 企業級 | $27.45 |
| 5 | GCP | Google 生態 | $33 |

### 成本節省建議

| 優化項目 | 節省比例 | 實施難度 |
|---------|---------|---------|
| **使用 Reserved Instances** | 30-40% | 🟢 簡單 |
| **啟用自動縮放** | 20-30% | 🟡 中等 |
| **使用 Spot Instances** | 50-70% | 🔴 困難 |
| **優化存儲分層** | 20-30% | 🟢 簡單 |
| **使用 CDN（Cloudflare）** | 流量成本 50% | 🟢 簡單 |

---

**文檔版本**: 1.0  
**最後更新**: 2025-10-17  
**作者**: AI Assistant  
**審核狀態**: 待審核

