  âš ï¸ ä¸è¶³èˆ‡æ”¹é€²å»ºè­°

  1. æŠ€è¡“ç´°ç¯€ç¼ºå¤±

  å•é¡Œ 1.1: Contact vs Person å¯¦é«”æ··æ·†

  - å•é¡Œ: æ–¹æ¡ˆä¸­å¤šæ¬¡æåˆ° Contact å¯¦é«”å’Œ ContactService
  - å¯¦éš›æƒ…æ³: æˆ‘æª¢è¦–å°ˆæ¡ˆå¾Œç™¼ç¾ï¼ŒTwenty CRM ä½¿ç”¨çš„æ˜¯ PersonWorkspaceEntity è€Œé Contact
    - è·¯å¾‘: packages/twenty-server/src/modules/person/standard-objects/person.workspace-entity.ts
  - å½±éŸ¿: æ–¹æ¡ˆä¸­æ‰€æœ‰å° Contact çš„å¼•ç”¨éƒ½éœ€è¦ä¿®æ­£ç‚º Person
  - å»ºè­°:
  // æ‡‰è©²æ˜¯
  PersonWorkspaceEntity {
    lineUserId: string | null;
    lineDisplayName: string | null;
    lineProfilePictureUrl: string | null;
    lineStatus: 'active' | 'blocked' | 'unlinked' | null;
    lastLineInteractionAt: Date | null;
  }

  å•é¡Œ 1.2: TypeORM å¯¦é«”å®šç¾©æ–¹å¼éŒ¯èª¤

  - å•é¡Œ: æ–¹æ¡ˆæåˆ°ä½¿ç”¨ @BeforeInsert() å’Œ @BeforeUpdate() é€²è¡Œè‡ªå‹•åŠ å¯†
  - å¯¦éš›æƒ…æ³: Twenty ä½¿ç”¨çš„æ˜¯è‡ªè¨‚çš„ @WorkspaceField() è£é£¾å™¨ç³»çµ±ï¼Œè€Œéæ¨™æº– TypeORM
    - åƒè€ƒ: PersonWorkspaceEntity ä½¿ç”¨ @WorkspaceEntity, @WorkspaceField, @WorkspaceIsNullable ç­‰
  - å»ºè­°: åŠ å¯†é‚è¼¯æ‡‰è©²åœ¨ Service å±¤è™•ç†ï¼Œè€Œé Entity å±¤

  å•é¡Œ 1.3: ç¼ºå°‘ Module ä¾è³´é—œä¿‚èªªæ˜

  - å•é¡Œ: æœªèªªæ˜ LineIntegrationModule éœ€è¦ import å“ªäº›ç¾æœ‰ Module
  - å»ºè­°: è‡³å°‘éœ€è¦:
  @Module({
    imports: [
      HttpModule,           // ç”¨æ–¼ LineApiService
      TypeOrmModule,        // è³‡æ–™åº«æ“ä½œ
      PersonModule,         // æ“ä½œ Person å¯¦é«”
      WorkflowExecutorModule, // å·¥ä½œæµæ•´åˆ
    ],
    // ...
  })

  2. å¯¦ä½œæ­¥é©Ÿä¸å¤ å…·é«”

  å•é¡Œ 2.1: Database Migration æµç¨‹ç¼ºå¤±

  - å•é¡Œ: æåˆ°æ“´å…… Person å¯¦é«”ï¼Œä½†æœªèªªæ˜å¦‚ä½•ç”¢ç”Ÿå’ŒåŸ·è¡Œ Migration
  - å»ºè­°: æ‡‰è£œå……:
  # 1. ä¿®æ”¹ PersonWorkspaceEntity å¾Œ
  npx nx run twenty-server:database:migrate:generate -- --migrationName=AddLineFieldsToPerson

  # 2. æª¢æŸ¥ç”¢ç”Ÿçš„ migration æª”æ¡ˆ
  # 3. åŸ·è¡Œ migration
  npx nx run twenty-server:database:migrate

  å•é¡Œ 2.2: ç’°å¢ƒè®Šæ•¸é…ç½®èªªæ˜ä¸è¶³

  - å•é¡Œ: æåˆ° process.env.LINE_CONFIG_ENCRYPTION_KEY ä½†æœªèªªæ˜å¦‚ä½•è¨­å®š
  - å»ºè­°: æ‡‰è©²èªªæ˜éœ€è¦ä¿®æ”¹:
    - packages/twenty-server/.env.example
    - deployment/docker-compose.local-test.yml (ç’°å¢ƒè®Šæ•¸å‚³é)

  3. å‰ç«¯å¯¦ä½œç´°ç¯€éæ–¼ç°¡ç•¥

  å•é¡Œ 3.1: UI å…ƒä»¶è·¯å¾‘ä¸å¤ ç²¾ç¢º

  - å•é¡Œ: "åœ¨ packages/twenty-front/src/modules/settings/components/ å»ºç«‹è¨­å®šé é¢"
  - å»ºè­°: æ‡‰è©²æ›´å…·é«”ï¼Œä¾‹å¦‚:
    - å»ºç«‹ SettingsIntegrations/SettingsIntegrationLine.tsx
    - åœ¨ SettingsRoutes.tsx ä¸­è¨»å†Šè·¯ç”±
    - ä½¿ç”¨ç¾æœ‰çš„ SettingsCard å’Œ SettingsFieldInput å…ƒä»¶

  å•é¡Œ 3.2: Workflow Action UI è¨»å†Šæµç¨‹ä¸å®Œæ•´

  - å•é¡Œ: "åœ¨ .../constants/actions/ ä¸‹å®šç¾©æ–° Action çš„å…ƒæ•¸æ“š"
  - å»ºè­°: æ‡‰è©²æ˜ç¢ºæŒ‡å‡º:
    a. åœ¨ packages/twenty-front/src/modules/workflow/workflow-steps/workflow-actions/constants/actions/ å»ºç«‹
  SendLineMessageAction.ts
    b. åœ¨
  packages/twenty-front/src/modules/workflow/workflow-steps/workflow-actions/constants/WorkflowActionsMapping.tsx
  ä¸­è¨»å†Š
    c. å¯¦ä½œå°æ‡‰çš„ WorkflowEditActionSendLineMessage.tsx å…ƒä»¶

  4. æ¸¬è©¦ç­–ç•¥å®Œå…¨ç¼ºå¤±

  æ–¹æ¡ˆä¸­å®Œå…¨æœªæåŠæ¸¬è©¦ï¼Œé€™æ˜¯é‡å¤§ç¼ºé™·ã€‚å»ºè­°è£œå……:
  - å–®å…ƒæ¸¬è©¦: æ¯å€‹ Service å’Œ Guard éƒ½éœ€è¦ .spec.ts
  - æ•´åˆæ¸¬è©¦: Webhook ç«¯é»çš„å®Œæ•´æµç¨‹æ¸¬è©¦
  - E2E æ¸¬è©¦: å·¥ä½œæµåŸ·è¡Œçš„ç«¯åˆ°ç«¯æ¸¬è©¦

  5. éŒ¯èª¤è™•ç†èˆ‡ç›£æ§ä¸è¶³

  å•é¡Œ 5.1: LINE API éŒ¯èª¤è™•ç†ä¸å®Œæ•´

  - æ–¹æ¡ˆæåˆ°ã€Œæ•ç²ä¸¦è§£æ API å›å‚³çš„éŒ¯èª¤ã€ï¼Œä½†æœªèªªæ˜:
    - Rate Limit è™•ç† (LINE API æœ‰åš´æ ¼çš„é€Ÿç‡é™åˆ¶)
    - é‡è©¦æ©Ÿåˆ¶
    - éŒ¯èª¤è¨˜éŒ„èˆ‡å‘Šè­¦

  å•é¡Œ 5.2: Webhook å¯é æ€§è€ƒé‡

  - æœªæåŠ:
    - Webhook å¤±æ•—é‡è©¦ (LINE æœƒé‡é€)
    - å†ªç­‰æ€§è™•ç† (é¿å…é‡è¤‡è™•ç†åŒä¸€äº‹ä»¶)
    - äº‹ä»¶è™•ç†çš„éåŒæ­¥ä½‡åˆ—åŒ– (æ‡‰è©²ä½¿ç”¨ BullMQ)

  6. éƒ¨ç½²èˆ‡ç¶­é‹è€ƒé‡ç¼ºå¤±

  - ç¼ºå°‘:
    - Docker æ˜ åƒæ›´æ–°æµç¨‹
    - ç’°å¢ƒè®Šæ•¸åœ¨ä¸åŒç’°å¢ƒçš„ç®¡ç†
    - é‡‘é‘°è¼ªæ›ç­–ç•¥
    - ç›£æ§æŒ‡æ¨™å®šç¾©

  ---
  ğŸ“‹ å®Œæ•´æ€§è©•åˆ†

  | è©•ä¼°é¢å‘  | è©•åˆ†   | èªªæ˜                              |
  |-------|------|---------------------------------|
  | æ¶æ§‹è¨­è¨ˆ  | 9/10 | æ¨¡çµ„åŒ–èˆ‡è·è²¬åˆ†é›¢å„ªç§€ï¼Œä½†ç¼ºå°‘ä¾è³´é—œä¿‚åœ–             |
  | å®‰å…¨æ€§   | 8/10 | åŠ å¯†èˆ‡ç°½ç« é©—è­‰è¨­è¨ˆè‰¯å¥½ï¼Œä½†é‡‘é‘°ç®¡ç†ç´°ç¯€ä¸è¶³           |
  | æŠ€è¡“æº–ç¢ºæ€§ | 6/10 | Contact/Person æ··æ·†ã€TypeORM è£é£¾å™¨èª¤ç”¨ |
  | å¯¦ä½œå¯è¡Œæ€§ | 7/10 | æ ¸å¿ƒé‚è¼¯æ¸…æ™°ï¼Œä½†ç¼ºå°‘ Migrationã€ç’°å¢ƒé…ç½®ç­‰é—œéµæ­¥é©Ÿ  |
  | æ¸¬è©¦èˆ‡å“è³ª | 3/10 | å®Œå…¨ç¼ºå°‘æ¸¬è©¦ç­–ç•¥                        |
  | ç¶­é‹èˆ‡ç›£æ§ | 4/10 | æœªè€ƒæ…®éŒ¯èª¤è™•ç†ã€é‡è©¦ã€ç›£æ§                   |
  | æ–‡ä»¶å®Œæ•´æ€§ | 7/10 | æ ¸å¿ƒåŠŸèƒ½æè¿°å®Œæ•´ï¼Œä½†å¯¦ä½œç´°ç¯€ä¸è¶³                |

  ç¶œåˆè©•åˆ†: 6.5/10

  ---
  ğŸ¯ ç¸½çµå»ºè­°

  âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨çš„éƒ¨åˆ†:

  1. æ•´é«”æ¨¡çµ„æ¶æ§‹è¨­è¨ˆ (LineIntegrationModule çš„æœå‹™åŠƒåˆ†)
  2. å®‰å…¨æ€§è¨­è¨ˆæ€è·¯ (åŠ å¯†ã€ç°½ç« é©—è­‰)
  3. Webhook äº‹ä»¶è™•ç†é‚è¼¯
  4. å·¥ä½œæµæ•´åˆçš„ä¸‰å±¤æ¶æ§‹æ€è·¯

  âš ï¸ éœ€è¦ä¿®æ­£æ‰èƒ½å¯¦ä½œçš„éƒ¨åˆ†:

  1. ç«‹å³ä¿®æ­£: æ‰€æœ‰ Contact æ”¹ç‚º Person
  2. é‡æ–°è¨­è¨ˆ: Entity çš„åŠ å¯†é‚è¼¯æ”¹ç‚º Service å±¤å¯¦ä½œ
  3. è£œå……: Database Migration å®Œæ•´æ­¥é©Ÿ
  4. è£œå……: ç’°å¢ƒè®Šæ•¸é…ç½®èˆ‡ Docker éƒ¨ç½²ç´°ç¯€
  5. è£œå……: å®Œæ•´çš„æ¸¬è©¦ç­–ç•¥
  6. è£œå……: éŒ¯èª¤è™•ç†èˆ‡é‡è©¦æ©Ÿåˆ¶è¨­è¨ˆ

  ğŸ’¡ å¯¦ä½œå„ªå…ˆé †åºå»ºè­°:

  1. Phase 1: ä¿®æ­£æ–‡ä»¶ä¸­çš„æŠ€è¡“éŒ¯èª¤ï¼Œè£œå…… Migration å’Œç’°å¢ƒé…ç½®æ­¥é©Ÿ
  2. Phase 2: å¯¦ä½œæ ¸å¿ƒåŠŸèƒ½ (Config, Webhook, API Service)
  3. Phase 3: æ•´åˆå·¥ä½œæµç³»çµ±
  4. Phase 4: å®Œå–„æ¸¬è©¦ã€ç›£æ§èˆ‡éŒ¯èª¤è™•ç†

  ---
  çµè«–: æ­¤æ–¹æ¡ˆçš„æ¶æ§‹è¨­è¨ˆå’Œæ¥­å‹™é‚è¼¯æ˜¯åˆç†ä¸”å„ªç§€çš„ï¼Œä½†åœ¨æŠ€è¡“å¯¦ä½œç´°ç¯€ã€æ¸¬è©¦ç­–ç•¥å’Œç¶­é‹è€ƒé‡æ–¹é¢å­˜åœ¨æ˜é¡¯ä¸è¶³ã€‚å»ºè­°åœ¨å¯¦éš›é–‹
  ç™¼å‰ï¼Œå…ˆæ ¹æ“šä¸Šè¿°åˆ†æé€²è¡Œæ–¹æ¡ˆä¿®è¨‚èˆ‡ç´°åŒ–ã€‚