# 核心原因分析報告：使用者操作卡頓與不順暢

## 摘要
本報告分析了導致系統操作卡頓、不順暢以及數據顯示異常的核心技術原因。經過深入的代碼審查與日誌分析，我們確認了幾個關鍵的性能瓶頸與配置錯誤。

## 1. 殭屍數據 (Zombie Records) - 嚴重影響
這是導致「操作不順暢」與「數據異常」的最主要原因。

*   **問題描述**：後端 API 在查詢數據時，沒有正確過濾掉已經「軟刪除」(Soft Deleted) 的資料。
*   **技術細節**：
    *   系統使用 `deletedAt` 欄位來標記刪除，但在核心查詢服務 `FindRecordsService` 與 `GraphqlQueryParser` 中，預設沒有自動加上 `deletedAt IS NULL` 的過濾條件。
    *   這意味著，當前端請求「聯絡人列表」或「公司列表」時，後端會回傳**所有**曾經建立過的資料，包含應該被隱藏的刪除資料。
*   **對使用者的影響**：
    *   **傳輸量暴增**：前端需要下載比實際需求多得多的數據，導致載入變慢。
    *   **前端卡頓**：瀏覽器需要處理與渲染這些多餘的數據（即使不顯示，可能仍在記憶體中），消耗大量記憶體與 CPU。
    *   **邏輯錯亂**：使用者可能會看到「幽靈數據」一閃而過，或是在關聯數據中看到不該存在的項目，造成操作困惑。

## 2. 日誌濫發 (Log Spam) / I/O 瓶頸 - 中度影響
大量的無效日誌寫入佔用了系統資源。

*   **問題描述**：後端日誌中充滿了數千條 `Uncompiled message detected` 與 `Please compile your catalog first` 的警告。
*   **技術細節**：
    *   國際化 (i18n) 套件 `lingui` 的翻譯檔 (`.po`) 沒有被編譯成執行檔 (`.js`/`.ts`)。
    *   每次系統嘗試顯示一段文字時，都會觸發錯誤檢查並寫入日誌。
*   **對使用者的影響**：
    *   **伺服器延遲**：大量的日誌寫入 (Disk I/O) 會競爭磁碟資源，並增加 CPU 的 Context Switch，導致 API 回應變慢。
    *   **除錯困難**：真正的錯誤訊息會被淹沒在海量的警告中。

## 3. 開發/除錯模式開啟 (Debug Mode Enabled) - 潛在影響
系統似乎運行在非最佳化的開發模式下。

*   **問題描述**：Docker 配置顯示 `VITE_IS_DEBUG_MODE` 與一般的 `IS_DEBUG_MODE` 預設為 `true`。
*   **技術細節**：
    *   **前端 (Vite)**：Debug 模式下，前端資源通常不會被壓縮 (Minify)，且包含大量的 Source Map 與開發時期的檢查代碼。
    *   **後端 (NestJS/TypeORM)**：Debug 模式可能會開啟詳細的 SQL 查詢日誌 (Query Logging)，這會極大降低資料庫效能。
*   **對使用者的影響**：
    *   網頁載入時間顯著增加（檔案體積大）。
    *   執行速度變慢（額外的運行時檢查）。

## 4. 非同步任務隊列積壓 - 潛在影響
*   **問題描述**：我們觀察到 `worker` 容器在處理大量 `FavoriteDeletionJob` 等背景任務。
*   **技術細節**：由於之前「殭屍數據」的問題，可能導致關聯刪除邏輯觸發異常大量的背景任務。
*   **對使用者的影響**：如果 Worker 忙於處理無效的資料清理，真正的背景任務（如發送通知、資料同步）會被延遲，讓使用者覺得系統「反應遲鈍」。

## 建議修復方案摘要
1.  **[已實作]** 修正後端查詢邏輯，強制過濾 `deletedAt` 不為空的資料。
2.  **[已實作]** 編譯翻譯檔，消除日誌雜訊。
3.  **[建議]** 在確認修復後，將環境變數中的 Debug 模式關閉，並優化 Docker 資源配置。

此報告旨在釐清當前效能問題的根源，以利後續決策。
