# Twenty CRM å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ“¦ å¿«é€Ÿé–‹å§‹

### æ–¹å¼ä¸€ï¼šä¸€éµå•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰

```bash
./ä¸€éµå•Ÿå‹•.sh
```

é€™å€‹è…³æœ¬æœƒè‡ªå‹•ï¼š
- âœ… æª¢æŸ¥ç³»çµ±ç’°å¢ƒ
- âœ… å•Ÿå‹• PostgreSQL å’Œ Redis
- âœ… è¨­ç½®æ‰€æœ‰ç’°å¢ƒè®Šæ•¸
- âœ… å•Ÿå‹•å¾Œç«¯ã€å‰ç«¯å’Œ Worker
- âœ… é©—è­‰å¤šç§Ÿæˆ¶é…ç½®

### æ–¹å¼äºŒï¼šåˆ†æ­¥å•Ÿå‹•

```bash
# 1. å•Ÿå‹•æœå‹™
./start-twenty-local.sh

# 2. å¦‚æœé‡åˆ°å•é¡Œï¼Œé‹è¡Œè¨ºæ–·
./è¨ºæ–·ä¸¦ä¿®å¾©.sh

# 3. åœæ­¢æœå‹™
./stop-twenty-local.sh
```

## ğŸ”§ é…ç½®èªªæ˜

æ‰€æœ‰é…ç½®éƒ½åœ¨ `twenty-config.sh` æ–‡ä»¶ä¸­ï¼š

```bash
# ä¿®æ”¹å¤–éƒ¨è¨ªå•åœ°å€
export EXTERNAL_HOST="your-domain.com"

# ä¿®æ”¹ç«¯å£
export FRONTEND_PORT=8866
export BACKEND_PORT=8867

# å¤šç§Ÿæˆ¶é…ç½®
export DEFAULT_SUBDOMAIN="apple"
export IS_MULTIWORKSPACE_ENABLED="true"
```

## ğŸŒ è¨ªå•åœ°å€

### é–‹ç™¼ç’°å¢ƒï¼ˆä½¿ç”¨ nip.ioï¼‰

- **é»˜èªå·¥ä½œå€**ï¼š`http://apple.118.168.188.27.nip.io:8866`
- **å¾Œç«¯ API**ï¼š`http://118.168.188.27.nip.io:8867`

### ç”Ÿç”¢ç’°å¢ƒï¼ˆä½¿ç”¨çœŸå¯¦åŸŸåï¼‰

ä¿®æ”¹ `twenty-config.sh`ï¼š
```bash
export EXTERNAL_HOST="your-domain.com"
```

è¨ªå•åœ°å€è®Šç‚ºï¼š
- **é»˜èªå·¥ä½œå€**ï¼š`http://apple.your-domain.com:8866`

## ğŸ› å¸¸è¦‹å•é¡Œ

### å•é¡Œ 1ï¼šè¨ªå•è·³è½‰åˆ°éŒ¯èª¤çš„ URLï¼ˆ`.domain.com`ï¼‰

**ç—‡ç‹€**ï¼šè¨ªå•æ™‚è·³è½‰åˆ° `http://.118.168.188.27.nip.io:8866/welcome`

**åŸå› **ï¼š`defaultSubdomain` ç’°å¢ƒè®Šæ•¸æœªæ­£ç¢ºå‚³éçµ¦å¾Œç«¯

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ä¸€éµå•Ÿå‹•è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
./stop-twenty-local.sh
./ä¸€éµå•Ÿå‹•.sh

# æ–¹æ³• 2ï¼šé‹è¡Œè¨ºæ–·ä¸¦ä¿®å¾©
./è¨ºæ–·ä¸¦ä¿®å¾©.sh
```

### å•é¡Œ 2ï¼šç’°å¢ƒè®Šæ•¸é‡å•Ÿå¾Œå¤±æ•ˆ

**åŸå› **ï¼šç’°å¢ƒè®Šæ•¸åªåœ¨ç•¶å‰ shell æœƒè©±ä¸­æœ‰æ•ˆ

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå§‹çµ‚ä½¿ç”¨æä¾›çš„å•Ÿå‹•è…³æœ¬ï¼Œå®ƒå€‘æœƒè‡ªå‹•åŠ è¼‰é…ç½®

### å•é¡Œ 3ï¼šç«¯å£è¢«ä½”ç”¨

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# æª¢æŸ¥ä½”ç”¨ç«¯å£çš„é€²ç¨‹
lsof -i :8866
lsof -i :8867

# ä½¿ç”¨åœæ­¢è…³æœ¬æ¸…ç†
./stop-twenty-local.sh
```

### å•é¡Œ 4ï¼šæ•¸æ“šåº«é€£æ¥å¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# æª¢æŸ¥ PostgreSQL ç‹€æ…‹
brew services list | grep postgresql

# é‡å•Ÿ PostgreSQL
brew services restart postgresql@16

# æª¢æŸ¥ç«¯å£
lsof -i :5432
```

## ğŸ“Š æœå‹™ç‹€æ…‹æª¢æŸ¥

### æª¢æŸ¥æ‰€æœ‰æœå‹™

```bash
# PostgreSQL
lsof -i :5432

# Redis
lsof -i :6379

# å¾Œç«¯ API
lsof -i :8867

# å‰ç«¯ Web
lsof -i :8866

# Worker
ps aux | grep queue-worker
```

### æŸ¥çœ‹æ—¥èªŒ

```bash
# å¯¦æ™‚æŸ¥çœ‹æ‰€æœ‰æ—¥èªŒ
tail -f twenty.log

# åªçœ‹éŒ¯èª¤
grep -i error twenty.log

# åªçœ‹å¾Œç«¯æ—¥èªŒ
grep "twenty-server" twenty.log
```

## ğŸ”„ å¤šç§Ÿæˆ¶ç®¡ç†

### å‰µå»ºæ–°çš„ Workspace

1. è¨ªå•é»˜èªå·¥ä½œå€ï¼š`http://apple.118.168.188.27.nip.io:8866`
2. ä»¥ç®¡ç†å“¡èº«ä»½ç™»å…¥
3. åœ¨ç®¡ç†é¢æ¿å‰µå»ºæ–° workspace
4. ç³»çµ±æœƒè‡ªå‹•åˆ†é…å­åŸŸåï¼ˆå¦‚ `banana.118.168.188.27.nip.io:8866`ï¼‰

### åˆ‡æ› Workspace

æ–¹å¼ä¸€ï¼šé€šé URL ç›´æ¥è¨ªå•
```
http://{subdomain}.118.168.188.27.nip.io:8866
```

æ–¹å¼äºŒï¼šåœ¨æ‡‰ç”¨å…§åˆ‡æ›
- é»æ“Šå·¦ä¸Šè§’ workspace é¸æ“‡å™¨
- é¸æ“‡è¦åˆ‡æ›çš„ workspace

## ğŸš€ é·ç§»åˆ°æ–°æ©Ÿå™¨

### æº–å‚™å·¥ä½œ

1. **åœ¨èˆŠæ©Ÿå™¨ä¸Š**ï¼š

```bash
# å‚™ä»½æ•¸æ“šåº«
pg_dump -h localhost -p 5432 -U postgres -d default > twenty_backup.sql

# æ‰“åŒ…é …ç›®ï¼ˆåŒ…å«é…ç½®ï¼‰
tar -czf twenty-migration.tar.gz \
    twenty-config.sh \
    ä¸€éµå•Ÿå‹•.sh \
    stop-twenty-local.sh \
    è¨ºæ–·ä¸¦ä¿®å¾©.sh \
    twenty_backup.sql
```

2. **åœ¨æ–°æ©Ÿå™¨ä¸Š**ï¼š

```bash
# 1. å®‰è£ä¾è³´
brew install node yarn postgresql@16 redis

# 2. å…‹éš†é …ç›®
git clone <your-repo>
cd twenty-ym

# 3. è§£å£“é…ç½®æ–‡ä»¶
tar -xzf twenty-migration.tar.gz

# 4. ä¿®æ”¹é…ç½®ï¼ˆå¦‚æœ IP è®Šäº†ï¼‰
vim twenty-config.sh
# æ›´æ–° EXTERNAL_HOST

# 5. å®‰è£ä¾è³´
yarn install

# 6. æ¢å¾©æ•¸æ“šåº«
createdb -U postgres default
psql -U postgres -d default < twenty_backup.sql

# 7. ä¸€éµå•Ÿå‹•
./ä¸€éµå•Ÿå‹•.sh
```

### æœ€å°åŒ–é…ç½®æ–‡ä»¶

åªéœ€è¦é€™äº›æ–‡ä»¶å°±èƒ½åœ¨æ–°æ©Ÿå™¨ä¸Šé‹è¡Œï¼š

```
ğŸ“ twenty-ym/
â”œâ”€â”€ ğŸ“„ twenty-config.sh          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ ä¸€éµå•Ÿå‹•.sh                # å•Ÿå‹•è…³æœ¬
â”œâ”€â”€ ğŸ“„ stop-twenty-local.sh      # åœæ­¢è…³æœ¬
â”œâ”€â”€ ğŸ“„ è¨ºæ–·ä¸¦ä¿®å¾©.sh              # è¨ºæ–·è…³æœ¬
â””â”€â”€ ğŸ“„ twenty_backup.sql         # æ•¸æ“šåº«å‚™ä»½ï¼ˆå¯é¸ï¼‰
```

## ğŸ” ç’°å¢ƒè®Šæ•¸èªªæ˜

### å¿…éœ€çš„ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸å | èªªæ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `FRONTEND_URL` | å‰ç«¯è¨ªå•åœ°å€ | `http://118.168.188.27.nip.io:8866` |
| `SERVER_URL` | å¾Œç«¯ API åœ°å€ | `http://118.168.188.27.nip.io:8867` |
| `DEFAULT_SUBDOMAIN` | é»˜èªå·¥ä½œå€å­åŸŸå | `apple` |
| `IS_MULTIWORKSPACE_ENABLED` | å•Ÿç”¨å¤šç§Ÿæˆ¶ | `true` |
| `PG_DATABASE_URL` | PostgreSQL é€£æ¥ | `postgres://postgres:postgres@localhost:5432/default` |
| `REDIS_URL` | Redis é€£æ¥ | `redis://localhost:6379` |

### å¯é¸çš„ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸å | èªªæ˜ | é»˜èªå€¼ |
|--------|------|--------|
| `EMAIL_DRIVER` | éƒµä»¶é©…å‹• | `LOGGER` |
| `IS_BILLING_ENABLED` | å•Ÿç”¨è¨ˆè²» | `false` |
| `SIGN_IN_PREFILLED` | é å¡«ç™»å…¥ä¿¡æ¯ | `false` |

## ğŸ“š è…³æœ¬èªªæ˜

### ä¸€éµå•Ÿå‹•.sh

å®Œæ•´çš„å•Ÿå‹•è…³æœ¬ï¼ŒåŒ…å«ï¼š
- ç’°å¢ƒæª¢æŸ¥
- ä¾è³´æœå‹™å•Ÿå‹•
- ç’°å¢ƒè®Šæ•¸è¨­ç½®
- Twenty æœå‹™å•Ÿå‹•
- é…ç½®é©—è­‰

### stop-twenty-local.sh

å„ªé›…åœ°åœæ­¢æ‰€æœ‰æœå‹™ï¼š
1. Worker
2. å‰ç«¯ Web
3. å¾Œç«¯ API
4. Redis
5. PostgreSQL

### è¨ºæ–·ä¸¦ä¿®å¾©.sh

è‡ªå‹•è¨ºæ–·å¸¸è¦‹å•é¡Œï¼š
- æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
- æª¢æŸ¥å¾Œç«¯é…ç½®
- æª¢æŸ¥æ•¸æ“šåº« workspace
- æä¾›è‡ªå‹•ä¿®å¾©é¸é …

## ğŸ¯ æœ€ä½³å¯¦è¸

### é–‹ç™¼ç’°å¢ƒ

1. **ä½¿ç”¨ nip.io**ï¼šç„¡éœ€é…ç½® DNS
   ```bash
   export EXTERNAL_HOST="118.168.188.27.nip.io"
   ```

2. **å•Ÿç”¨é å¡«ç™»å…¥**ï¼šå¿«é€Ÿæ¸¬è©¦
   ```bash
   export SIGN_IN_PREFILLED="true"
   ```

3. **ç¦ç”¨è¨ˆè²»**ï¼šé¿å…ä¸å¿…è¦çš„é…ç½®
   ```bash
   export IS_BILLING_ENABLED="false"
   ```

### ç”Ÿç”¢ç’°å¢ƒ

1. **ä½¿ç”¨çœŸå¯¦åŸŸå**ï¼š
   ```bash
   export EXTERNAL_HOST="crm.your-company.com"
   ```

2. **ç¦ç”¨é å¡«ç™»å…¥**ï¼š
   ```bash
   export SIGN_IN_PREFILLED="false"
   ```

3. **å•Ÿç”¨ HTTPS**ï¼šé…ç½®åå‘ä»£ç†ï¼ˆNginx/Caddyï¼‰

4. **é™åˆ¶ workspace å‰µå»º**ï¼š
   ```bash
   export IS_WORKSPACE_CREATION_LIMITED_TO_SERVER_ADMINS="true"
   ```

## ğŸ› ï¸ æ•…éšœæ’é™¤æµç¨‹

```mermaid
graph TD
    A[é‡åˆ°å•é¡Œ] --> B{æœå‹™é‹è¡Œä¸­?}
    B -->|å¦| C[./ä¸€éµå•Ÿå‹•.sh]
    B -->|æ˜¯| D[./è¨ºæ–·ä¸¦ä¿®å¾©.sh]
    D --> E{é…ç½®æ­£ç¢º?}
    E -->|å¦| F[ä¿®å¾©é…ç½®ä¸¦é‡å•Ÿ]
    E -->|æ˜¯| G[æª¢æŸ¥æ—¥èªŒ: tail -f twenty.log]
    F --> H[./stop-twenty-local.sh]
    H --> C
    G --> I{æ‰¾åˆ°éŒ¯èª¤?}
    I -->|æ˜¯| J[æ ¹æ“šéŒ¯èª¤ä¿®å¾©]
    I -->|å¦| K[è¯ç¹«æŠ€è¡“æ”¯æŒ]
```

## ğŸ“ æ”¯æŒ

å¦‚é‡åˆ°ç„¡æ³•è§£æ±ºçš„å•é¡Œï¼š

1. æŸ¥çœ‹å®Œæ•´æ—¥èªŒï¼š`cat twenty.log`
2. æŸ¥çœ‹è¨ºæ–·çµæœï¼š`./è¨ºæ–·ä¸¦ä¿®å¾©.sh`
3. æª¢æŸ¥é…ç½®ï¼š`./twenty-config.sh --show`
4. æä¾›ä»¥ä¸Šä¿¡æ¯å°‹æ±‚å¹«åŠ©

