# 🚀 Y-CRM AWS 部署狀態

**更新時間**：2025-11-12 19:57

---

## ✅ 已完成的步驟

### 1. 跨平台映像構建與推送

**映像資訊：**
- ✅ Backend: `ycrm/y-crm:backend-20251112-amd64` (9.13 GB)
- ✅ Frontend: `ycrm/y-crm:frontend-20251112-amd64` (153 MB)

**架構支援：**
- 目標平台：`linux/amd64` (AWS x86_64 相容)
- 本地 Mac (ARM64) 可正常運行（Docker Desktop 自動模擬）

**Docker Hub 狀態：**
- 映像已成功推送到私有 repository：`ycrm/y-crm`
- 帳號：`ycrm`

---

## ⏭️ 下一步操作

### 選項 A：本地測試（建議先執行）

在部署到 AWS 前，先在本地測試 amd64 映像是否正常運行：

```bash
cd /Users/ym/twenty-ym/docker

# 測試本地 Mac 是否能正常運行 amd64 映像
docker compose -f Sync-to-AWS/docker-compose.aws.yml pull
docker compose -f Sync-to-AWS/docker-compose.aws.yml up -d

# 等待服務啟動（約 30 秒）
sleep 30

# 修正前端 URL
./Sync-to-AWS/fix-frontend-url.sh http://localhost:8867

# 訪問測試
echo "測試地址：http://localhost:8866"
echo "登入帳號：notyenyu@gmail.com"

# 測試完畢後停止
docker compose -f Sync-to-AWS/docker-compose.aws.yml down
```

### 選項 B：直接部署到 AWS

如果本地測試通過，或決定直接部署到 AWS：

```bash
cd /Users/ym/twenty-ym/docker/Sync-to-AWS

# 步驟 1：備份最新資料庫（如果需要）
./01-備份資料庫.sh

# 步驟 2：準備部署包
./03-準備部署包.sh

# 步驟 3：上傳到 AWS
./04-上傳到AWS.sh YOUR_AWS_IP
```

---

## 📋 AWS 部署清單

在部署到 AWS 前，請確認：

- [ ] AWS EC2 實例已創建（建議：t3.medium，Ubuntu 24.04 LTS）
- [ ] 安全群組已配置（端口：22, 80, 8866, 8867）
- [ ] SSH 金鑰已設定（`~/.ssh/y-crm-aws-key.pem`）
- [ ] Docker 已安裝在 AWS VM 上
- [ ] `.env` 文件中的 `YOUR_AWS_IP` 已替換為實際 IP

---

## 🔧 技術細節

### 為什麼要 Build 跨平台映像？

- **問題**：您的 Mac 是 ARM64 架構，但 AWS EC2 是 x86_64 架構
- **解決方式**：使用 `docker buildx` build `linux/amd64` 映像
- **時間成本**：首次 build 需約 15-25 分鐘

### 記憶體需求

- **Frontend Build**：需要約 8-10 GB 記憶體
- **您的配置**：Docker Desktop 已分配 15.6 GB ✅
- **Build 時間**：
  - Backend: 約 10 分鐘
  - Frontend: 約 6 分鐘（含 Vite build 3分18秒）

---

## 💡 重要提醒

1. **映像標籤**：
   - 映像標籤包含日期 `20251112` 方便版本管理
   - 未來更新需要更新 `docker-compose.aws.yml` 中的映像標籤

2. **Docker Hub 登入**：
   - AWS 部署前必須執行 `docker login -u ycrm`
   - 使用 Personal Access Token (PAT) 作為密碼

3. **前端 URL 修正**：
   - 每次重啟 Docker 容器後需要重新執行 `fix-frontend-url.sh`
   - 這是 Twenty CRM 的設計特性

---

**準備好開始 AWS 部署了嗎？**

請告訴我您想選擇：
- 選項 A：本地測試 amd64 映像
- 選項 B：直接部署到 AWS
